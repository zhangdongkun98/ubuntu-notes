# - DO NOT EDIT - FILE IS AUTOGENERATED

# NOTE: The docker:stable-dind service is not used here because --add-runtime=nvidia does not work from DIND and we need the
#       runtime to perform tests

# Important gitlab-runner considerations
#
# Docker buildx is used for multi-arch images builds. This feature is currently experimental and
# must be explicitly enabled on the docker daemon performing the image builds.
#
# To run multi-arch images on x86_64, qemu-user-static and systemd are required with the following configuration:
#
# $ cat /etc/binfmt.d/qemu-static.conf
# :qemu-aarch64:M::\x7fELF\x02\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\xb7:\xff\xff\xff\xff\xff\xff\xff\x00\xff\xff\xff\xff\xff\xff\xff\xff\xfe\xff\xff:/usr/bin/qemu-aarch64-static:CF
# :qemu-ppc64le:M::\x7fELF\x02\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x15\x00:\xff\xff\xff\xff\xff\xff\xff\x00\xff\xff\xff\xff\xff\xff\xff\xff\xfe\xff\xff\x00:/usr/bin/qemu-ppc64le-static:CF
#
# < reboot or start systemd-binfmt.service >
#
# Check with:
#
# $ systemctl status systemd-binfmt.service
# < service should be started >
#
# $ docker run -it nvidia/cuda-ppc64le:11.0-base-ubuntu18.04-rc
# < container should run>

variables:
  # Need a value of two here for checking the manifest in the last commit
  GIT_DEPTH: "2"
  # If set to "true" this will force the prepare stage to run to build the builder images that contains docker buildx and python dependencies
  REBUILD_BUILDER: "false"

before_script:
  - source util.sh
  - if [[ ! -z ${RELEASE_LABEL} ]]; then
        export CUDA_VERSION=${RELEASE_LABEL};
    fi
  - 'echo "TRIGGER: ${KITMAKER}"'
  - 'echo "KITMAKER: ${KITMAKER}"'
  - 'echo "ARCH: $ARCH"'
  - 'echo "IMAGE_NAME: $IMAGE_NAME"'
  - 'echo "OS: $OS"'
  - 'echo "OS_VERSION: $OS_VERSION"'
  - 'echo "OS_NAME: $OS_NAME"'
  - 'echo "CUDA_VERSION: $CUDA_VERSION"'
  - 'echo "RELEASE_LABEL: $RELEASE_LABEL"' # used by kitmaker and cuda versions >= 11.2
  - 'echo "CUDNN_VERSION: $CUDNN_VERSION"'
  - 'echo "IMAGE_TAG_SUFFIX: $IMAGE_TAG_SUFFIX"'
  - 'echo "NO_OS_SUFFIX: $NO_OS_SUFFIX"'
  # Gitlab is used to stage images
  - docker login -u "gitlab-ci-token" -p $CI_JOB_TOKEN gitlab-master.nvidia.com:5005
  # Login to NGC to pull images
  - docker login -u '$oauthtoken' -p $NVCR_TOKEN nvcr.io

stages:
  - prepare
  - trigger
  - cuda
  - cudnn
  - test
  - scan
  - deploy
  - cleanup_success
  - cleanup_failed

# builds the gitlab-cuda-builder image
prepare:
  image: docker:stable
  stage: prepare
  variables:
    IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/gitlab-cuda-builder"
  script:
    - docker build -t gitlab-master.nvidia.com:5005/cuda-installer/cuda/gitlab-cuda-builder --cache-from gitlab-master.nvidia.com:5005/cuda-installer/cuda/gitlab-cuda-builder .
    - docker push gitlab-master.nvidia.com:5005/cuda-installer/cuda/gitlab-cuda-builder
  tags:
    - docker
  rules:
      - if: '$REBUILD_BUILDER == "true"'

.tags_template: &tags_definition
  tags:
    - docker

.tags_template_multiarch: &tags_definition_multiarch
  tags:
    - docker-multi-arch

# Only used for CUDA 8.0, will be removed once CUDA 8 support is dropped
.cuda_template_depricated: &cuda_definition_deprecated
  image: gitlab-master.nvidia.com:5005/cuda-installer/cuda/gitlab-cuda-builder
  stage: cuda
  retry: 2
  script:
    - if [[ "${NO_OS_SUFFIX}" == "true" ]]; then
        export TAG_RUNTIME=" -t ${IMAGE_NAME}:${CUDA_VERSION}-runtime ";
        export TAG_DEVEL=" -t ${IMAGE_NAME}:${CUDA_VERSION}-devel ";
        export CUDA_TAGS="${CUDA_VERSION}-runtime ${CUDA_VERSION}-devel ";
      fi
    - if [[ -z $DIST_BASE_PATH ]]; then
        export DIST_BASE_PATH="dist/${OS}/${CUDA_VERSION}/${ARCH}";
      else
        export DIST_BASE_PATH="${DIST_BASE_PATH}/${OS}-${ARCH}";
      fi
    - docker buildx create --use --platform linux/${ARCH} --driver-opt image=moby/buildkit:v0.8.1 --name cuda-${ARCH}
    - docker buildx build --pull --push --platform linux/${ARCH} -t "${IMAGE_NAME}:${CUDA_VERSION}-runtime-${OS}" ${TAG_RUNTIME} "${DIST_BASE_PATH}/runtime"
                          --build-arg BUILDKIT_INLINE_CACHE=1 --progress plain
                          --cache-from=type=registry,ref=${IMAGE_NAME}:${CUDA_VERSION}-runtime-${OS}
    - docker buildx build --pull --push --platform linux/${ARCH} -t "${IMAGE_NAME}:${CUDA_VERSION}-devel-${OS}" ${TAG_DEVEL} "${DIST_BASE_PATH}/devel"
                          --build-arg "IMAGE_NAME=${IMAGE_NAME}"
                          --build-arg BUILDKIT_INLINE_CACHE=1 --progress plain
                          --cache-from=type=registry,ref=${IMAGE_NAME}:${CUDA_VERSION}-devel-${OS}
    - 'echo "CUDA_TAGS=\"${CUDA_TAGS} ${CUDA_VERSION}-runtime-${OS} ${CUDA_VERSION}-devel-${OS}\"" >> tags.env'
    - cat tags.env
  artifacts:
    reports:
      dotenv: tags.env

.cuda_base_template: &cuda_base_definition
  image: gitlab-master.nvidia.com:5005/cuda-installer/cuda/gitlab-cuda-builder
  stage: cuda
  retry: 2
  script:
    - if [[ "${NO_OS_SUFFIX}" == "true" ]]; then
        export TAG_BASE=" -t ${IMAGE_NAME}:${CUDA_VERSION}-base${IMAGE_TAG_SUFFIX} ";
        export TAG_RUNTIME=" -t ${IMAGE_NAME}:${CUDA_VERSION}-runtime${IMAGE_TAG_SUFFIX} ";
        export TAG_DEVEL=" -t ${IMAGE_NAME}:${CUDA_VERSION}-devel${IMAGE_TAG_SUFFIX} ";
        export CUDA_TAGS="${CUDA_VERSION}-base${IMAGE_TAG_SUFFIX} ${CUDA_VERSION}-runtime${IMAGE_TAG_SUFFIX} ${CUDA_VERSION}-devel${IMAGE_TAG_SUFFIX} ";
      fi
    - if [[ -z $DIST_BASE_PATH ]]; then
        export DIST_BASE_PATH="dist/${OS}/${CUDA_VERSION}/${ARCH}";
      else
        export DIST_BASE_PATH="${DIST_BASE_PATH}/${OS}-${ARCH}";
      fi
    - |
      if [ ! -z $KITMAKER ] && [ ! -z $TRIGGER ]; then
          export DIST_BASE_PATH="kitpick"
          rm -rf kitpick || true
          mkdir -p kitpick || true
          find kitpick/
          NEW_CANDIDATE_URL="${CANDIDATE_URL}"
          [[ "${CANDIDATE_URL}" != */ ]] && NEW_CANDIDATE_URL="${CANDIDATE_URL}/"
          retry 3 10 time wget --recursive --directory-prefix="rekt" --reject="index.html*" --no-parent ${NEW_CANDIDATE_URL}
          cp -R rekt/${CANDIDATE_URL#"http://"}/{base,devel,runtime} kitpick/
          echo "Contents of kitpick/"
          find kitpick/
      fi
    - 'echo "DIST_BASE_PATH: ${DIST_BASE_PATH}"'
    - 'echo "TAG_BASE: ${TAG_BASE}"'
    - 'echo "TAG_RUNTIME: ${TAG_RUNTIME}"'
    - 'echo "TAG_DEVEL: ${TAG_DEVEL}"'
    # --driver-opt flag is needed to workaround https://github.com/docker/buildx/issues/386
    - docker buildx create --use --platform linux/${ARCH} --driver-opt image=moby/buildkit:v0.8.1 --name cuda-${ARCH}
    - docker buildx build --pull --push --platform linux/${ARCH} -t "${IMAGE_NAME}:${CUDA_VERSION}-base-${OS}${IMAGE_TAG_SUFFIX}" ${TAG_BASE} "${DIST_BASE_PATH}/base"
                          --build-arg BUILDKIT_INLINE_CACHE=1 --progress plain
                          --cache-from=type=registry,ref=${IMAGE_NAME}:${CUDA_VERSION}-base-${OS}${IMAGE_TAG_SUFFIX}
    - docker buildx build --pull --push --platform linux/${ARCH} -t "${IMAGE_NAME}:${CUDA_VERSION}-runtime-${OS}${IMAGE_TAG_SUFFIX}" ${TAG_RUNTIME}
                          --build-arg "IMAGE_NAME=${IMAGE_NAME}" "${DIST_BASE_PATH}/runtime"
                          --build-arg BUILDKIT_INLINE_CACHE=1 --progress plain
                          --cache-from=type=registry,ref=${IMAGE_NAME}:${CUDA_VERSION}-runtime-${OS}${IMAGE_TAG_SUFFIX}
    - docker buildx build --pull --push --platform linux/${ARCH} -t "${IMAGE_NAME}:${CUDA_VERSION}-devel-${OS}${IMAGE_TAG_SUFFIX}" ${TAG_DEVEL}
                          --build-arg "IMAGE_NAME=${IMAGE_NAME}" "${DIST_BASE_PATH}/devel"
                          --build-arg BUILDKIT_INLINE_CACHE=1 --progress plain
                          --cache-from=type=registry,ref=${IMAGE_NAME}:${CUDA_VERSION}-devel-${OS}${IMAGE_TAG_SUFFIX}
    - 'echo "CUDA_TAGS=\"${CUDA_TAGS} ${CUDA_VERSION}-base-${OS}${IMAGE_TAG_SUFFIX} ${CUDA_VERSION}-runtime-${OS}${IMAGE_TAG_SUFFIX} ${CUDA_VERSION}-devel-${OS}${IMAGE_TAG_SUFFIX}\"" >> tags.env'
    - cat tags.env
  artifacts:
    reports:
      dotenv: tags.env

.cudnn_template: &cudnn_definition
  image: gitlab-master.nvidia.com:5005/cuda-installer/cuda/gitlab-cuda-builder
  stage: cudnn
  retry: 2
  script:
    - if [[ -z $DIST_BASE_PATH ]]; then
        DIST_BASE_PATH="dist/${OS}/${CUDA_VERSION}/${ARCH}";
      else
        DIST_BASE_PATH="${DIST_BASE_PATH}/${OS}-${ARCH}";
      fi
    - 'echo "DIST_BASE_PATH: ${DIST_BASE_PATH}"'
    - if [[ "${NO_OS_SUFFIX}" == "true" ]]; then
        TAG_CUDNN_RUNTIME=" -t ${IMAGE_NAME}:${CUDA_VERSION}-${CUDNN_VERSION}-runtime${IMAGE_TAG_SUFFIX} ";
        TAG_CUDNN_DEVEL=" -t ${IMAGE_NAME}:${CUDA_VERSION}-${CUDNN_VERSION}-devel${IMAGE_TAG_SUFFIX} ";
        export CUDA_EXTRA_TAGS="${CUDA_EXTRA_TAGS} ${CUDA_VERSION}-${CUDNN_VERSION}-runtime${IMAGE_TAG_SUFFIX} ${CUDA_VERSION}-${CUDNN_VERSION}-devel${IMAGE_TAG_SUFFIX}";
      fi
    - docker buildx create --use --platform linux/${ARCH} --driver-opt image=moby/buildkit:v0.8.1 --name cuda-${ARCH}
    - docker buildx build --pull --push --platform linux/${ARCH} -t "${IMAGE_NAME}:${CUDA_VERSION}-${CUDNN_VERSION}-runtime-${OS}${IMAGE_TAG_SUFFIX}" ${TAG_CUDNN_RUNTIME}
                  --build-arg "IMAGE_NAME=${IMAGE_NAME}" "${DIST_BASE_PATH}/runtime/${CUDNN_VERSION}"
                  --build-arg BUILDKIT_INLINE_CACHE=1 --progress plain
                  --cache-from=type=registry,ref=${IMAGE_NAME}:${CUDA_VERSION}-${CUDNN_VERSION}-runtime-${OS}${IMAGE_TAG_SUFFIX}
    - docker buildx build --pull --push --platform linux/${ARCH} -t "${IMAGE_NAME}:${CUDA_VERSION}-${CUDNN_VERSION}-devel-${OS}${IMAGE_TAG_SUFFIX}" ${TAG_CUDNN_DEVEL}
                  --build-arg "IMAGE_NAME=${IMAGE_NAME}" "${DIST_BASE_PATH}/devel/${CUDNN_VERSION}"
                  --build-arg BUILDKIT_INLINE_CACHE=1 --progress plain
                  --cache-from=type=registry,ref=${IMAGE_NAME}:${CUDA_VERSION}-${CUDNN_VERSION}-devel-${OS}${IMAGE_TAG_SUFFIX}
    # this is not a great way to pass information between stages, but it is currently the only way
    - 'echo "CUDA_TAGS=${CUDA_TAGS}" > ${CUDNN_VERSION}finaltags.env'
    - 'echo "CUDA_${CUDNN_VERSION}_TAGS=\"${CUDA_VERSION}-${CUDNN_VERSION}-devel-${OS}${IMAGE_TAG_SUFFIX} ${CUDA_VERSION}-${CUDNN_VERSION}-runtime-${OS}${IMAGE_TAG_SUFFIX}\"" >> ${CUDNN_VERSION}finaltags.env'
    - 'echo "CUDA_EXTRA_${CUDNN_VERSION}_TAGS=\"${CUDA_EXTRA_TAGS}\"" >> ${CUDNN_VERSION}finaltags.env'
    - cat ${CUDNN_VERSION}finaltags.env

.test_template: &test_definition
  image: gitlab-master.nvidia.com:5005/cuda-installer/cuda/gitlab-cuda-builder
  stage: test
  tags:
    - cuda-test
  script:
    - |
      bash -e ./test/scripts/bats_install.sh
      bash -e ./test/scripts/run_tests.sh

.scan_template: &scan_definition
  image: gitlab-master.nvidia.com:5005/cuda-installer/cuda/gitlab-cuda-builder
  stage: scan
  <<: *tags_definition
  script:
    - |
      git clone https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab-master.nvidia.com/sectooling/scanning/contamer.git
      cd contamer
      pip3 install -r requirements.txt
      docker pull ${IMAGE_NAME}:${CUDA_VERSION}-devel-${OS}${IMAGE_TAG_SUFFIX}

      # CVE-2020-14352 CVE-2020-15888: librepo, lua-libs packages WAIVED via https://nvbugswb.nvidia.com/NvBugs5/SWBug.aspx?bugid=3028123&cmtNo=35
      python3 contamer.py --debug-logs -ls --fail-on-non-os ${IMAGE_NAME}:${CUDA_VERSION}-devel-${OS}${IMAGE_TAG_SUFFIX} \
          --suppress-vulns CVE-2020-14352 CVE-2020-15888 CVE-2019-25013 | tee /tmp/output
      retval=$?

      echo "Contamer return value: ${retval}";
      docker rmi -f ${IMAGE_NAME}:${CUDA_VERSION}-devel-${OS}${IMAGE_TAG_SUFFIX}
      if [[ $retval -ne 0 ]]; then
          exit 1;
      else
          # we need to look at the output for "Traceback" because contamer doesn't return non-zero on exception failure...
          if cat /tmp/output | grep -q "Traceback\|Exception: Image analysis failed"; then
              exit 1;
          fi
      fi

.deploy_template: &deploy_definition
  image: gitlab-master.nvidia.com:5005/cuda-installer/cuda/gitlab-cuda-builder
  stage: deploy
  retry: 2
  <<: *tags_definition
  script:
    - for tag in $(env | grep 'CUDA.*_TAGS' | cut -f2 -d=); do
        echo ${tag//\"} >> TAG_MANIFEST;
      done
    - cat TAG_MANIFEST
    - if [ ! -z $KITMAKER ] && [ ! -z $TRIGGER ]; then
        retry 3 10 time wget --directory-prefix="kitpick" --reject="index.html*" --no-parent ${CANDIDATE_URL}/manifest-${OS_NAME}-${OS_VERSION}.yml;
        export MANIFEST="kitpick/manifest-${OS_NAME}-${OS_VERSION}.yml";
      fi
    - python manager.py ${MANIFEST:+`echo "--manifest ${MANIFEST}"`} push
        --tag-manifest TAG_MANIFEST
        --image-name "${IMAGE_NAME}"
        --os-name "${OS_NAME}"
        --os-version "${OS_VERSION}"
        --cuda-version "${CUDA_VERSION}"
        --arch "${ARCH}"
        ${PIPELINE_NAME:+`echo "--pipeline-name ${PIPELINE_NAME}"`}
        ${IMAGE_TAG_SUFFIX:+`echo "--tag-suffix ${IMAGE_TAG_SUFFIX}"`} ${NO_PUSH:+"-n"}
    - |
      cat $MANIFEST | grep "${ARCH}.*urm.nvidia.com" | cut -f2 -d: | xargs >> TAG_MANIFEST
  artifacts:
    paths:
      - TAG_MANIFEST

trigger:
  image: gitlab-master.nvidia.com:5005/cuda-installer/cuda/gitlab-cuda-builder
  stage: trigger
  <<: *tags_definition
  variables:
    MANIFEST: "manifests/cuda.yaml"
  script:
    - echo CI_COMMIT_MESSAGE:$CI_COMMIT_MESSAGE
    - export ESC_TO=`echo $TRIGGER_OVERRIDE | sed 's/\ //g'`
    - export CMD="python manager.py ${MANIFEST:+`echo --manifest ${MANIFEST}`} trigger ${TRIGGER_OVERRIDE:+`echo --trigger-override ${ESC_TO}`}"
    - 'echo "COMMAND: $CMD"'
    - $CMD
  rules:
    - if: '$TRIGGER_OVERRIDE'

# Need to pass these from the trigger
.kitmaker_variables: &kitmaker_variables
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/release-candidate/${ARCH}"

.kitmaker_only: &kitmaker_only
  variables:
    <<: *kitmaker_variables
  rules:
    - if: '$TRIGGER == "true" && $KITMAKER == "true"'
      when: on_success

kitmaker_base:
  <<: *cuda_base_definition
  <<: *kitmaker_only

kitmaker_deploy:
  <<: *deploy_definition
  <<: *kitmaker_only
  needs:
    - job: kitmaker_base
      artifacts: true

# Requires two stages because CI_JOB_STATUS is not yet available in our infrastructure
kitmaker_cleanup_success:
  image: gitlab-master.nvidia.com:5005/cuda-installer/cuda/gitlab-cuda-builder
  stage: cleanup_success
  <<: *tags_definition
  script:
    - |
      cat TAG_MANIFEST
      export a_image_name=$(awk '/./{line=$0} END{print line}' TAG_MANIFEST) # get the artifactory repo name
      sed -i '$ d' TAG_MANIFEST # delete the last line containing the artifactory repo
      export json_data="{\"status\": \"success\", \"gitlab_pipeline_url\": \"${CI_PIPELINE_URL}\", \"image_name\": \"${a_image_name}\", \"tags\": $(cat TAG_MANIFEST | jq -R . | jq -s . | jq 'map(select(length > 0))' | jq -c .)}"
      curl -v -X POST -H "Content-Type: application/json" -d "${json_data}" "${WEBHOOK_URL}"
  variables:
    <<: *kitmaker_variables
  rules:
    - if: '$TRIGGER == "true" && $KITMAKER == "true"'
      when: on_success
  needs:
    - job: kitmaker_base
      artifacts: true
    - job: kitmaker_deploy

# Requires two stages because CI_JOB_STATUS is not yet available in our infrastructure
kitmaker_cleanup_failed:
  image: gitlab-master.nvidia.com:5005/cuda-installer/cuda/gitlab-cuda-builder
  stage: cleanup_failed
  <<: *tags_definition
  script:
    - |
      export json_data="{\"status\": \"failed\", \"gitlab_pipeline_url\": \"${CI_PIPELINE_URL}\"}"
      curl -v -X POST -H "Content-Type: application/json" -d "${json_data}" ${WEBHOOK_URL}
  variables:
    <<: *kitmaker_variables
  rules:
    - if: '$TRIGGER == "true" && $KITMAKER == "true"'
      when: on_failure
  needs:
    - job: kitmaker_base
    - job: kitmaker_deploy
      artifacts: true

.ubuntu20_04_11_2_0_x86_64_variables: &ubuntu20_04_11_2_0_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.2.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu20.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "20.04"
  CUDA_VERSION: "11.2.0"

.ubuntu20_04_11_2_0_x86_64_only: &ubuntu20_04_11_2_0_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu20_04_11_2_0_x86_64_variables
  rules:
    - if: '$ubuntu20_04_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu20.04-v11.2.0-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu20_04_11_2_0_x86_64_only

ubuntu20.04-v11.2.0-test-x86_64:
  needs: ["ubuntu20.04-v11.2.0-x86_64"]
  <<: *ubuntu20_04_11_2_0_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu20_04_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu20.04-v11.2.0-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu20_04_11_2_0_x86_64_only
  needs:
    - job: ubuntu20.04-v11.2.0-x86_64
    - job: ubuntu20.04-v11.2.0-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu20_04_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu20.04-v11.2.0-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu20_04_11_2_0_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu20.04-v11.2.0-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu20_04_11_2_0_x86_64 == "true" && $NO_TEST == "true"'

ubuntu20.04-v11.2.0-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu20_04_11_2_0_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu20_04_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu20.04-v11.2.0-x86_64
      artifacts: true
    - job: ubuntu20.04-v11.2.0-test-x86_64
    - job: ubuntu20.04-v11.2.0-scan-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu20.04-v11.2.0-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu20_04_11_2_0_x86_64_only
  rules:
    - if: '$ubuntu20_04_11_2_0_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu20.04-v11.2.0-x86_64
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu20.04-v11.2.0-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu20_04_11_2_0_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu20_04_11_2_0_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu20.04-v11.2.0-x86_64
      artifacts: true
    - job: ubuntu20.04-v11.2.0-scan-no-test-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu20.04-v11.2.0-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu20_04_11_2_0_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu20_04_11_2_0_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu20.04-v11.2.0-x86_64
      artifacts: true
    - job: ubuntu20.04-v11.2.0-test-x86_64

.ubuntu20_04_11_2_0_arm64_variables: &ubuntu20_04_11_2_0_arm64_variables
  ARCH: "arm64"
  DIST_BASE_PATH: "dist/11.2.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-arm64"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu20.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "20.04"
  CUDA_VERSION: "11.2.0"

.ubuntu20_04_11_2_0_arm64_only: &ubuntu20_04_11_2_0_arm64_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubuntu20_04_11_2_0_arm64_variables
  rules:
    - if: '$ubuntu20_04_11_2_0_arm64 == "true"'
    - if: '$all == "true"'

ubuntu20.04-v11.2.0-arm64:
  <<: *cuda_base_definition
  <<: *ubuntu20_04_11_2_0_arm64_only

ubuntu20.04-v11.2.0-test-arm64:
  needs: ["ubuntu20.04-v11.2.0-arm64"]
  <<: *ubuntu20_04_11_2_0_arm64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu20_04_11_2_0_arm64 == "true"'
    - if: '$all == "true"'

ubuntu20.04-v11.2.0-scan-arm64:
  <<: *scan_definition
  <<: *ubuntu20_04_11_2_0_arm64_only
  needs:
    - job: ubuntu20.04-v11.2.0-arm64
    - job: ubuntu20.04-v11.2.0-test-arm64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu20_04_11_2_0_arm64 == "true"'
    - if: '$all == "true"'

ubuntu20.04-v11.2.0-scan-no-test-arm64:
  <<: *scan_definition
  <<: *ubuntu20_04_11_2_0_arm64_only
  # Override rules from only definition
  needs:
    - job: ubuntu20.04-v11.2.0-arm64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu20_04_11_2_0_arm64 == "true" && $NO_TEST == "true"'

ubuntu20.04-v11.2.0-deploy-arm64:
  <<: *deploy_definition
  <<: *ubuntu20_04_11_2_0_arm64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu20_04_11_2_0_arm64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu20.04-v11.2.0-arm64
      artifacts: true
    - job: ubuntu20.04-v11.2.0-test-arm64
    - job: ubuntu20.04-v11.2.0-scan-arm64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu20.04-v11.2.0-deploy-arm64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu20_04_11_2_0_arm64_only
  rules:
    - if: '$ubuntu20_04_11_2_0_arm64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu20.04-v11.2.0-arm64
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu20.04-v11.2.0-deploy-arm64-no-test:
  <<: *deploy_definition
  <<: *ubuntu20_04_11_2_0_arm64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu20_04_11_2_0_arm64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu20.04-v11.2.0-arm64
      artifacts: true
    - job: ubuntu20.04-v11.2.0-scan-no-test-arm64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu20.04-v11.2.0-deploy-arm64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu20_04_11_2_0_arm64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu20_04_11_2_0_arm64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu20.04-v11.2.0-arm64
      artifacts: true
    - job: ubuntu20.04-v11.2.0-test-arm64

.ubuntu18_04_11_2_0_x86_64_variables: &ubuntu18_04_11_2_0_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.2.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubuntu18.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "18.04"
  CUDA_VERSION: "11.2.0"

.ubuntu18_04_11_2_0_x86_64_only: &ubuntu18_04_11_2_0_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu18_04_11_2_0_x86_64_variables
  rules:
    - if: '$ubuntu18_04_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.2.0-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu18_04_11_2_0_x86_64_only

ubuntu18.04-v11.2.0-test-x86_64:
  needs: ["ubuntu18.04-v11.2.0-x86_64"]
  <<: *ubuntu18_04_11_2_0_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.2.0-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu18_04_11_2_0_x86_64_only
  needs:
    - job: ubuntu18.04-v11.2.0-x86_64
    - job: ubuntu18.04-v11.2.0-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.2.0-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu18_04_11_2_0_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu18.04-v11.2.0-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_2_0_x86_64 == "true" && $NO_TEST == "true"'

ubuntu18.04-v11.2.0-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_2_0_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu18.04-v11.2.0-x86_64
      artifacts: true
    - job: ubuntu18.04-v11.2.0-test-x86_64
    - job: ubuntu18.04-v11.2.0-scan-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu18.04-v11.2.0-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_2_0_x86_64_only
  rules:
    - if: '$ubuntu18_04_11_2_0_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v11.2.0-x86_64
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu18.04-v11.2.0-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_2_0_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_2_0_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu18.04-v11.2.0-x86_64
      artifacts: true
    - job: ubuntu18.04-v11.2.0-scan-no-test-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu18.04-v11.2.0-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_2_0_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_2_0_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v11.2.0-x86_64
      artifacts: true
    - job: ubuntu18.04-v11.2.0-test-x86_64

.ubuntu18_04_11_2_0_arm64_variables: &ubuntu18_04_11_2_0_arm64_variables
  ARCH: "arm64"
  DIST_BASE_PATH: "dist/11.2.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-arm64"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu18.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "18.04"
  CUDA_VERSION: "11.2.0"

.ubuntu18_04_11_2_0_arm64_only: &ubuntu18_04_11_2_0_arm64_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubuntu18_04_11_2_0_arm64_variables
  rules:
    - if: '$ubuntu18_04_11_2_0_arm64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.2.0-arm64:
  <<: *cuda_base_definition
  <<: *ubuntu18_04_11_2_0_arm64_only

ubuntu18.04-v11.2.0-test-arm64:
  needs: ["ubuntu18.04-v11.2.0-arm64"]
  <<: *ubuntu18_04_11_2_0_arm64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_2_0_arm64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.2.0-scan-arm64:
  <<: *scan_definition
  <<: *ubuntu18_04_11_2_0_arm64_only
  needs:
    - job: ubuntu18.04-v11.2.0-arm64
    - job: ubuntu18.04-v11.2.0-test-arm64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_2_0_arm64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.2.0-scan-no-test-arm64:
  <<: *scan_definition
  <<: *ubuntu18_04_11_2_0_arm64_only
  # Override rules from only definition
  needs:
    - job: ubuntu18.04-v11.2.0-arm64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_2_0_arm64 == "true" && $NO_TEST == "true"'

ubuntu18.04-v11.2.0-deploy-arm64:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_2_0_arm64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_2_0_arm64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu18.04-v11.2.0-arm64
      artifacts: true
    - job: ubuntu18.04-v11.2.0-test-arm64
    - job: ubuntu18.04-v11.2.0-scan-arm64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu18.04-v11.2.0-deploy-arm64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_2_0_arm64_only
  rules:
    - if: '$ubuntu18_04_11_2_0_arm64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v11.2.0-arm64
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu18.04-v11.2.0-deploy-arm64-no-test:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_2_0_arm64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_2_0_arm64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu18.04-v11.2.0-arm64
      artifacts: true
    - job: ubuntu18.04-v11.2.0-scan-no-test-arm64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu18.04-v11.2.0-deploy-arm64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_2_0_arm64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_2_0_arm64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v11.2.0-arm64
      artifacts: true
    - job: ubuntu18.04-v11.2.0-test-arm64

.ubuntu16_04_11_2_0_x86_64_variables: &ubuntu16_04_11_2_0_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.2.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubuntu16.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "16.04"
  CUDA_VERSION: "11.2.0"

.ubuntu16_04_11_2_0_x86_64_only: &ubuntu16_04_11_2_0_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu16_04_11_2_0_x86_64_variables
  rules:
    - if: '$ubuntu16_04_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v11.2.0-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu16_04_11_2_0_x86_64_only

ubuntu16.04-v11.2.0-test-x86_64:
  needs: ["ubuntu16.04-v11.2.0-x86_64"]
  <<: *ubuntu16_04_11_2_0_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v11.2.0-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_11_2_0_x86_64_only
  needs:
    - job: ubuntu16.04-v11.2.0-x86_64
    - job: ubuntu16.04-v11.2.0-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v11.2.0-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_11_2_0_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu16.04-v11.2.0-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_11_2_0_x86_64 == "true" && $NO_TEST == "true"'

ubuntu16.04-v11.2.0-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu16_04_11_2_0_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu16.04-v11.2.0-x86_64
      artifacts: true
    - job: ubuntu16.04-v11.2.0-test-x86_64
    - job: ubuntu16.04-v11.2.0-scan-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu16.04-v11.2.0-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_11_2_0_x86_64_only
  rules:
    - if: '$ubuntu16_04_11_2_0_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v11.2.0-x86_64
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu16.04-v11.2.0-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu16_04_11_2_0_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_11_2_0_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu16.04-v11.2.0-x86_64
      artifacts: true
    - job: ubuntu16.04-v11.2.0-scan-no-test-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu16.04-v11.2.0-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_11_2_0_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_11_2_0_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v11.2.0-x86_64
      artifacts: true
    - job: ubuntu16.04-v11.2.0-test-x86_64

.centos8_11_2_0_x86_64_variables: &centos8_11_2_0_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.2.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos8"
  OS_NAME: "centos"
  OS_VERSION: "8"
  CUDA_VERSION: "11.2.0"

.centos8_11_2_0_x86_64_only: &centos8_11_2_0_x86_64_only
  <<: *tags_definition
  variables:
    <<: *centos8_11_2_0_x86_64_variables
  rules:
    - if: '$centos8_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

centos8-v11.2.0-x86_64:
  <<: *cuda_base_definition
  <<: *centos8_11_2_0_x86_64_only

centos8-v11.2.0-test-x86_64:
  needs: ["centos8-v11.2.0-x86_64"]
  <<: *centos8_11_2_0_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

centos8-v11.2.0-scan-x86_64:
  <<: *scan_definition
  <<: *centos8_11_2_0_x86_64_only
  needs:
    - job: centos8-v11.2.0-x86_64
    - job: centos8-v11.2.0-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos8_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

centos8-v11.2.0-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *centos8_11_2_0_x86_64_only
  # Override rules from only definition
  needs:
    - job: centos8-v11.2.0-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_2_0_x86_64 == "true" && $NO_TEST == "true"'

centos8-v11.2.0-deploy-x86_64:
  <<: *deploy_definition
  <<: *centos8_11_2_0_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos8-v11.2.0-x86_64
      artifacts: true
    - job: centos8-v11.2.0-test-x86_64
    - job: centos8-v11.2.0-scan-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos8-v11.2.0-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_2_0_x86_64_only
  rules:
    - if: '$centos8_11_2_0_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.2.0-x86_64
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
centos8-v11.2.0-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *centos8_11_2_0_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_2_0_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos8-v11.2.0-x86_64
      artifacts: true
    - job: centos8-v11.2.0-scan-no-test-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
centos8-v11.2.0-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_2_0_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_2_0_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.2.0-x86_64
      artifacts: true
    - job: centos8-v11.2.0-test-x86_64

.centos8_11_2_0_ppc64le_variables: &centos8_11_2_0_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/11.2.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos8"
  OS_NAME: "centos"
  OS_VERSION: "8"
  CUDA_VERSION: "11.2.0"

.centos8_11_2_0_ppc64le_only: &centos8_11_2_0_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *centos8_11_2_0_ppc64le_variables
  rules:
    - if: '$centos8_11_2_0_ppc64le == "true"'
    - if: '$all == "true"'

centos8-v11.2.0-ppc64le:
  <<: *cuda_base_definition
  <<: *centos8_11_2_0_ppc64le_only

centos8-v11.2.0-test-ppc64le:
  needs: ["centos8-v11.2.0-ppc64le"]
  <<: *centos8_11_2_0_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_2_0_ppc64le == "true"'
    - if: '$all == "true"'

centos8-v11.2.0-scan-ppc64le:
  <<: *scan_definition
  <<: *centos8_11_2_0_ppc64le_only
  needs:
    - job: centos8-v11.2.0-ppc64le
    - job: centos8-v11.2.0-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos8_11_2_0_ppc64le == "true"'
    - if: '$all == "true"'

centos8-v11.2.0-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *centos8_11_2_0_ppc64le_only
  # Override rules from only definition
  needs:
    - job: centos8-v11.2.0-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_2_0_ppc64le == "true" && $NO_TEST == "true"'

centos8-v11.2.0-deploy-ppc64le:
  <<: *deploy_definition
  <<: *centos8_11_2_0_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_2_0_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos8-v11.2.0-ppc64le
      artifacts: true
    - job: centos8-v11.2.0-test-ppc64le
    - job: centos8-v11.2.0-scan-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos8-v11.2.0-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_2_0_ppc64le_only
  rules:
    - if: '$centos8_11_2_0_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.2.0-ppc64le
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
centos8-v11.2.0-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *centos8_11_2_0_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_2_0_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: centos8-v11.2.0-ppc64le
      artifacts: true
    - job: centos8-v11.2.0-scan-no-test-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
centos8-v11.2.0-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_2_0_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_2_0_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.2.0-ppc64le
      artifacts: true
    - job: centos8-v11.2.0-test-ppc64le

.centos8_11_2_0_arm64_variables: &centos8_11_2_0_arm64_variables
  ARCH: "arm64"
  DIST_BASE_PATH: "dist/11.2.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-arm64"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos8"
  OS_NAME: "centos"
  OS_VERSION: "8"
  CUDA_VERSION: "11.2.0"

.centos8_11_2_0_arm64_only: &centos8_11_2_0_arm64_only
  <<: *tags_definition_multiarch
  variables:
    <<: *centos8_11_2_0_arm64_variables
  rules:
    - if: '$centos8_11_2_0_arm64 == "true"'
    - if: '$all == "true"'

centos8-v11.2.0-arm64:
  <<: *cuda_base_definition
  <<: *centos8_11_2_0_arm64_only

centos8-v11.2.0-test-arm64:
  needs: ["centos8-v11.2.0-arm64"]
  <<: *centos8_11_2_0_arm64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_2_0_arm64 == "true"'
    - if: '$all == "true"'

centos8-v11.2.0-scan-arm64:
  <<: *scan_definition
  <<: *centos8_11_2_0_arm64_only
  needs:
    - job: centos8-v11.2.0-arm64
    - job: centos8-v11.2.0-test-arm64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos8_11_2_0_arm64 == "true"'
    - if: '$all == "true"'

centos8-v11.2.0-scan-no-test-arm64:
  <<: *scan_definition
  <<: *centos8_11_2_0_arm64_only
  # Override rules from only definition
  needs:
    - job: centos8-v11.2.0-arm64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_2_0_arm64 == "true" && $NO_TEST == "true"'

centos8-v11.2.0-deploy-arm64:
  <<: *deploy_definition
  <<: *centos8_11_2_0_arm64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_2_0_arm64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos8-v11.2.0-arm64
      artifacts: true
    - job: centos8-v11.2.0-test-arm64
    - job: centos8-v11.2.0-scan-arm64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos8-v11.2.0-deploy-arm64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_2_0_arm64_only
  rules:
    - if: '$centos8_11_2_0_arm64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.2.0-arm64
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
centos8-v11.2.0-deploy-arm64-no-test:
  <<: *deploy_definition
  <<: *centos8_11_2_0_arm64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_2_0_arm64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos8-v11.2.0-arm64
      artifacts: true
    - job: centos8-v11.2.0-scan-no-test-arm64

# workaround for gitlab ci rules when NO_SCAN is used...
centos8-v11.2.0-deploy-arm64-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_2_0_arm64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_2_0_arm64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.2.0-arm64
      artifacts: true
    - job: centos8-v11.2.0-test-arm64

.centos7_11_2_0_x86_64_variables: &centos7_11_2_0_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.2.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos7"
  OS_NAME: "centos"
  OS_VERSION: "7"
  CUDA_VERSION: "11.2.0"

.centos7_11_2_0_x86_64_only: &centos7_11_2_0_x86_64_only
  <<: *tags_definition
  variables:
    <<: *centos7_11_2_0_x86_64_variables
  rules:
    - if: '$centos7_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v11.2.0-x86_64:
  <<: *cuda_base_definition
  <<: *centos7_11_2_0_x86_64_only

centos7-v11.2.0-test-x86_64:
  needs: ["centos7-v11.2.0-x86_64"]
  <<: *centos7_11_2_0_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v11.2.0-scan-x86_64:
  <<: *scan_definition
  <<: *centos7_11_2_0_x86_64_only
  needs:
    - job: centos7-v11.2.0-x86_64
    - job: centos7-v11.2.0-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos7_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v11.2.0-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *centos7_11_2_0_x86_64_only
  # Override rules from only definition
  needs:
    - job: centos7-v11.2.0-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_11_2_0_x86_64 == "true" && $NO_TEST == "true"'

centos7-v11.2.0-deploy-x86_64:
  <<: *deploy_definition
  <<: *centos7_11_2_0_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos7_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos7-v11.2.0-x86_64
      artifacts: true
    - job: centos7-v11.2.0-test-x86_64
    - job: centos7-v11.2.0-scan-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos7-v11.2.0-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos7_11_2_0_x86_64_only
  rules:
    - if: '$centos7_11_2_0_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v11.2.0-x86_64
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
centos7-v11.2.0-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *centos7_11_2_0_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_11_2_0_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos7-v11.2.0-x86_64
      artifacts: true
    - job: centos7-v11.2.0-scan-no-test-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
centos7-v11.2.0-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *centos7_11_2_0_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_11_2_0_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v11.2.0-x86_64
      artifacts: true
    - job: centos7-v11.2.0-test-x86_64

.ubi8_11_2_0_x86_64_variables: &ubi8_11_2_0_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.2.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi8"
  OS_NAME: "ubi"
  OS_VERSION: "8"
  CUDA_VERSION: "11.2.0"

.ubi8_11_2_0_x86_64_only: &ubi8_11_2_0_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubi8_11_2_0_x86_64_variables
  rules:
    - if: '$ubi8_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

ubi8-v11.2.0-x86_64:
  <<: *cuda_base_definition
  <<: *ubi8_11_2_0_x86_64_only

ubi8-v11.2.0-test-x86_64:
  needs: ["ubi8-v11.2.0-x86_64"]
  <<: *ubi8_11_2_0_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

ubi8-v11.2.0-scan-x86_64:
  <<: *scan_definition
  <<: *ubi8_11_2_0_x86_64_only
  needs:
    - job: ubi8-v11.2.0-x86_64
    - job: ubi8-v11.2.0-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

ubi8-v11.2.0-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubi8_11_2_0_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubi8-v11.2.0-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_2_0_x86_64 == "true" && $NO_TEST == "true"'

ubi8-v11.2.0-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubi8_11_2_0_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi8-v11.2.0-x86_64
      artifacts: true
    - job: ubi8-v11.2.0-test-x86_64
    - job: ubi8-v11.2.0-scan-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi8-v11.2.0-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_2_0_x86_64_only
  rules:
    - if: '$ubi8_11_2_0_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.2.0-x86_64
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
ubi8-v11.2.0-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubi8_11_2_0_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_2_0_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi8-v11.2.0-x86_64
      artifacts: true
    - job: ubi8-v11.2.0-scan-no-test-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi8-v11.2.0-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_2_0_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_2_0_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.2.0-x86_64
      artifacts: true
    - job: ubi8-v11.2.0-test-x86_64

.ubi8_11_2_0_ppc64le_variables: &ubi8_11_2_0_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/11.2.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi8"
  OS_NAME: "ubi"
  OS_VERSION: "8"
  CUDA_VERSION: "11.2.0"

.ubi8_11_2_0_ppc64le_only: &ubi8_11_2_0_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubi8_11_2_0_ppc64le_variables
  rules:
    - if: '$ubi8_11_2_0_ppc64le == "true"'
    - if: '$all == "true"'

ubi8-v11.2.0-ppc64le:
  <<: *cuda_base_definition
  <<: *ubi8_11_2_0_ppc64le_only

ubi8-v11.2.0-test-ppc64le:
  needs: ["ubi8-v11.2.0-ppc64le"]
  <<: *ubi8_11_2_0_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_2_0_ppc64le == "true"'
    - if: '$all == "true"'

ubi8-v11.2.0-scan-ppc64le:
  <<: *scan_definition
  <<: *ubi8_11_2_0_ppc64le_only
  needs:
    - job: ubi8-v11.2.0-ppc64le
    - job: ubi8-v11.2.0-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_2_0_ppc64le == "true"'
    - if: '$all == "true"'

ubi8-v11.2.0-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubi8_11_2_0_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubi8-v11.2.0-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_2_0_ppc64le == "true" && $NO_TEST == "true"'

ubi8-v11.2.0-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubi8_11_2_0_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_2_0_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi8-v11.2.0-ppc64le
      artifacts: true
    - job: ubi8-v11.2.0-test-ppc64le
    - job: ubi8-v11.2.0-scan-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi8-v11.2.0-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_2_0_ppc64le_only
  rules:
    - if: '$ubi8_11_2_0_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.2.0-ppc64le
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
ubi8-v11.2.0-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubi8_11_2_0_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_2_0_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi8-v11.2.0-ppc64le
      artifacts: true
    - job: ubi8-v11.2.0-scan-no-test-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubi8-v11.2.0-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_2_0_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_2_0_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.2.0-ppc64le
      artifacts: true
    - job: ubi8-v11.2.0-test-ppc64le

.ubi8_11_2_0_arm64_variables: &ubi8_11_2_0_arm64_variables
  ARCH: "arm64"
  DIST_BASE_PATH: "dist/11.2.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-arm64"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi8"
  OS_NAME: "ubi"
  OS_VERSION: "8"
  CUDA_VERSION: "11.2.0"

.ubi8_11_2_0_arm64_only: &ubi8_11_2_0_arm64_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubi8_11_2_0_arm64_variables
  rules:
    - if: '$ubi8_11_2_0_arm64 == "true"'
    - if: '$all == "true"'

ubi8-v11.2.0-arm64:
  <<: *cuda_base_definition
  <<: *ubi8_11_2_0_arm64_only

ubi8-v11.2.0-test-arm64:
  needs: ["ubi8-v11.2.0-arm64"]
  <<: *ubi8_11_2_0_arm64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_2_0_arm64 == "true"'
    - if: '$all == "true"'

ubi8-v11.2.0-scan-arm64:
  <<: *scan_definition
  <<: *ubi8_11_2_0_arm64_only
  needs:
    - job: ubi8-v11.2.0-arm64
    - job: ubi8-v11.2.0-test-arm64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_2_0_arm64 == "true"'
    - if: '$all == "true"'

ubi8-v11.2.0-scan-no-test-arm64:
  <<: *scan_definition
  <<: *ubi8_11_2_0_arm64_only
  # Override rules from only definition
  needs:
    - job: ubi8-v11.2.0-arm64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_2_0_arm64 == "true" && $NO_TEST == "true"'

ubi8-v11.2.0-deploy-arm64:
  <<: *deploy_definition
  <<: *ubi8_11_2_0_arm64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_2_0_arm64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi8-v11.2.0-arm64
      artifacts: true
    - job: ubi8-v11.2.0-test-arm64
    - job: ubi8-v11.2.0-scan-arm64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi8-v11.2.0-deploy-arm64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_2_0_arm64_only
  rules:
    - if: '$ubi8_11_2_0_arm64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.2.0-arm64
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
ubi8-v11.2.0-deploy-arm64-no-test:
  <<: *deploy_definition
  <<: *ubi8_11_2_0_arm64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_2_0_arm64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi8-v11.2.0-arm64
      artifacts: true
    - job: ubi8-v11.2.0-scan-no-test-arm64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi8-v11.2.0-deploy-arm64-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_2_0_arm64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_2_0_arm64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.2.0-arm64
      artifacts: true
    - job: ubi8-v11.2.0-test-arm64

.ubi7_11_2_0_x86_64_variables: &ubi7_11_2_0_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.2.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi7"
  OS_NAME: "ubi"
  OS_VERSION: "7"
  CUDA_VERSION: "11.2.0"

.ubi7_11_2_0_x86_64_only: &ubi7_11_2_0_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubi7_11_2_0_x86_64_variables
  rules:
    - if: '$ubi7_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v11.2.0-x86_64:
  <<: *cuda_base_definition
  <<: *ubi7_11_2_0_x86_64_only

ubi7-v11.2.0-test-x86_64:
  needs: ["ubi7-v11.2.0-x86_64"]
  <<: *ubi7_11_2_0_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v11.2.0-scan-x86_64:
  <<: *scan_definition
  <<: *ubi7_11_2_0_x86_64_only
  needs:
    - job: ubi7-v11.2.0-x86_64
    - job: ubi7-v11.2.0-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi7_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v11.2.0-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubi7_11_2_0_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubi7-v11.2.0-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_11_2_0_x86_64 == "true" && $NO_TEST == "true"'

ubi7-v11.2.0-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubi7_11_2_0_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi7_11_2_0_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi7-v11.2.0-x86_64
      artifacts: true
    - job: ubi7-v11.2.0-test-x86_64
    - job: ubi7-v11.2.0-scan-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi7-v11.2.0-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi7_11_2_0_x86_64_only
  rules:
    - if: '$ubi7_11_2_0_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v11.2.0-x86_64
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
ubi7-v11.2.0-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubi7_11_2_0_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_11_2_0_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi7-v11.2.0-x86_64
      artifacts: true
    - job: ubi7-v11.2.0-scan-no-test-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi7-v11.2.0-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubi7_11_2_0_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_11_2_0_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v11.2.0-x86_64
      artifacts: true
    - job: ubi7-v11.2.0-test-x86_64

.ubuntu20_04_11_1_1_x86_64_variables: &ubuntu20_04_11_1_1_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.1.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu20.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "20.04"
  CUDA_VERSION: "11.1.1"

.ubuntu20_04_11_1_1_x86_64_only: &ubuntu20_04_11_1_1_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu20_04_11_1_1_x86_64_variables
  rules:
    - if: '$ubuntu20_04_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu20.04-v11.1.1-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu20_04_11_1_1_x86_64_only

ubuntu20.04-v11.1.1-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu20_04_11_1_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu20_04_11_1_1_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubuntu20.04-v11.1.1-x86_64
      artifacts: true

ubuntu20.04-v11.1.1-test-x86_64:
  needs: ["ubuntu20.04-v11.1.1-x86_64"]
  <<: *ubuntu20_04_11_1_1_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu20_04_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu20.04-v11.1.1-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu20_04_11_1_1_x86_64_only
  needs:
    - job: ubuntu20.04-v11.1.1-x86_64
    - job: ubuntu20.04-v11.1.1-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu20_04_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu20.04-v11.1.1-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu20_04_11_1_1_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu20.04-v11.1.1-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu20_04_11_1_1_x86_64 == "true" && $NO_TEST == "true"'

ubuntu20.04-v11.1.1-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu20_04_11_1_1_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu20_04_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu20.04-v11.1.1-x86_64
      artifacts: true
    - job: ubuntu20.04-v11.1.1-test-x86_64
    - job: ubuntu20.04-v11.1.1-scan-x86_64
    - job: ubuntu20.04-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu20.04-v11.1.1-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu20_04_11_1_1_x86_64_only
  rules:
    - if: '$ubuntu20_04_11_1_1_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu20.04-v11.1.1-x86_64
      artifacts: true
    - job: ubuntu20.04-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu20.04-v11.1.1-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu20_04_11_1_1_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu20_04_11_1_1_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu20.04-v11.1.1-x86_64
      artifacts: true
    - job: ubuntu20.04-v11.1.1-scan-no-test-x86_64
    - job: ubuntu20.04-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu20.04-v11.1.1-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu20_04_11_1_1_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu20_04_11_1_1_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu20.04-v11.1.1-x86_64
      artifacts: true
    - job: ubuntu20.04-v11.1.1-test-x86_64
    - job: ubuntu20.04-v11.1.1-cudnn8-x86_64

.ubuntu18_04_11_1_1_x86_64_variables: &ubuntu18_04_11_1_1_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.1.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubuntu18.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "18.04"
  CUDA_VERSION: "11.1.1"

.ubuntu18_04_11_1_1_x86_64_only: &ubuntu18_04_11_1_1_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu18_04_11_1_1_x86_64_variables
  rules:
    - if: '$ubuntu18_04_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.1.1-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu18_04_11_1_1_x86_64_only

ubuntu18.04-v11.1.1-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu18_04_11_1_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu18_04_11_1_1_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubuntu18.04-v11.1.1-x86_64
      artifacts: true

ubuntu18.04-v11.1.1-test-x86_64:
  needs: ["ubuntu18.04-v11.1.1-x86_64"]
  <<: *ubuntu18_04_11_1_1_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.1.1-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu18_04_11_1_1_x86_64_only
  needs:
    - job: ubuntu18.04-v11.1.1-x86_64
    - job: ubuntu18.04-v11.1.1-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.1.1-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu18_04_11_1_1_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu18.04-v11.1.1-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_x86_64 == "true" && $NO_TEST == "true"'

ubuntu18.04-v11.1.1-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_1_1_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu18.04-v11.1.1-x86_64
      artifacts: true
    - job: ubuntu18.04-v11.1.1-test-x86_64
    - job: ubuntu18.04-v11.1.1-scan-x86_64
    - job: ubuntu18.04-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu18.04-v11.1.1-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_1_1_x86_64_only
  rules:
    - if: '$ubuntu18_04_11_1_1_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v11.1.1-x86_64
      artifacts: true
    - job: ubuntu18.04-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu18.04-v11.1.1-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_1_1_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu18.04-v11.1.1-x86_64
      artifacts: true
    - job: ubuntu18.04-v11.1.1-scan-no-test-x86_64
    - job: ubuntu18.04-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu18.04-v11.1.1-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_1_1_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v11.1.1-x86_64
      artifacts: true
    - job: ubuntu18.04-v11.1.1-test-x86_64
    - job: ubuntu18.04-v11.1.1-cudnn8-x86_64

.ubuntu18_04_11_1_1_ppc64le_variables: &ubuntu18_04_11_1_1_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/11.1.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu18.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "18.04"
  CUDA_VERSION: "11.1.1"

.ubuntu18_04_11_1_1_ppc64le_only: &ubuntu18_04_11_1_1_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubuntu18_04_11_1_1_ppc64le_variables
  rules:
    - if: '$ubuntu18_04_11_1_1_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.1.1-ppc64le:
  <<: *cuda_base_definition
  <<: *ubuntu18_04_11_1_1_ppc64le_only

ubuntu18.04-v11.1.1-cudnn8-ppc64le:
  <<: *cudnn_definition
  <<: *ubuntu18_04_11_1_1_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu18_04_11_1_1_ppc64le_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubuntu18.04-v11.1.1-ppc64le
      artifacts: true

ubuntu18.04-v11.1.1-test-ppc64le:
  needs: ["ubuntu18.04-v11.1.1-ppc64le"]
  <<: *ubuntu18_04_11_1_1_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.1.1-scan-ppc64le:
  <<: *scan_definition
  <<: *ubuntu18_04_11_1_1_ppc64le_only
  needs:
    - job: ubuntu18.04-v11.1.1-ppc64le
    - job: ubuntu18.04-v11.1.1-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.1.1-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubuntu18_04_11_1_1_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubuntu18.04-v11.1.1-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_ppc64le == "true" && $NO_TEST == "true"'

ubuntu18.04-v11.1.1-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_1_1_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu18.04-v11.1.1-ppc64le
      artifacts: true
    - job: ubuntu18.04-v11.1.1-test-ppc64le
    - job: ubuntu18.04-v11.1.1-scan-ppc64le
    - job: ubuntu18.04-v11.1.1-cudnn8-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu18.04-v11.1.1-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_1_1_ppc64le_only
  rules:
    - if: '$ubuntu18_04_11_1_1_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v11.1.1-ppc64le
      artifacts: true
    - job: ubuntu18.04-v11.1.1-cudnn8-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu18.04-v11.1.1-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_1_1_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu18.04-v11.1.1-ppc64le
      artifacts: true
    - job: ubuntu18.04-v11.1.1-scan-no-test-ppc64le
    - job: ubuntu18.04-v11.1.1-cudnn8-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu18.04-v11.1.1-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_1_1_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v11.1.1-ppc64le
      artifacts: true
    - job: ubuntu18.04-v11.1.1-test-ppc64le
    - job: ubuntu18.04-v11.1.1-cudnn8-ppc64le

.ubuntu18_04_11_1_1_arm64_variables: &ubuntu18_04_11_1_1_arm64_variables
  ARCH: "arm64"
  DIST_BASE_PATH: "dist/11.1.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-arm64"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu18.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "18.04"
  CUDA_VERSION: "11.1.1"

.ubuntu18_04_11_1_1_arm64_only: &ubuntu18_04_11_1_1_arm64_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubuntu18_04_11_1_1_arm64_variables
  rules:
    - if: '$ubuntu18_04_11_1_1_arm64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.1.1-arm64:
  <<: *cuda_base_definition
  <<: *ubuntu18_04_11_1_1_arm64_only

ubuntu18.04-v11.1.1-cudnn8-arm64:
  <<: *cudnn_definition
  <<: *ubuntu18_04_11_1_1_arm64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu18_04_11_1_1_arm64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubuntu18.04-v11.1.1-arm64
      artifacts: true

ubuntu18.04-v11.1.1-test-arm64:
  needs: ["ubuntu18.04-v11.1.1-arm64"]
  <<: *ubuntu18_04_11_1_1_arm64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_arm64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.1.1-scan-arm64:
  <<: *scan_definition
  <<: *ubuntu18_04_11_1_1_arm64_only
  needs:
    - job: ubuntu18.04-v11.1.1-arm64
    - job: ubuntu18.04-v11.1.1-test-arm64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_arm64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.1.1-scan-no-test-arm64:
  <<: *scan_definition
  <<: *ubuntu18_04_11_1_1_arm64_only
  # Override rules from only definition
  needs:
    - job: ubuntu18.04-v11.1.1-arm64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_arm64 == "true" && $NO_TEST == "true"'

ubuntu18.04-v11.1.1-deploy-arm64:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_1_1_arm64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_arm64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu18.04-v11.1.1-arm64
      artifacts: true
    - job: ubuntu18.04-v11.1.1-test-arm64
    - job: ubuntu18.04-v11.1.1-scan-arm64
    - job: ubuntu18.04-v11.1.1-cudnn8-arm64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu18.04-v11.1.1-deploy-arm64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_1_1_arm64_only
  rules:
    - if: '$ubuntu18_04_11_1_1_arm64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v11.1.1-arm64
      artifacts: true
    - job: ubuntu18.04-v11.1.1-cudnn8-arm64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu18.04-v11.1.1-deploy-arm64-no-test:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_1_1_arm64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_arm64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu18.04-v11.1.1-arm64
      artifacts: true
    - job: ubuntu18.04-v11.1.1-scan-no-test-arm64
    - job: ubuntu18.04-v11.1.1-cudnn8-arm64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu18.04-v11.1.1-deploy-arm64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_1_1_arm64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_1_1_arm64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v11.1.1-arm64
      artifacts: true
    - job: ubuntu18.04-v11.1.1-test-arm64
    - job: ubuntu18.04-v11.1.1-cudnn8-arm64

.ubuntu16_04_11_1_1_x86_64_variables: &ubuntu16_04_11_1_1_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.1.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubuntu16.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "16.04"
  CUDA_VERSION: "11.1.1"

.ubuntu16_04_11_1_1_x86_64_only: &ubuntu16_04_11_1_1_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu16_04_11_1_1_x86_64_variables
  rules:
    - if: '$ubuntu16_04_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v11.1.1-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu16_04_11_1_1_x86_64_only

ubuntu16.04-v11.1.1-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu16_04_11_1_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_11_1_1_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubuntu16.04-v11.1.1-x86_64
      artifacts: true

ubuntu16.04-v11.1.1-test-x86_64:
  needs: ["ubuntu16.04-v11.1.1-x86_64"]
  <<: *ubuntu16_04_11_1_1_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v11.1.1-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_11_1_1_x86_64_only
  needs:
    - job: ubuntu16.04-v11.1.1-x86_64
    - job: ubuntu16.04-v11.1.1-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v11.1.1-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_11_1_1_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu16.04-v11.1.1-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_11_1_1_x86_64 == "true" && $NO_TEST == "true"'

ubuntu16.04-v11.1.1-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu16_04_11_1_1_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu16.04-v11.1.1-x86_64
      artifacts: true
    - job: ubuntu16.04-v11.1.1-test-x86_64
    - job: ubuntu16.04-v11.1.1-scan-x86_64
    - job: ubuntu16.04-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu16.04-v11.1.1-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_11_1_1_x86_64_only
  rules:
    - if: '$ubuntu16_04_11_1_1_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v11.1.1-x86_64
      artifacts: true
    - job: ubuntu16.04-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu16.04-v11.1.1-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu16_04_11_1_1_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_11_1_1_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu16.04-v11.1.1-x86_64
      artifacts: true
    - job: ubuntu16.04-v11.1.1-scan-no-test-x86_64
    - job: ubuntu16.04-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu16.04-v11.1.1-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_11_1_1_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_11_1_1_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v11.1.1-x86_64
      artifacts: true
    - job: ubuntu16.04-v11.1.1-test-x86_64
    - job: ubuntu16.04-v11.1.1-cudnn8-x86_64

.centos8_11_1_1_x86_64_variables: &centos8_11_1_1_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.1.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos8"
  OS_NAME: "centos"
  OS_VERSION: "8"
  CUDA_VERSION: "11.1.1"

.centos8_11_1_1_x86_64_only: &centos8_11_1_1_x86_64_only
  <<: *tags_definition
  variables:
    <<: *centos8_11_1_1_x86_64_variables
  rules:
    - if: '$centos8_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

centos8-v11.1.1-x86_64:
  <<: *cuda_base_definition
  <<: *centos8_11_1_1_x86_64_only

centos8-v11.1.1-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *centos8_11_1_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos8_11_1_1_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: centos8-v11.1.1-x86_64
      artifacts: true

centos8-v11.1.1-test-x86_64:
  needs: ["centos8-v11.1.1-x86_64"]
  <<: *centos8_11_1_1_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

centos8-v11.1.1-scan-x86_64:
  <<: *scan_definition
  <<: *centos8_11_1_1_x86_64_only
  needs:
    - job: centos8-v11.1.1-x86_64
    - job: centos8-v11.1.1-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos8_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

centos8-v11.1.1-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *centos8_11_1_1_x86_64_only
  # Override rules from only definition
  needs:
    - job: centos8-v11.1.1-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_1_1_x86_64 == "true" && $NO_TEST == "true"'

centos8-v11.1.1-deploy-x86_64:
  <<: *deploy_definition
  <<: *centos8_11_1_1_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos8-v11.1.1-x86_64
      artifacts: true
    - job: centos8-v11.1.1-test-x86_64
    - job: centos8-v11.1.1-scan-x86_64
    - job: centos8-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos8-v11.1.1-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_1_1_x86_64_only
  rules:
    - if: '$centos8_11_1_1_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.1.1-x86_64
      artifacts: true
    - job: centos8-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
centos8-v11.1.1-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *centos8_11_1_1_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_1_1_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos8-v11.1.1-x86_64
      artifacts: true
    - job: centos8-v11.1.1-scan-no-test-x86_64
    - job: centos8-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
centos8-v11.1.1-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_1_1_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_1_1_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.1.1-x86_64
      artifacts: true
    - job: centos8-v11.1.1-test-x86_64
    - job: centos8-v11.1.1-cudnn8-x86_64

.centos8_11_1_1_ppc64le_variables: &centos8_11_1_1_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/11.1.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos8"
  OS_NAME: "centos"
  OS_VERSION: "8"
  CUDA_VERSION: "11.1.1"

.centos8_11_1_1_ppc64le_only: &centos8_11_1_1_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *centos8_11_1_1_ppc64le_variables
  rules:
    - if: '$centos8_11_1_1_ppc64le == "true"'
    - if: '$all == "true"'

centos8-v11.1.1-ppc64le:
  <<: *cuda_base_definition
  <<: *centos8_11_1_1_ppc64le_only

centos8-v11.1.1-test-ppc64le:
  needs: ["centos8-v11.1.1-ppc64le"]
  <<: *centos8_11_1_1_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_1_1_ppc64le == "true"'
    - if: '$all == "true"'

centos8-v11.1.1-scan-ppc64le:
  <<: *scan_definition
  <<: *centos8_11_1_1_ppc64le_only
  needs:
    - job: centos8-v11.1.1-ppc64le
    - job: centos8-v11.1.1-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos8_11_1_1_ppc64le == "true"'
    - if: '$all == "true"'

centos8-v11.1.1-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *centos8_11_1_1_ppc64le_only
  # Override rules from only definition
  needs:
    - job: centos8-v11.1.1-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_1_1_ppc64le == "true" && $NO_TEST == "true"'

centos8-v11.1.1-deploy-ppc64le:
  <<: *deploy_definition
  <<: *centos8_11_1_1_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_1_1_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos8-v11.1.1-ppc64le
      artifacts: true
    - job: centos8-v11.1.1-test-ppc64le
    - job: centos8-v11.1.1-scan-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos8-v11.1.1-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_1_1_ppc64le_only
  rules:
    - if: '$centos8_11_1_1_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.1.1-ppc64le
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
centos8-v11.1.1-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *centos8_11_1_1_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_1_1_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: centos8-v11.1.1-ppc64le
      artifacts: true
    - job: centos8-v11.1.1-scan-no-test-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
centos8-v11.1.1-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_1_1_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_1_1_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.1.1-ppc64le
      artifacts: true
    - job: centos8-v11.1.1-test-ppc64le

.centos8_11_1_1_arm64_variables: &centos8_11_1_1_arm64_variables
  ARCH: "arm64"
  DIST_BASE_PATH: "dist/11.1.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-arm64"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos8"
  OS_NAME: "centos"
  OS_VERSION: "8"
  CUDA_VERSION: "11.1.1"

.centos8_11_1_1_arm64_only: &centos8_11_1_1_arm64_only
  <<: *tags_definition_multiarch
  variables:
    <<: *centos8_11_1_1_arm64_variables
  rules:
    - if: '$centos8_11_1_1_arm64 == "true"'
    - if: '$all == "true"'

centos8-v11.1.1-arm64:
  <<: *cuda_base_definition
  <<: *centos8_11_1_1_arm64_only

centos8-v11.1.1-cudnn8-arm64:
  <<: *cudnn_definition
  <<: *centos8_11_1_1_arm64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos8_11_1_1_arm64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: centos8-v11.1.1-arm64
      artifacts: true

centos8-v11.1.1-test-arm64:
  needs: ["centos8-v11.1.1-arm64"]
  <<: *centos8_11_1_1_arm64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_1_1_arm64 == "true"'
    - if: '$all == "true"'

centos8-v11.1.1-scan-arm64:
  <<: *scan_definition
  <<: *centos8_11_1_1_arm64_only
  needs:
    - job: centos8-v11.1.1-arm64
    - job: centos8-v11.1.1-test-arm64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos8_11_1_1_arm64 == "true"'
    - if: '$all == "true"'

centos8-v11.1.1-scan-no-test-arm64:
  <<: *scan_definition
  <<: *centos8_11_1_1_arm64_only
  # Override rules from only definition
  needs:
    - job: centos8-v11.1.1-arm64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_1_1_arm64 == "true" && $NO_TEST == "true"'

centos8-v11.1.1-deploy-arm64:
  <<: *deploy_definition
  <<: *centos8_11_1_1_arm64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_1_1_arm64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos8-v11.1.1-arm64
      artifacts: true
    - job: centos8-v11.1.1-test-arm64
    - job: centos8-v11.1.1-scan-arm64
    - job: centos8-v11.1.1-cudnn8-arm64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos8-v11.1.1-deploy-arm64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_1_1_arm64_only
  rules:
    - if: '$centos8_11_1_1_arm64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.1.1-arm64
      artifacts: true
    - job: centos8-v11.1.1-cudnn8-arm64

# workaround for gitlab ci rules when NO_TEST is used...
centos8-v11.1.1-deploy-arm64-no-test:
  <<: *deploy_definition
  <<: *centos8_11_1_1_arm64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_1_1_arm64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos8-v11.1.1-arm64
      artifacts: true
    - job: centos8-v11.1.1-scan-no-test-arm64
    - job: centos8-v11.1.1-cudnn8-arm64

# workaround for gitlab ci rules when NO_SCAN is used...
centos8-v11.1.1-deploy-arm64-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_1_1_arm64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_1_1_arm64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.1.1-arm64
      artifacts: true
    - job: centos8-v11.1.1-test-arm64
    - job: centos8-v11.1.1-cudnn8-arm64

.centos7_11_1_1_x86_64_variables: &centos7_11_1_1_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.1.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos7"
  OS_NAME: "centos"
  OS_VERSION: "7"
  CUDA_VERSION: "11.1.1"

.centos7_11_1_1_x86_64_only: &centos7_11_1_1_x86_64_only
  <<: *tags_definition
  variables:
    <<: *centos7_11_1_1_x86_64_variables
  rules:
    - if: '$centos7_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v11.1.1-x86_64:
  <<: *cuda_base_definition
  <<: *centos7_11_1_1_x86_64_only

centos7-v11.1.1-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *centos7_11_1_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_11_1_1_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: centos7-v11.1.1-x86_64
      artifacts: true

centos7-v11.1.1-test-x86_64:
  needs: ["centos7-v11.1.1-x86_64"]
  <<: *centos7_11_1_1_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v11.1.1-scan-x86_64:
  <<: *scan_definition
  <<: *centos7_11_1_1_x86_64_only
  needs:
    - job: centos7-v11.1.1-x86_64
    - job: centos7-v11.1.1-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos7_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v11.1.1-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *centos7_11_1_1_x86_64_only
  # Override rules from only definition
  needs:
    - job: centos7-v11.1.1-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_11_1_1_x86_64 == "true" && $NO_TEST == "true"'

centos7-v11.1.1-deploy-x86_64:
  <<: *deploy_definition
  <<: *centos7_11_1_1_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos7_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos7-v11.1.1-x86_64
      artifacts: true
    - job: centos7-v11.1.1-test-x86_64
    - job: centos7-v11.1.1-scan-x86_64
    - job: centos7-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos7-v11.1.1-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos7_11_1_1_x86_64_only
  rules:
    - if: '$centos7_11_1_1_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v11.1.1-x86_64
      artifacts: true
    - job: centos7-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
centos7-v11.1.1-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *centos7_11_1_1_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_11_1_1_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos7-v11.1.1-x86_64
      artifacts: true
    - job: centos7-v11.1.1-scan-no-test-x86_64
    - job: centos7-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
centos7-v11.1.1-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *centos7_11_1_1_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_11_1_1_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v11.1.1-x86_64
      artifacts: true
    - job: centos7-v11.1.1-test-x86_64
    - job: centos7-v11.1.1-cudnn8-x86_64

.ubi8_11_1_1_x86_64_variables: &ubi8_11_1_1_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.1.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi8"
  OS_NAME: "ubi"
  OS_VERSION: "8"
  CUDA_VERSION: "11.1.1"

.ubi8_11_1_1_x86_64_only: &ubi8_11_1_1_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubi8_11_1_1_x86_64_variables
  rules:
    - if: '$ubi8_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

ubi8-v11.1.1-x86_64:
  <<: *cuda_base_definition
  <<: *ubi8_11_1_1_x86_64_only

ubi8-v11.1.1-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *ubi8_11_1_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi8_11_1_1_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubi8-v11.1.1-x86_64
      artifacts: true

ubi8-v11.1.1-test-x86_64:
  needs: ["ubi8-v11.1.1-x86_64"]
  <<: *ubi8_11_1_1_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

ubi8-v11.1.1-scan-x86_64:
  <<: *scan_definition
  <<: *ubi8_11_1_1_x86_64_only
  needs:
    - job: ubi8-v11.1.1-x86_64
    - job: ubi8-v11.1.1-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

ubi8-v11.1.1-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubi8_11_1_1_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubi8-v11.1.1-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_1_1_x86_64 == "true" && $NO_TEST == "true"'

ubi8-v11.1.1-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubi8_11_1_1_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi8-v11.1.1-x86_64
      artifacts: true
    - job: ubi8-v11.1.1-test-x86_64
    - job: ubi8-v11.1.1-scan-x86_64
    - job: ubi8-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi8-v11.1.1-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_1_1_x86_64_only
  rules:
    - if: '$ubi8_11_1_1_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.1.1-x86_64
      artifacts: true
    - job: ubi8-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubi8-v11.1.1-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubi8_11_1_1_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_1_1_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi8-v11.1.1-x86_64
      artifacts: true
    - job: ubi8-v11.1.1-scan-no-test-x86_64
    - job: ubi8-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi8-v11.1.1-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_1_1_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_1_1_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.1.1-x86_64
      artifacts: true
    - job: ubi8-v11.1.1-test-x86_64
    - job: ubi8-v11.1.1-cudnn8-x86_64

.ubi8_11_1_1_ppc64le_variables: &ubi8_11_1_1_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/11.1.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi8"
  OS_NAME: "ubi"
  OS_VERSION: "8"
  CUDA_VERSION: "11.1.1"

.ubi8_11_1_1_ppc64le_only: &ubi8_11_1_1_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubi8_11_1_1_ppc64le_variables
  rules:
    - if: '$ubi8_11_1_1_ppc64le == "true"'
    - if: '$all == "true"'

ubi8-v11.1.1-ppc64le:
  <<: *cuda_base_definition
  <<: *ubi8_11_1_1_ppc64le_only

ubi8-v11.1.1-test-ppc64le:
  needs: ["ubi8-v11.1.1-ppc64le"]
  <<: *ubi8_11_1_1_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_1_1_ppc64le == "true"'
    - if: '$all == "true"'

ubi8-v11.1.1-scan-ppc64le:
  <<: *scan_definition
  <<: *ubi8_11_1_1_ppc64le_only
  needs:
    - job: ubi8-v11.1.1-ppc64le
    - job: ubi8-v11.1.1-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_1_1_ppc64le == "true"'
    - if: '$all == "true"'

ubi8-v11.1.1-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubi8_11_1_1_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubi8-v11.1.1-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_1_1_ppc64le == "true" && $NO_TEST == "true"'

ubi8-v11.1.1-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubi8_11_1_1_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_1_1_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi8-v11.1.1-ppc64le
      artifacts: true
    - job: ubi8-v11.1.1-test-ppc64le
    - job: ubi8-v11.1.1-scan-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi8-v11.1.1-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_1_1_ppc64le_only
  rules:
    - if: '$ubi8_11_1_1_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.1.1-ppc64le
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
ubi8-v11.1.1-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubi8_11_1_1_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_1_1_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi8-v11.1.1-ppc64le
      artifacts: true
    - job: ubi8-v11.1.1-scan-no-test-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubi8-v11.1.1-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_1_1_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_1_1_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.1.1-ppc64le
      artifacts: true
    - job: ubi8-v11.1.1-test-ppc64le

.ubi8_11_1_1_arm64_variables: &ubi8_11_1_1_arm64_variables
  ARCH: "arm64"
  DIST_BASE_PATH: "dist/11.1.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-arm64"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi8"
  OS_NAME: "ubi"
  OS_VERSION: "8"
  CUDA_VERSION: "11.1.1"

.ubi8_11_1_1_arm64_only: &ubi8_11_1_1_arm64_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubi8_11_1_1_arm64_variables
  rules:
    - if: '$ubi8_11_1_1_arm64 == "true"'
    - if: '$all == "true"'

ubi8-v11.1.1-arm64:
  <<: *cuda_base_definition
  <<: *ubi8_11_1_1_arm64_only

ubi8-v11.1.1-cudnn8-arm64:
  <<: *cudnn_definition
  <<: *ubi8_11_1_1_arm64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi8_11_1_1_arm64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubi8-v11.1.1-arm64
      artifacts: true

ubi8-v11.1.1-test-arm64:
  needs: ["ubi8-v11.1.1-arm64"]
  <<: *ubi8_11_1_1_arm64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_1_1_arm64 == "true"'
    - if: '$all == "true"'

ubi8-v11.1.1-scan-arm64:
  <<: *scan_definition
  <<: *ubi8_11_1_1_arm64_only
  needs:
    - job: ubi8-v11.1.1-arm64
    - job: ubi8-v11.1.1-test-arm64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_1_1_arm64 == "true"'
    - if: '$all == "true"'

ubi8-v11.1.1-scan-no-test-arm64:
  <<: *scan_definition
  <<: *ubi8_11_1_1_arm64_only
  # Override rules from only definition
  needs:
    - job: ubi8-v11.1.1-arm64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_1_1_arm64 == "true" && $NO_TEST == "true"'

ubi8-v11.1.1-deploy-arm64:
  <<: *deploy_definition
  <<: *ubi8_11_1_1_arm64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_1_1_arm64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi8-v11.1.1-arm64
      artifacts: true
    - job: ubi8-v11.1.1-test-arm64
    - job: ubi8-v11.1.1-scan-arm64
    - job: ubi8-v11.1.1-cudnn8-arm64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi8-v11.1.1-deploy-arm64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_1_1_arm64_only
  rules:
    - if: '$ubi8_11_1_1_arm64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.1.1-arm64
      artifacts: true
    - job: ubi8-v11.1.1-cudnn8-arm64

# workaround for gitlab ci rules when NO_TEST is used...
ubi8-v11.1.1-deploy-arm64-no-test:
  <<: *deploy_definition
  <<: *ubi8_11_1_1_arm64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_1_1_arm64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi8-v11.1.1-arm64
      artifacts: true
    - job: ubi8-v11.1.1-scan-no-test-arm64
    - job: ubi8-v11.1.1-cudnn8-arm64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi8-v11.1.1-deploy-arm64-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_1_1_arm64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_1_1_arm64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.1.1-arm64
      artifacts: true
    - job: ubi8-v11.1.1-test-arm64
    - job: ubi8-v11.1.1-cudnn8-arm64

.ubi7_11_1_1_x86_64_variables: &ubi7_11_1_1_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.1.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi7"
  OS_NAME: "ubi"
  OS_VERSION: "7"
  CUDA_VERSION: "11.1.1"

.ubi7_11_1_1_x86_64_only: &ubi7_11_1_1_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubi7_11_1_1_x86_64_variables
  rules:
    - if: '$ubi7_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v11.1.1-x86_64:
  <<: *cuda_base_definition
  <<: *ubi7_11_1_1_x86_64_only

ubi7-v11.1.1-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *ubi7_11_1_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_11_1_1_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubi7-v11.1.1-x86_64
      artifacts: true

ubi7-v11.1.1-test-x86_64:
  needs: ["ubi7-v11.1.1-x86_64"]
  <<: *ubi7_11_1_1_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v11.1.1-scan-x86_64:
  <<: *scan_definition
  <<: *ubi7_11_1_1_x86_64_only
  needs:
    - job: ubi7-v11.1.1-x86_64
    - job: ubi7-v11.1.1-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi7_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v11.1.1-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubi7_11_1_1_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubi7-v11.1.1-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_11_1_1_x86_64 == "true" && $NO_TEST == "true"'

ubi7-v11.1.1-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubi7_11_1_1_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi7_11_1_1_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi7-v11.1.1-x86_64
      artifacts: true
    - job: ubi7-v11.1.1-test-x86_64
    - job: ubi7-v11.1.1-scan-x86_64
    - job: ubi7-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi7-v11.1.1-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi7_11_1_1_x86_64_only
  rules:
    - if: '$ubi7_11_1_1_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v11.1.1-x86_64
      artifacts: true
    - job: ubi7-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubi7-v11.1.1-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubi7_11_1_1_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_11_1_1_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi7-v11.1.1-x86_64
      artifacts: true
    - job: ubi7-v11.1.1-scan-no-test-x86_64
    - job: ubi7-v11.1.1-cudnn8-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi7-v11.1.1-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubi7_11_1_1_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_11_1_1_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v11.1.1-x86_64
      artifacts: true
    - job: ubi7-v11.1.1-test-x86_64
    - job: ubi7-v11.1.1-cudnn8-x86_64

.ubuntu20_04_11_0_3_x86_64_variables: &ubuntu20_04_11_0_3_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.0.3"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubuntu20.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "20.04"
  CUDA_VERSION: "11.0.3"

.ubuntu20_04_11_0_3_x86_64_only: &ubuntu20_04_11_0_3_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu20_04_11_0_3_x86_64_variables
  rules:
    - if: '$ubuntu20_04_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu20.04-v11.0.3-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu20_04_11_0_3_x86_64_only

ubuntu20.04-v11.0.3-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu20_04_11_0_3_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu20_04_11_0_3_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubuntu20.04-v11.0.3-x86_64
      artifacts: true

ubuntu20.04-v11.0.3-test-x86_64:
  needs: ["ubuntu20.04-v11.0.3-x86_64"]
  <<: *ubuntu20_04_11_0_3_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu20_04_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu20.04-v11.0.3-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu20_04_11_0_3_x86_64_only
  needs:
    - job: ubuntu20.04-v11.0.3-x86_64
    - job: ubuntu20.04-v11.0.3-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu20_04_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu20.04-v11.0.3-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu20_04_11_0_3_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu20.04-v11.0.3-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu20_04_11_0_3_x86_64 == "true" && $NO_TEST == "true"'

ubuntu20.04-v11.0.3-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu20_04_11_0_3_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu20_04_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu20.04-v11.0.3-x86_64
      artifacts: true
    - job: ubuntu20.04-v11.0.3-test-x86_64
    - job: ubuntu20.04-v11.0.3-scan-x86_64
    - job: ubuntu20.04-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu20.04-v11.0.3-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu20_04_11_0_3_x86_64_only
  rules:
    - if: '$ubuntu20_04_11_0_3_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu20.04-v11.0.3-x86_64
      artifacts: true
    - job: ubuntu20.04-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu20.04-v11.0.3-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu20_04_11_0_3_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu20_04_11_0_3_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu20.04-v11.0.3-x86_64
      artifacts: true
    - job: ubuntu20.04-v11.0.3-scan-no-test-x86_64
    - job: ubuntu20.04-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu20.04-v11.0.3-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu20_04_11_0_3_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu20_04_11_0_3_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu20.04-v11.0.3-x86_64
      artifacts: true
    - job: ubuntu20.04-v11.0.3-test-x86_64
    - job: ubuntu20.04-v11.0.3-cudnn8-x86_64

.ubuntu18_04_11_0_3_x86_64_variables: &ubuntu18_04_11_0_3_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.0.3"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubuntu18.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "18.04"
  CUDA_VERSION: "11.0.3"

.ubuntu18_04_11_0_3_x86_64_only: &ubuntu18_04_11_0_3_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu18_04_11_0_3_x86_64_variables
  rules:
    - if: '$ubuntu18_04_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.0.3-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu18_04_11_0_3_x86_64_only

ubuntu18.04-v11.0.3-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu18_04_11_0_3_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu18_04_11_0_3_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubuntu18.04-v11.0.3-x86_64
      artifacts: true

ubuntu18.04-v11.0.3-test-x86_64:
  needs: ["ubuntu18.04-v11.0.3-x86_64"]
  <<: *ubuntu18_04_11_0_3_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.0.3-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu18_04_11_0_3_x86_64_only
  needs:
    - job: ubuntu18.04-v11.0.3-x86_64
    - job: ubuntu18.04-v11.0.3-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.0.3-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu18_04_11_0_3_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu18.04-v11.0.3-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_x86_64 == "true" && $NO_TEST == "true"'

ubuntu18.04-v11.0.3-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_0_3_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu18.04-v11.0.3-x86_64
      artifacts: true
    - job: ubuntu18.04-v11.0.3-test-x86_64
    - job: ubuntu18.04-v11.0.3-scan-x86_64
    - job: ubuntu18.04-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu18.04-v11.0.3-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_0_3_x86_64_only
  rules:
    - if: '$ubuntu18_04_11_0_3_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v11.0.3-x86_64
      artifacts: true
    - job: ubuntu18.04-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu18.04-v11.0.3-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_0_3_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu18.04-v11.0.3-x86_64
      artifacts: true
    - job: ubuntu18.04-v11.0.3-scan-no-test-x86_64
    - job: ubuntu18.04-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu18.04-v11.0.3-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_0_3_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v11.0.3-x86_64
      artifacts: true
    - job: ubuntu18.04-v11.0.3-test-x86_64
    - job: ubuntu18.04-v11.0.3-cudnn8-x86_64

.ubuntu18_04_11_0_3_ppc64le_variables: &ubuntu18_04_11_0_3_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/11.0.3"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubuntu18.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "18.04"
  CUDA_VERSION: "11.0.3"

.ubuntu18_04_11_0_3_ppc64le_only: &ubuntu18_04_11_0_3_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubuntu18_04_11_0_3_ppc64le_variables
  rules:
    - if: '$ubuntu18_04_11_0_3_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.0.3-ppc64le:
  <<: *cuda_base_definition
  <<: *ubuntu18_04_11_0_3_ppc64le_only

ubuntu18.04-v11.0.3-cudnn8-ppc64le:
  <<: *cudnn_definition
  <<: *ubuntu18_04_11_0_3_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu18_04_11_0_3_ppc64le_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubuntu18.04-v11.0.3-ppc64le
      artifacts: true

ubuntu18.04-v11.0.3-test-ppc64le:
  needs: ["ubuntu18.04-v11.0.3-ppc64le"]
  <<: *ubuntu18_04_11_0_3_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.0.3-scan-ppc64le:
  <<: *scan_definition
  <<: *ubuntu18_04_11_0_3_ppc64le_only
  needs:
    - job: ubuntu18.04-v11.0.3-ppc64le
    - job: ubuntu18.04-v11.0.3-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.0.3-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubuntu18_04_11_0_3_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubuntu18.04-v11.0.3-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_ppc64le == "true" && $NO_TEST == "true"'

ubuntu18.04-v11.0.3-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_0_3_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu18.04-v11.0.3-ppc64le
      artifacts: true
    - job: ubuntu18.04-v11.0.3-test-ppc64le
    - job: ubuntu18.04-v11.0.3-scan-ppc64le
    - job: ubuntu18.04-v11.0.3-cudnn8-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu18.04-v11.0.3-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_0_3_ppc64le_only
  rules:
    - if: '$ubuntu18_04_11_0_3_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v11.0.3-ppc64le
      artifacts: true
    - job: ubuntu18.04-v11.0.3-cudnn8-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu18.04-v11.0.3-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_0_3_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu18.04-v11.0.3-ppc64le
      artifacts: true
    - job: ubuntu18.04-v11.0.3-scan-no-test-ppc64le
    - job: ubuntu18.04-v11.0.3-cudnn8-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu18.04-v11.0.3-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_0_3_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v11.0.3-ppc64le
      artifacts: true
    - job: ubuntu18.04-v11.0.3-test-ppc64le
    - job: ubuntu18.04-v11.0.3-cudnn8-ppc64le

.ubuntu18_04_11_0_3_arm64_variables: &ubuntu18_04_11_0_3_arm64_variables
  ARCH: "arm64"
  DIST_BASE_PATH: "dist/11.0.3"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-arm64"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubuntu18.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "18.04"
  CUDA_VERSION: "11.0.3"

.ubuntu18_04_11_0_3_arm64_only: &ubuntu18_04_11_0_3_arm64_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubuntu18_04_11_0_3_arm64_variables
  rules:
    - if: '$ubuntu18_04_11_0_3_arm64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.0.3-arm64:
  <<: *cuda_base_definition
  <<: *ubuntu18_04_11_0_3_arm64_only

ubuntu18.04-v11.0.3-test-arm64:
  needs: ["ubuntu18.04-v11.0.3-arm64"]
  <<: *ubuntu18_04_11_0_3_arm64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_arm64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.0.3-scan-arm64:
  <<: *scan_definition
  <<: *ubuntu18_04_11_0_3_arm64_only
  needs:
    - job: ubuntu18.04-v11.0.3-arm64
    - job: ubuntu18.04-v11.0.3-test-arm64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_arm64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v11.0.3-scan-no-test-arm64:
  <<: *scan_definition
  <<: *ubuntu18_04_11_0_3_arm64_only
  # Override rules from only definition
  needs:
    - job: ubuntu18.04-v11.0.3-arm64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_arm64 == "true" && $NO_TEST == "true"'

ubuntu18.04-v11.0.3-deploy-arm64:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_0_3_arm64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_arm64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu18.04-v11.0.3-arm64
      artifacts: true
    - job: ubuntu18.04-v11.0.3-test-arm64
    - job: ubuntu18.04-v11.0.3-scan-arm64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu18.04-v11.0.3-deploy-arm64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_0_3_arm64_only
  rules:
    - if: '$ubuntu18_04_11_0_3_arm64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v11.0.3-arm64
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu18.04-v11.0.3-deploy-arm64-no-test:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_0_3_arm64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_arm64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu18.04-v11.0.3-arm64
      artifacts: true
    - job: ubuntu18.04-v11.0.3-scan-no-test-arm64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu18.04-v11.0.3-deploy-arm64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_11_0_3_arm64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_11_0_3_arm64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v11.0.3-arm64
      artifacts: true
    - job: ubuntu18.04-v11.0.3-test-arm64

.ubuntu16_04_11_0_3_x86_64_variables: &ubuntu16_04_11_0_3_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.0.3"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubuntu16.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "16.04"
  CUDA_VERSION: "11.0.3"

.ubuntu16_04_11_0_3_x86_64_only: &ubuntu16_04_11_0_3_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu16_04_11_0_3_x86_64_variables
  rules:
    - if: '$ubuntu16_04_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v11.0.3-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu16_04_11_0_3_x86_64_only

ubuntu16.04-v11.0.3-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu16_04_11_0_3_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_11_0_3_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubuntu16.04-v11.0.3-x86_64
      artifacts: true

ubuntu16.04-v11.0.3-test-x86_64:
  needs: ["ubuntu16.04-v11.0.3-x86_64"]
  <<: *ubuntu16_04_11_0_3_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v11.0.3-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_11_0_3_x86_64_only
  needs:
    - job: ubuntu16.04-v11.0.3-x86_64
    - job: ubuntu16.04-v11.0.3-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v11.0.3-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_11_0_3_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu16.04-v11.0.3-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_11_0_3_x86_64 == "true" && $NO_TEST == "true"'

ubuntu16.04-v11.0.3-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu16_04_11_0_3_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu16.04-v11.0.3-x86_64
      artifacts: true
    - job: ubuntu16.04-v11.0.3-test-x86_64
    - job: ubuntu16.04-v11.0.3-scan-x86_64
    - job: ubuntu16.04-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu16.04-v11.0.3-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_11_0_3_x86_64_only
  rules:
    - if: '$ubuntu16_04_11_0_3_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v11.0.3-x86_64
      artifacts: true
    - job: ubuntu16.04-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu16.04-v11.0.3-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu16_04_11_0_3_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_11_0_3_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu16.04-v11.0.3-x86_64
      artifacts: true
    - job: ubuntu16.04-v11.0.3-scan-no-test-x86_64
    - job: ubuntu16.04-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu16.04-v11.0.3-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_11_0_3_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_11_0_3_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v11.0.3-x86_64
      artifacts: true
    - job: ubuntu16.04-v11.0.3-test-x86_64
    - job: ubuntu16.04-v11.0.3-cudnn8-x86_64

.centos8_11_0_3_x86_64_variables: &centos8_11_0_3_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.0.3"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos8"
  OS_NAME: "centos"
  OS_VERSION: "8"
  CUDA_VERSION: "11.0.3"

.centos8_11_0_3_x86_64_only: &centos8_11_0_3_x86_64_only
  <<: *tags_definition
  variables:
    <<: *centos8_11_0_3_x86_64_variables
  rules:
    - if: '$centos8_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

centos8-v11.0.3-x86_64:
  <<: *cuda_base_definition
  <<: *centos8_11_0_3_x86_64_only

centos8-v11.0.3-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *centos8_11_0_3_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos8_11_0_3_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: centos8-v11.0.3-x86_64
      artifacts: true

centos8-v11.0.3-test-x86_64:
  needs: ["centos8-v11.0.3-x86_64"]
  <<: *centos8_11_0_3_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

centos8-v11.0.3-scan-x86_64:
  <<: *scan_definition
  <<: *centos8_11_0_3_x86_64_only
  needs:
    - job: centos8-v11.0.3-x86_64
    - job: centos8-v11.0.3-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos8_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

centos8-v11.0.3-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *centos8_11_0_3_x86_64_only
  # Override rules from only definition
  needs:
    - job: centos8-v11.0.3-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_0_3_x86_64 == "true" && $NO_TEST == "true"'

centos8-v11.0.3-deploy-x86_64:
  <<: *deploy_definition
  <<: *centos8_11_0_3_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos8-v11.0.3-x86_64
      artifacts: true
    - job: centos8-v11.0.3-test-x86_64
    - job: centos8-v11.0.3-scan-x86_64
    - job: centos8-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos8-v11.0.3-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_0_3_x86_64_only
  rules:
    - if: '$centos8_11_0_3_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.0.3-x86_64
      artifacts: true
    - job: centos8-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
centos8-v11.0.3-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *centos8_11_0_3_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_0_3_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos8-v11.0.3-x86_64
      artifacts: true
    - job: centos8-v11.0.3-scan-no-test-x86_64
    - job: centos8-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
centos8-v11.0.3-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_0_3_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_0_3_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.0.3-x86_64
      artifacts: true
    - job: centos8-v11.0.3-test-x86_64
    - job: centos8-v11.0.3-cudnn8-x86_64

.centos8_11_0_3_ppc64le_variables: &centos8_11_0_3_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/11.0.3"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos8"
  OS_NAME: "centos"
  OS_VERSION: "8"
  CUDA_VERSION: "11.0.3"

.centos8_11_0_3_ppc64le_only: &centos8_11_0_3_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *centos8_11_0_3_ppc64le_variables
  rules:
    - if: '$centos8_11_0_3_ppc64le == "true"'
    - if: '$all == "true"'

centos8-v11.0.3-ppc64le:
  <<: *cuda_base_definition
  <<: *centos8_11_0_3_ppc64le_only

centos8-v11.0.3-test-ppc64le:
  needs: ["centos8-v11.0.3-ppc64le"]
  <<: *centos8_11_0_3_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_0_3_ppc64le == "true"'
    - if: '$all == "true"'

centos8-v11.0.3-scan-ppc64le:
  <<: *scan_definition
  <<: *centos8_11_0_3_ppc64le_only
  needs:
    - job: centos8-v11.0.3-ppc64le
    - job: centos8-v11.0.3-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos8_11_0_3_ppc64le == "true"'
    - if: '$all == "true"'

centos8-v11.0.3-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *centos8_11_0_3_ppc64le_only
  # Override rules from only definition
  needs:
    - job: centos8-v11.0.3-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_0_3_ppc64le == "true" && $NO_TEST == "true"'

centos8-v11.0.3-deploy-ppc64le:
  <<: *deploy_definition
  <<: *centos8_11_0_3_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_0_3_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos8-v11.0.3-ppc64le
      artifacts: true
    - job: centos8-v11.0.3-test-ppc64le
    - job: centos8-v11.0.3-scan-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos8-v11.0.3-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_0_3_ppc64le_only
  rules:
    - if: '$centos8_11_0_3_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.0.3-ppc64le
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
centos8-v11.0.3-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *centos8_11_0_3_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_0_3_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: centos8-v11.0.3-ppc64le
      artifacts: true
    - job: centos8-v11.0.3-scan-no-test-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
centos8-v11.0.3-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_0_3_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_0_3_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.0.3-ppc64le
      artifacts: true
    - job: centos8-v11.0.3-test-ppc64le

.centos8_11_0_3_arm64_variables: &centos8_11_0_3_arm64_variables
  ARCH: "arm64"
  DIST_BASE_PATH: "dist/11.0.3"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-arm64"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos8"
  OS_NAME: "centos"
  OS_VERSION: "8"
  CUDA_VERSION: "11.0.3"

.centos8_11_0_3_arm64_only: &centos8_11_0_3_arm64_only
  <<: *tags_definition_multiarch
  variables:
    <<: *centos8_11_0_3_arm64_variables
  rules:
    - if: '$centos8_11_0_3_arm64 == "true"'
    - if: '$all == "true"'

centos8-v11.0.3-arm64:
  <<: *cuda_base_definition
  <<: *centos8_11_0_3_arm64_only

centos8-v11.0.3-test-arm64:
  needs: ["centos8-v11.0.3-arm64"]
  <<: *centos8_11_0_3_arm64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_0_3_arm64 == "true"'
    - if: '$all == "true"'

centos8-v11.0.3-scan-arm64:
  <<: *scan_definition
  <<: *centos8_11_0_3_arm64_only
  needs:
    - job: centos8-v11.0.3-arm64
    - job: centos8-v11.0.3-test-arm64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos8_11_0_3_arm64 == "true"'
    - if: '$all == "true"'

centos8-v11.0.3-scan-no-test-arm64:
  <<: *scan_definition
  <<: *centos8_11_0_3_arm64_only
  # Override rules from only definition
  needs:
    - job: centos8-v11.0.3-arm64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_0_3_arm64 == "true" && $NO_TEST == "true"'

centos8-v11.0.3-deploy-arm64:
  <<: *deploy_definition
  <<: *centos8_11_0_3_arm64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_0_3_arm64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos8-v11.0.3-arm64
      artifacts: true
    - job: centos8-v11.0.3-test-arm64
    - job: centos8-v11.0.3-scan-arm64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos8-v11.0.3-deploy-arm64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_0_3_arm64_only
  rules:
    - if: '$centos8_11_0_3_arm64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.0.3-arm64
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
centos8-v11.0.3-deploy-arm64-no-test:
  <<: *deploy_definition
  <<: *centos8_11_0_3_arm64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_11_0_3_arm64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos8-v11.0.3-arm64
      artifacts: true
    - job: centos8-v11.0.3-scan-no-test-arm64

# workaround for gitlab ci rules when NO_SCAN is used...
centos8-v11.0.3-deploy-arm64-no-scan:
  <<: *deploy_definition
  <<: *centos8_11_0_3_arm64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_11_0_3_arm64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v11.0.3-arm64
      artifacts: true
    - job: centos8-v11.0.3-test-arm64

.centos7_11_0_3_x86_64_variables: &centos7_11_0_3_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.0.3"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos7"
  OS_NAME: "centos"
  OS_VERSION: "7"
  CUDA_VERSION: "11.0.3"

.centos7_11_0_3_x86_64_only: &centos7_11_0_3_x86_64_only
  <<: *tags_definition
  variables:
    <<: *centos7_11_0_3_x86_64_variables
  rules:
    - if: '$centos7_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v11.0.3-x86_64:
  <<: *cuda_base_definition
  <<: *centos7_11_0_3_x86_64_only

centos7-v11.0.3-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *centos7_11_0_3_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_11_0_3_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: centos7-v11.0.3-x86_64
      artifacts: true

centos7-v11.0.3-test-x86_64:
  needs: ["centos7-v11.0.3-x86_64"]
  <<: *centos7_11_0_3_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v11.0.3-scan-x86_64:
  <<: *scan_definition
  <<: *centos7_11_0_3_x86_64_only
  needs:
    - job: centos7-v11.0.3-x86_64
    - job: centos7-v11.0.3-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos7_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v11.0.3-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *centos7_11_0_3_x86_64_only
  # Override rules from only definition
  needs:
    - job: centos7-v11.0.3-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_11_0_3_x86_64 == "true" && $NO_TEST == "true"'

centos7-v11.0.3-deploy-x86_64:
  <<: *deploy_definition
  <<: *centos7_11_0_3_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos7_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos7-v11.0.3-x86_64
      artifacts: true
    - job: centos7-v11.0.3-test-x86_64
    - job: centos7-v11.0.3-scan-x86_64
    - job: centos7-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos7-v11.0.3-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos7_11_0_3_x86_64_only
  rules:
    - if: '$centos7_11_0_3_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v11.0.3-x86_64
      artifacts: true
    - job: centos7-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
centos7-v11.0.3-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *centos7_11_0_3_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_11_0_3_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos7-v11.0.3-x86_64
      artifacts: true
    - job: centos7-v11.0.3-scan-no-test-x86_64
    - job: centos7-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
centos7-v11.0.3-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *centos7_11_0_3_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_11_0_3_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v11.0.3-x86_64
      artifacts: true
    - job: centos7-v11.0.3-test-x86_64
    - job: centos7-v11.0.3-cudnn8-x86_64

.ubi8_11_0_3_x86_64_variables: &ubi8_11_0_3_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.0.3"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi8"
  OS_NAME: "ubi"
  OS_VERSION: "8"
  CUDA_VERSION: "11.0.3"

.ubi8_11_0_3_x86_64_only: &ubi8_11_0_3_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubi8_11_0_3_x86_64_variables
  rules:
    - if: '$ubi8_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

ubi8-v11.0.3-x86_64:
  <<: *cuda_base_definition
  <<: *ubi8_11_0_3_x86_64_only

ubi8-v11.0.3-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *ubi8_11_0_3_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi8_11_0_3_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubi8-v11.0.3-x86_64
      artifacts: true

ubi8-v11.0.3-test-x86_64:
  needs: ["ubi8-v11.0.3-x86_64"]
  <<: *ubi8_11_0_3_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

ubi8-v11.0.3-scan-x86_64:
  <<: *scan_definition
  <<: *ubi8_11_0_3_x86_64_only
  needs:
    - job: ubi8-v11.0.3-x86_64
    - job: ubi8-v11.0.3-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

ubi8-v11.0.3-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubi8_11_0_3_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubi8-v11.0.3-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_0_3_x86_64 == "true" && $NO_TEST == "true"'

ubi8-v11.0.3-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubi8_11_0_3_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi8-v11.0.3-x86_64
      artifacts: true
    - job: ubi8-v11.0.3-test-x86_64
    - job: ubi8-v11.0.3-scan-x86_64
    - job: ubi8-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi8-v11.0.3-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_0_3_x86_64_only
  rules:
    - if: '$ubi8_11_0_3_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.0.3-x86_64
      artifacts: true
    - job: ubi8-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubi8-v11.0.3-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubi8_11_0_3_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_0_3_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi8-v11.0.3-x86_64
      artifacts: true
    - job: ubi8-v11.0.3-scan-no-test-x86_64
    - job: ubi8-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi8-v11.0.3-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_0_3_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_0_3_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.0.3-x86_64
      artifacts: true
    - job: ubi8-v11.0.3-test-x86_64
    - job: ubi8-v11.0.3-cudnn8-x86_64

.ubi8_11_0_3_ppc64le_variables: &ubi8_11_0_3_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/11.0.3"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi8"
  OS_NAME: "ubi"
  OS_VERSION: "8"
  CUDA_VERSION: "11.0.3"

.ubi8_11_0_3_ppc64le_only: &ubi8_11_0_3_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubi8_11_0_3_ppc64le_variables
  rules:
    - if: '$ubi8_11_0_3_ppc64le == "true"'
    - if: '$all == "true"'

ubi8-v11.0.3-ppc64le:
  <<: *cuda_base_definition
  <<: *ubi8_11_0_3_ppc64le_only

ubi8-v11.0.3-cudnn8-ppc64le:
  <<: *cudnn_definition
  <<: *ubi8_11_0_3_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi8_11_0_3_ppc64le_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubi8-v11.0.3-ppc64le
      artifacts: true

ubi8-v11.0.3-test-ppc64le:
  needs: ["ubi8-v11.0.3-ppc64le"]
  <<: *ubi8_11_0_3_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_0_3_ppc64le == "true"'
    - if: '$all == "true"'

ubi8-v11.0.3-scan-ppc64le:
  <<: *scan_definition
  <<: *ubi8_11_0_3_ppc64le_only
  needs:
    - job: ubi8-v11.0.3-ppc64le
    - job: ubi8-v11.0.3-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_0_3_ppc64le == "true"'
    - if: '$all == "true"'

ubi8-v11.0.3-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubi8_11_0_3_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubi8-v11.0.3-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_0_3_ppc64le == "true" && $NO_TEST == "true"'

ubi8-v11.0.3-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubi8_11_0_3_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_0_3_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi8-v11.0.3-ppc64le
      artifacts: true
    - job: ubi8-v11.0.3-test-ppc64le
    - job: ubi8-v11.0.3-scan-ppc64le
    - job: ubi8-v11.0.3-cudnn8-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi8-v11.0.3-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_0_3_ppc64le_only
  rules:
    - if: '$ubi8_11_0_3_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.0.3-ppc64le
      artifacts: true
    - job: ubi8-v11.0.3-cudnn8-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
ubi8-v11.0.3-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubi8_11_0_3_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_0_3_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi8-v11.0.3-ppc64le
      artifacts: true
    - job: ubi8-v11.0.3-scan-no-test-ppc64le
    - job: ubi8-v11.0.3-cudnn8-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubi8-v11.0.3-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_0_3_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_0_3_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.0.3-ppc64le
      artifacts: true
    - job: ubi8-v11.0.3-test-ppc64le
    - job: ubi8-v11.0.3-cudnn8-ppc64le

.ubi8_11_0_3_arm64_variables: &ubi8_11_0_3_arm64_variables
  ARCH: "arm64"
  DIST_BASE_PATH: "dist/11.0.3"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-arm64"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi8"
  OS_NAME: "ubi"
  OS_VERSION: "8"
  CUDA_VERSION: "11.0.3"

.ubi8_11_0_3_arm64_only: &ubi8_11_0_3_arm64_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubi8_11_0_3_arm64_variables
  rules:
    - if: '$ubi8_11_0_3_arm64 == "true"'
    - if: '$all == "true"'

ubi8-v11.0.3-arm64:
  <<: *cuda_base_definition
  <<: *ubi8_11_0_3_arm64_only

ubi8-v11.0.3-test-arm64:
  needs: ["ubi8-v11.0.3-arm64"]
  <<: *ubi8_11_0_3_arm64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_0_3_arm64 == "true"'
    - if: '$all == "true"'

ubi8-v11.0.3-scan-arm64:
  <<: *scan_definition
  <<: *ubi8_11_0_3_arm64_only
  needs:
    - job: ubi8-v11.0.3-arm64
    - job: ubi8-v11.0.3-test-arm64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_0_3_arm64 == "true"'
    - if: '$all == "true"'

ubi8-v11.0.3-scan-no-test-arm64:
  <<: *scan_definition
  <<: *ubi8_11_0_3_arm64_only
  # Override rules from only definition
  needs:
    - job: ubi8-v11.0.3-arm64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_0_3_arm64 == "true" && $NO_TEST == "true"'

ubi8-v11.0.3-deploy-arm64:
  <<: *deploy_definition
  <<: *ubi8_11_0_3_arm64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_0_3_arm64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi8-v11.0.3-arm64
      artifacts: true
    - job: ubi8-v11.0.3-test-arm64
    - job: ubi8-v11.0.3-scan-arm64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi8-v11.0.3-deploy-arm64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_0_3_arm64_only
  rules:
    - if: '$ubi8_11_0_3_arm64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.0.3-arm64
      artifacts: true

# workaround for gitlab ci rules when NO_TEST is used...
ubi8-v11.0.3-deploy-arm64-no-test:
  <<: *deploy_definition
  <<: *ubi8_11_0_3_arm64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_11_0_3_arm64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi8-v11.0.3-arm64
      artifacts: true
    - job: ubi8-v11.0.3-scan-no-test-arm64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi8-v11.0.3-deploy-arm64-no-scan:
  <<: *deploy_definition
  <<: *ubi8_11_0_3_arm64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_11_0_3_arm64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v11.0.3-arm64
      artifacts: true
    - job: ubi8-v11.0.3-test-arm64

.ubi7_11_0_3_x86_64_variables: &ubi7_11_0_3_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/11.0.3"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi7"
  OS_NAME: "ubi"
  OS_VERSION: "7"
  CUDA_VERSION: "11.0.3"

.ubi7_11_0_3_x86_64_only: &ubi7_11_0_3_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubi7_11_0_3_x86_64_variables
  rules:
    - if: '$ubi7_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v11.0.3-x86_64:
  <<: *cuda_base_definition
  <<: *ubi7_11_0_3_x86_64_only

ubi7-v11.0.3-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *ubi7_11_0_3_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_11_0_3_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubi7-v11.0.3-x86_64
      artifacts: true

ubi7-v11.0.3-test-x86_64:
  needs: ["ubi7-v11.0.3-x86_64"]
  <<: *ubi7_11_0_3_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v11.0.3-scan-x86_64:
  <<: *scan_definition
  <<: *ubi7_11_0_3_x86_64_only
  needs:
    - job: ubi7-v11.0.3-x86_64
    - job: ubi7-v11.0.3-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi7_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v11.0.3-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubi7_11_0_3_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubi7-v11.0.3-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_11_0_3_x86_64 == "true" && $NO_TEST == "true"'

ubi7-v11.0.3-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubi7_11_0_3_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi7_11_0_3_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi7-v11.0.3-x86_64
      artifacts: true
    - job: ubi7-v11.0.3-test-x86_64
    - job: ubi7-v11.0.3-scan-x86_64
    - job: ubi7-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi7-v11.0.3-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi7_11_0_3_x86_64_only
  rules:
    - if: '$ubi7_11_0_3_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v11.0.3-x86_64
      artifacts: true
    - job: ubi7-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubi7-v11.0.3-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubi7_11_0_3_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_11_0_3_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi7-v11.0.3-x86_64
      artifacts: true
    - job: ubi7-v11.0.3-scan-no-test-x86_64
    - job: ubi7-v11.0.3-cudnn8-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi7-v11.0.3-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubi7_11_0_3_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_11_0_3_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v11.0.3-x86_64
      artifacts: true
    - job: ubi7-v11.0.3-test-x86_64
    - job: ubi7-v11.0.3-cudnn8-x86_64

.ubuntu18_04_10_2_x86_64_variables: &ubuntu18_04_10_2_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/10.2"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu18.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "18.04"
  CUDA_VERSION: "10.2"

.ubuntu18_04_10_2_x86_64_only: &ubuntu18_04_10_2_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu18_04_10_2_x86_64_variables
  rules:
    - if: '$ubuntu18_04_10_2_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.2-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu18_04_10_2_x86_64_only

ubuntu18.04-v10.2-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu18_04_10_2_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu18_04_10_2_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubuntu18.04-v10.2-x86_64
      artifacts: true

ubuntu18.04-v10.2-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu18_04_10_2_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu18_04_10_2_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubuntu18.04-v10.2-x86_64
      artifacts: true

ubuntu18.04-v10.2-test-x86_64:
  needs: ["ubuntu18.04-v10.2-x86_64"]
  <<: *ubuntu18_04_10_2_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_2_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.2-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu18_04_10_2_x86_64_only
  needs:
    - job: ubuntu18.04-v10.2-x86_64
    - job: ubuntu18.04-v10.2-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_2_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.2-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu18_04_10_2_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu18.04-v10.2-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_2_x86_64 == "true" && $NO_TEST == "true"'

ubuntu18.04-v10.2-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_2_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_2_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu18.04-v10.2-x86_64
      artifacts: true
    - job: ubuntu18.04-v10.2-test-x86_64
    - job: ubuntu18.04-v10.2-scan-x86_64
    - job: ubuntu18.04-v10.2-cudnn8-x86_64
    - job: ubuntu18.04-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu18.04-v10.2-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_2_x86_64_only
  rules:
    - if: '$ubuntu18_04_10_2_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v10.2-x86_64
      artifacts: true
    - job: ubuntu18.04-v10.2-cudnn8-x86_64
    - job: ubuntu18.04-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu18.04-v10.2-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_2_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_2_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu18.04-v10.2-x86_64
      artifacts: true
    - job: ubuntu18.04-v10.2-scan-no-test-x86_64
    - job: ubuntu18.04-v10.2-cudnn8-x86_64
    - job: ubuntu18.04-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu18.04-v10.2-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_2_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_2_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v10.2-x86_64
      artifacts: true
    - job: ubuntu18.04-v10.2-test-x86_64
    - job: ubuntu18.04-v10.2-cudnn8-x86_64
    - job: ubuntu18.04-v10.2-cudnn7-x86_64

.ubuntu18_04_10_2_ppc64le_variables: &ubuntu18_04_10_2_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/10.2"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu18.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "18.04"
  CUDA_VERSION: "10.2"

.ubuntu18_04_10_2_ppc64le_only: &ubuntu18_04_10_2_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubuntu18_04_10_2_ppc64le_variables
  rules:
    - if: '$ubuntu18_04_10_2_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.2-ppc64le:
  <<: *cuda_base_definition
  <<: *ubuntu18_04_10_2_ppc64le_only

ubuntu18.04-v10.2-cudnn8-ppc64le:
  <<: *cudnn_definition
  <<: *ubuntu18_04_10_2_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu18_04_10_2_ppc64le_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubuntu18.04-v10.2-ppc64le
      artifacts: true

ubuntu18.04-v10.2-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *ubuntu18_04_10_2_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu18_04_10_2_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubuntu18.04-v10.2-ppc64le
      artifacts: true

ubuntu18.04-v10.2-test-ppc64le:
  needs: ["ubuntu18.04-v10.2-ppc64le"]
  <<: *ubuntu18_04_10_2_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_2_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.2-scan-ppc64le:
  <<: *scan_definition
  <<: *ubuntu18_04_10_2_ppc64le_only
  needs:
    - job: ubuntu18.04-v10.2-ppc64le
    - job: ubuntu18.04-v10.2-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_2_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.2-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubuntu18_04_10_2_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubuntu18.04-v10.2-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_2_ppc64le == "true" && $NO_TEST == "true"'

ubuntu18.04-v10.2-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_2_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_2_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu18.04-v10.2-ppc64le
      artifacts: true
    - job: ubuntu18.04-v10.2-test-ppc64le
    - job: ubuntu18.04-v10.2-scan-ppc64le
    - job: ubuntu18.04-v10.2-cudnn8-ppc64le
    - job: ubuntu18.04-v10.2-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu18.04-v10.2-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_2_ppc64le_only
  rules:
    - if: '$ubuntu18_04_10_2_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v10.2-ppc64le
      artifacts: true
    - job: ubuntu18.04-v10.2-cudnn8-ppc64le
    - job: ubuntu18.04-v10.2-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu18.04-v10.2-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_2_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_2_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu18.04-v10.2-ppc64le
      artifacts: true
    - job: ubuntu18.04-v10.2-scan-no-test-ppc64le
    - job: ubuntu18.04-v10.2-cudnn8-ppc64le
    - job: ubuntu18.04-v10.2-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu18.04-v10.2-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_2_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_2_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v10.2-ppc64le
      artifacts: true
    - job: ubuntu18.04-v10.2-test-ppc64le
    - job: ubuntu18.04-v10.2-cudnn8-ppc64le
    - job: ubuntu18.04-v10.2-cudnn7-ppc64le

.ubuntu16_04_10_2_x86_64_variables: &ubuntu16_04_10_2_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/10.2"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubuntu16.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "16.04"
  CUDA_VERSION: "10.2"

.ubuntu16_04_10_2_x86_64_only: &ubuntu16_04_10_2_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu16_04_10_2_x86_64_variables
  rules:
    - if: '$ubuntu16_04_10_2_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v10.2-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu16_04_10_2_x86_64_only

ubuntu16.04-v10.2-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu16_04_10_2_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_10_2_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubuntu16.04-v10.2-x86_64
      artifacts: true

ubuntu16.04-v10.2-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu16_04_10_2_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_10_2_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubuntu16.04-v10.2-x86_64
      artifacts: true

ubuntu16.04-v10.2-test-x86_64:
  needs: ["ubuntu16.04-v10.2-x86_64"]
  <<: *ubuntu16_04_10_2_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_10_2_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v10.2-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_10_2_x86_64_only
  needs:
    - job: ubuntu16.04-v10.2-x86_64
    - job: ubuntu16.04-v10.2-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_10_2_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v10.2-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_10_2_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu16.04-v10.2-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_10_2_x86_64 == "true" && $NO_TEST == "true"'

ubuntu16.04-v10.2-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu16_04_10_2_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_10_2_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu16.04-v10.2-x86_64
      artifacts: true
    - job: ubuntu16.04-v10.2-test-x86_64
    - job: ubuntu16.04-v10.2-scan-x86_64
    - job: ubuntu16.04-v10.2-cudnn8-x86_64
    - job: ubuntu16.04-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu16.04-v10.2-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_10_2_x86_64_only
  rules:
    - if: '$ubuntu16_04_10_2_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v10.2-x86_64
      artifacts: true
    - job: ubuntu16.04-v10.2-cudnn8-x86_64
    - job: ubuntu16.04-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu16.04-v10.2-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu16_04_10_2_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_10_2_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu16.04-v10.2-x86_64
      artifacts: true
    - job: ubuntu16.04-v10.2-scan-no-test-x86_64
    - job: ubuntu16.04-v10.2-cudnn8-x86_64
    - job: ubuntu16.04-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu16.04-v10.2-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_10_2_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_10_2_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v10.2-x86_64
      artifacts: true
    - job: ubuntu16.04-v10.2-test-x86_64
    - job: ubuntu16.04-v10.2-cudnn8-x86_64
    - job: ubuntu16.04-v10.2-cudnn7-x86_64

.centos8_10_2_x86_64_variables: &centos8_10_2_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/10.2"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos8"
  OS_NAME: "centos"
  OS_VERSION: "8"
  CUDA_VERSION: "10.2"

.centos8_10_2_x86_64_only: &centos8_10_2_x86_64_only
  <<: *tags_definition
  variables:
    <<: *centos8_10_2_x86_64_variables
  rules:
    - if: '$centos8_10_2_x86_64 == "true"'
    - if: '$all == "true"'

centos8-v10.2-x86_64:
  <<: *cuda_base_definition
  <<: *centos8_10_2_x86_64_only

centos8-v10.2-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *centos8_10_2_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos8_10_2_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: centos8-v10.2-x86_64
      artifacts: true

centos8-v10.2-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *centos8_10_2_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos8_10_2_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: centos8-v10.2-x86_64
      artifacts: true

centos8-v10.2-test-x86_64:
  needs: ["centos8-v10.2-x86_64"]
  <<: *centos8_10_2_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_10_2_x86_64 == "true"'
    - if: '$all == "true"'

centos8-v10.2-scan-x86_64:
  <<: *scan_definition
  <<: *centos8_10_2_x86_64_only
  needs:
    - job: centos8-v10.2-x86_64
    - job: centos8-v10.2-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos8_10_2_x86_64 == "true"'
    - if: '$all == "true"'

centos8-v10.2-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *centos8_10_2_x86_64_only
  # Override rules from only definition
  needs:
    - job: centos8-v10.2-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_10_2_x86_64 == "true" && $NO_TEST == "true"'

centos8-v10.2-deploy-x86_64:
  <<: *deploy_definition
  <<: *centos8_10_2_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos8_10_2_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos8-v10.2-x86_64
      artifacts: true
    - job: centos8-v10.2-test-x86_64
    - job: centos8-v10.2-scan-x86_64
    - job: centos8-v10.2-cudnn8-x86_64
    - job: centos8-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos8-v10.2-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos8_10_2_x86_64_only
  rules:
    - if: '$centos8_10_2_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v10.2-x86_64
      artifacts: true
    - job: centos8-v10.2-cudnn8-x86_64
    - job: centos8-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
centos8-v10.2-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *centos8_10_2_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_10_2_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos8-v10.2-x86_64
      artifacts: true
    - job: centos8-v10.2-scan-no-test-x86_64
    - job: centos8-v10.2-cudnn8-x86_64
    - job: centos8-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
centos8-v10.2-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *centos8_10_2_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_10_2_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v10.2-x86_64
      artifacts: true
    - job: centos8-v10.2-test-x86_64
    - job: centos8-v10.2-cudnn8-x86_64
    - job: centos8-v10.2-cudnn7-x86_64

.centos7_10_2_x86_64_variables: &centos7_10_2_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/10.2"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos7"
  OS_NAME: "centos"
  OS_VERSION: "7"
  CUDA_VERSION: "10.2"

.centos7_10_2_x86_64_only: &centos7_10_2_x86_64_only
  <<: *tags_definition
  variables:
    <<: *centos7_10_2_x86_64_variables
  rules:
    - if: '$centos7_10_2_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v10.2-x86_64:
  <<: *cuda_base_definition
  <<: *centos7_10_2_x86_64_only

centos7-v10.2-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *centos7_10_2_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_10_2_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: centos7-v10.2-x86_64
      artifacts: true

centos7-v10.2-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *centos7_10_2_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_10_2_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: centos7-v10.2-x86_64
      artifacts: true

centos7-v10.2-test-x86_64:
  needs: ["centos7-v10.2-x86_64"]
  <<: *centos7_10_2_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_10_2_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v10.2-scan-x86_64:
  <<: *scan_definition
  <<: *centos7_10_2_x86_64_only
  needs:
    - job: centos7-v10.2-x86_64
    - job: centos7-v10.2-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos7_10_2_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v10.2-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *centos7_10_2_x86_64_only
  # Override rules from only definition
  needs:
    - job: centos7-v10.2-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_2_x86_64 == "true" && $NO_TEST == "true"'

centos7-v10.2-deploy-x86_64:
  <<: *deploy_definition
  <<: *centos7_10_2_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_2_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos7-v10.2-x86_64
      artifacts: true
    - job: centos7-v10.2-test-x86_64
    - job: centos7-v10.2-scan-x86_64
    - job: centos7-v10.2-cudnn8-x86_64
    - job: centos7-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos7-v10.2-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos7_10_2_x86_64_only
  rules:
    - if: '$centos7_10_2_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v10.2-x86_64
      artifacts: true
    - job: centos7-v10.2-cudnn8-x86_64
    - job: centos7-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
centos7-v10.2-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *centos7_10_2_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_2_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos7-v10.2-x86_64
      artifacts: true
    - job: centos7-v10.2-scan-no-test-x86_64
    - job: centos7-v10.2-cudnn8-x86_64
    - job: centos7-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
centos7-v10.2-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *centos7_10_2_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_10_2_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v10.2-x86_64
      artifacts: true
    - job: centos7-v10.2-test-x86_64
    - job: centos7-v10.2-cudnn8-x86_64
    - job: centos7-v10.2-cudnn7-x86_64

.centos7_10_2_ppc64le_variables: &centos7_10_2_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/10.2"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos7"
  OS_NAME: "centos"
  OS_VERSION: "7"
  CUDA_VERSION: "10.2"

.centos7_10_2_ppc64le_only: &centos7_10_2_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *centos7_10_2_ppc64le_variables
  rules:
    - if: '$centos7_10_2_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v10.2-ppc64le:
  <<: *cuda_base_definition
  <<: *centos7_10_2_ppc64le_only

centos7-v10.2-cudnn8-ppc64le:
  <<: *cudnn_definition
  <<: *centos7_10_2_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_10_2_ppc64le_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: centos7-v10.2-ppc64le
      artifacts: true

centos7-v10.2-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *centos7_10_2_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_10_2_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: centos7-v10.2-ppc64le
      artifacts: true

centos7-v10.2-test-ppc64le:
  needs: ["centos7-v10.2-ppc64le"]
  <<: *centos7_10_2_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_10_2_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v10.2-scan-ppc64le:
  <<: *scan_definition
  <<: *centos7_10_2_ppc64le_only
  needs:
    - job: centos7-v10.2-ppc64le
    - job: centos7-v10.2-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos7_10_2_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v10.2-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *centos7_10_2_ppc64le_only
  # Override rules from only definition
  needs:
    - job: centos7-v10.2-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_2_ppc64le == "true" && $NO_TEST == "true"'

centos7-v10.2-deploy-ppc64le:
  <<: *deploy_definition
  <<: *centos7_10_2_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_2_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos7-v10.2-ppc64le
      artifacts: true
    - job: centos7-v10.2-test-ppc64le
    - job: centos7-v10.2-scan-ppc64le
    - job: centos7-v10.2-cudnn8-ppc64le
    - job: centos7-v10.2-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos7-v10.2-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos7_10_2_ppc64le_only
  rules:
    - if: '$centos7_10_2_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v10.2-ppc64le
      artifacts: true
    - job: centos7-v10.2-cudnn8-ppc64le
    - job: centos7-v10.2-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
centos7-v10.2-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *centos7_10_2_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_2_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: centos7-v10.2-ppc64le
      artifacts: true
    - job: centos7-v10.2-scan-no-test-ppc64le
    - job: centos7-v10.2-cudnn8-ppc64le
    - job: centos7-v10.2-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
centos7-v10.2-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *centos7_10_2_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_10_2_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v10.2-ppc64le
      artifacts: true
    - job: centos7-v10.2-test-ppc64le
    - job: centos7-v10.2-cudnn8-ppc64le
    - job: centos7-v10.2-cudnn7-ppc64le

.ubi8_10_2_x86_64_variables: &ubi8_10_2_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/10.2"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi8"
  OS_NAME: "ubi"
  OS_VERSION: "8"
  CUDA_VERSION: "10.2"

.ubi8_10_2_x86_64_only: &ubi8_10_2_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubi8_10_2_x86_64_variables
  rules:
    - if: '$ubi8_10_2_x86_64 == "true"'
    - if: '$all == "true"'

ubi8-v10.2-x86_64:
  <<: *cuda_base_definition
  <<: *ubi8_10_2_x86_64_only

ubi8-v10.2-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *ubi8_10_2_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi8_10_2_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubi8-v10.2-x86_64
      artifacts: true

ubi8-v10.2-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubi8_10_2_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi8_10_2_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubi8-v10.2-x86_64
      artifacts: true

ubi8-v10.2-test-x86_64:
  needs: ["ubi8-v10.2-x86_64"]
  <<: *ubi8_10_2_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_10_2_x86_64 == "true"'
    - if: '$all == "true"'

ubi8-v10.2-scan-x86_64:
  <<: *scan_definition
  <<: *ubi8_10_2_x86_64_only
  needs:
    - job: ubi8-v10.2-x86_64
    - job: ubi8-v10.2-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi8_10_2_x86_64 == "true"'
    - if: '$all == "true"'

ubi8-v10.2-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubi8_10_2_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubi8-v10.2-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_10_2_x86_64 == "true" && $NO_TEST == "true"'

ubi8-v10.2-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubi8_10_2_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi8_10_2_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi8-v10.2-x86_64
      artifacts: true
    - job: ubi8-v10.2-test-x86_64
    - job: ubi8-v10.2-scan-x86_64
    - job: ubi8-v10.2-cudnn8-x86_64
    - job: ubi8-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi8-v10.2-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi8_10_2_x86_64_only
  rules:
    - if: '$ubi8_10_2_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v10.2-x86_64
      artifacts: true
    - job: ubi8-v10.2-cudnn8-x86_64
    - job: ubi8-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubi8-v10.2-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubi8_10_2_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_10_2_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi8-v10.2-x86_64
      artifacts: true
    - job: ubi8-v10.2-scan-no-test-x86_64
    - job: ubi8-v10.2-cudnn8-x86_64
    - job: ubi8-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi8-v10.2-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubi8_10_2_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_10_2_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v10.2-x86_64
      artifacts: true
    - job: ubi8-v10.2-test-x86_64
    - job: ubi8-v10.2-cudnn8-x86_64
    - job: ubi8-v10.2-cudnn7-x86_64

.ubi7_10_2_x86_64_variables: &ubi7_10_2_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/10.2"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi7"
  OS_NAME: "ubi"
  OS_VERSION: "7"
  CUDA_VERSION: "10.2"

.ubi7_10_2_x86_64_only: &ubi7_10_2_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubi7_10_2_x86_64_variables
  rules:
    - if: '$ubi7_10_2_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v10.2-x86_64:
  <<: *cuda_base_definition
  <<: *ubi7_10_2_x86_64_only

ubi7-v10.2-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *ubi7_10_2_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_10_2_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubi7-v10.2-x86_64
      artifacts: true

ubi7-v10.2-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubi7_10_2_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_10_2_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubi7-v10.2-x86_64
      artifacts: true

ubi7-v10.2-test-x86_64:
  needs: ["ubi7-v10.2-x86_64"]
  <<: *ubi7_10_2_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_2_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v10.2-scan-x86_64:
  <<: *scan_definition
  <<: *ubi7_10_2_x86_64_only
  needs:
    - job: ubi7-v10.2-x86_64
    - job: ubi7-v10.2-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_2_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v10.2-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubi7_10_2_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubi7-v10.2-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_2_x86_64 == "true" && $NO_TEST == "true"'

ubi7-v10.2-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubi7_10_2_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_2_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi7-v10.2-x86_64
      artifacts: true
    - job: ubi7-v10.2-test-x86_64
    - job: ubi7-v10.2-scan-x86_64
    - job: ubi7-v10.2-cudnn8-x86_64
    - job: ubi7-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi7-v10.2-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi7_10_2_x86_64_only
  rules:
    - if: '$ubi7_10_2_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v10.2-x86_64
      artifacts: true
    - job: ubi7-v10.2-cudnn8-x86_64
    - job: ubi7-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubi7-v10.2-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubi7_10_2_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_2_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi7-v10.2-x86_64
      artifacts: true
    - job: ubi7-v10.2-scan-no-test-x86_64
    - job: ubi7-v10.2-cudnn8-x86_64
    - job: ubi7-v10.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi7-v10.2-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubi7_10_2_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_2_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v10.2-x86_64
      artifacts: true
    - job: ubi7-v10.2-test-x86_64
    - job: ubi7-v10.2-cudnn8-x86_64
    - job: ubi7-v10.2-cudnn7-x86_64

.ubi7_10_2_ppc64le_variables: &ubi7_10_2_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/10.2"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi7"
  OS_NAME: "ubi"
  OS_VERSION: "7"
  CUDA_VERSION: "10.2"

.ubi7_10_2_ppc64le_only: &ubi7_10_2_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubi7_10_2_ppc64le_variables
  rules:
    - if: '$ubi7_10_2_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v10.2-ppc64le:
  <<: *cuda_base_definition
  <<: *ubi7_10_2_ppc64le_only

ubi7-v10.2-cudnn8-ppc64le:
  <<: *cudnn_definition
  <<: *ubi7_10_2_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_10_2_ppc64le_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubi7-v10.2-ppc64le
      artifacts: true

ubi7-v10.2-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *ubi7_10_2_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_10_2_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubi7-v10.2-ppc64le
      artifacts: true

ubi7-v10.2-test-ppc64le:
  needs: ["ubi7-v10.2-ppc64le"]
  <<: *ubi7_10_2_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_2_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v10.2-scan-ppc64le:
  <<: *scan_definition
  <<: *ubi7_10_2_ppc64le_only
  needs:
    - job: ubi7-v10.2-ppc64le
    - job: ubi7-v10.2-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_2_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v10.2-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubi7_10_2_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubi7-v10.2-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_2_ppc64le == "true" && $NO_TEST == "true"'

ubi7-v10.2-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubi7_10_2_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_2_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi7-v10.2-ppc64le
      artifacts: true
    - job: ubi7-v10.2-test-ppc64le
    - job: ubi7-v10.2-scan-ppc64le
    - job: ubi7-v10.2-cudnn8-ppc64le
    - job: ubi7-v10.2-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi7-v10.2-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi7_10_2_ppc64le_only
  rules:
    - if: '$ubi7_10_2_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v10.2-ppc64le
      artifacts: true
    - job: ubi7-v10.2-cudnn8-ppc64le
    - job: ubi7-v10.2-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
ubi7-v10.2-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubi7_10_2_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_2_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi7-v10.2-ppc64le
      artifacts: true
    - job: ubi7-v10.2-scan-no-test-ppc64le
    - job: ubi7-v10.2-cudnn8-ppc64le
    - job: ubi7-v10.2-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubi7-v10.2-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubi7_10_2_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_2_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v10.2-ppc64le
      artifacts: true
    - job: ubi7-v10.2-test-ppc64le
    - job: ubi7-v10.2-cudnn8-ppc64le
    - job: ubi7-v10.2-cudnn7-ppc64le

.ubuntu18_04_10_1_x86_64_variables: &ubuntu18_04_10_1_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/10.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu18.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "18.04"
  CUDA_VERSION: "10.1"

.ubuntu18_04_10_1_x86_64_only: &ubuntu18_04_10_1_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu18_04_10_1_x86_64_variables
  rules:
    - if: '$ubuntu18_04_10_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.1-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu18_04_10_1_x86_64_only

ubuntu18.04-v10.1-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu18_04_10_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu18_04_10_1_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubuntu18.04-v10.1-x86_64
      artifacts: true

ubuntu18.04-v10.1-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu18_04_10_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu18_04_10_1_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubuntu18.04-v10.1-x86_64
      artifacts: true

ubuntu18.04-v10.1-test-x86_64:
  needs: ["ubuntu18.04-v10.1-x86_64"]
  <<: *ubuntu18_04_10_1_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.1-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu18_04_10_1_x86_64_only
  needs:
    - job: ubuntu18.04-v10.1-x86_64
    - job: ubuntu18.04-v10.1-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.1-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu18_04_10_1_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu18.04-v10.1-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_1_x86_64 == "true" && $NO_TEST == "true"'

ubuntu18.04-v10.1-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_1_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_1_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu18.04-v10.1-x86_64
      artifacts: true
    - job: ubuntu18.04-v10.1-test-x86_64
    - job: ubuntu18.04-v10.1-scan-x86_64
    - job: ubuntu18.04-v10.1-cudnn8-x86_64
    - job: ubuntu18.04-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu18.04-v10.1-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_1_x86_64_only
  rules:
    - if: '$ubuntu18_04_10_1_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v10.1-x86_64
      artifacts: true
    - job: ubuntu18.04-v10.1-cudnn8-x86_64
    - job: ubuntu18.04-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu18.04-v10.1-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_1_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_1_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu18.04-v10.1-x86_64
      artifacts: true
    - job: ubuntu18.04-v10.1-scan-no-test-x86_64
    - job: ubuntu18.04-v10.1-cudnn8-x86_64
    - job: ubuntu18.04-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu18.04-v10.1-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_1_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_1_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v10.1-x86_64
      artifacts: true
    - job: ubuntu18.04-v10.1-test-x86_64
    - job: ubuntu18.04-v10.1-cudnn8-x86_64
    - job: ubuntu18.04-v10.1-cudnn7-x86_64

.ubuntu18_04_10_1_ppc64le_variables: &ubuntu18_04_10_1_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/10.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu18.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "18.04"
  CUDA_VERSION: "10.1"

.ubuntu18_04_10_1_ppc64le_only: &ubuntu18_04_10_1_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubuntu18_04_10_1_ppc64le_variables
  rules:
    - if: '$ubuntu18_04_10_1_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.1-ppc64le:
  <<: *cuda_base_definition
  <<: *ubuntu18_04_10_1_ppc64le_only

ubuntu18.04-v10.1-cudnn8-ppc64le:
  <<: *cudnn_definition
  <<: *ubuntu18_04_10_1_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu18_04_10_1_ppc64le_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubuntu18.04-v10.1-ppc64le
      artifacts: true

ubuntu18.04-v10.1-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *ubuntu18_04_10_1_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu18_04_10_1_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubuntu18.04-v10.1-ppc64le
      artifacts: true

ubuntu18.04-v10.1-test-ppc64le:
  needs: ["ubuntu18.04-v10.1-ppc64le"]
  <<: *ubuntu18_04_10_1_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_1_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.1-scan-ppc64le:
  <<: *scan_definition
  <<: *ubuntu18_04_10_1_ppc64le_only
  needs:
    - job: ubuntu18.04-v10.1-ppc64le
    - job: ubuntu18.04-v10.1-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_1_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.1-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubuntu18_04_10_1_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubuntu18.04-v10.1-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_1_ppc64le == "true" && $NO_TEST == "true"'

ubuntu18.04-v10.1-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_1_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_1_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu18.04-v10.1-ppc64le
      artifacts: true
    - job: ubuntu18.04-v10.1-test-ppc64le
    - job: ubuntu18.04-v10.1-scan-ppc64le
    - job: ubuntu18.04-v10.1-cudnn8-ppc64le
    - job: ubuntu18.04-v10.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu18.04-v10.1-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_1_ppc64le_only
  rules:
    - if: '$ubuntu18_04_10_1_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v10.1-ppc64le
      artifacts: true
    - job: ubuntu18.04-v10.1-cudnn8-ppc64le
    - job: ubuntu18.04-v10.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu18.04-v10.1-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_1_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_1_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu18.04-v10.1-ppc64le
      artifacts: true
    - job: ubuntu18.04-v10.1-scan-no-test-ppc64le
    - job: ubuntu18.04-v10.1-cudnn8-ppc64le
    - job: ubuntu18.04-v10.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu18.04-v10.1-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_1_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_1_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v10.1-ppc64le
      artifacts: true
    - job: ubuntu18.04-v10.1-test-ppc64le
    - job: ubuntu18.04-v10.1-cudnn8-ppc64le
    - job: ubuntu18.04-v10.1-cudnn7-ppc64le

.ubuntu16_04_10_1_x86_64_variables: &ubuntu16_04_10_1_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/10.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubuntu16.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "16.04"
  CUDA_VERSION: "10.1"

.ubuntu16_04_10_1_x86_64_only: &ubuntu16_04_10_1_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu16_04_10_1_x86_64_variables
  rules:
    - if: '$ubuntu16_04_10_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v10.1-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu16_04_10_1_x86_64_only

ubuntu16.04-v10.1-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu16_04_10_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_10_1_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubuntu16.04-v10.1-x86_64
      artifacts: true

ubuntu16.04-v10.1-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu16_04_10_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_10_1_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubuntu16.04-v10.1-x86_64
      artifacts: true

ubuntu16.04-v10.1-test-x86_64:
  needs: ["ubuntu16.04-v10.1-x86_64"]
  <<: *ubuntu16_04_10_1_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_10_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v10.1-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_10_1_x86_64_only
  needs:
    - job: ubuntu16.04-v10.1-x86_64
    - job: ubuntu16.04-v10.1-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_10_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v10.1-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_10_1_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu16.04-v10.1-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_10_1_x86_64 == "true" && $NO_TEST == "true"'

ubuntu16.04-v10.1-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu16_04_10_1_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_10_1_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu16.04-v10.1-x86_64
      artifacts: true
    - job: ubuntu16.04-v10.1-test-x86_64
    - job: ubuntu16.04-v10.1-scan-x86_64
    - job: ubuntu16.04-v10.1-cudnn8-x86_64
    - job: ubuntu16.04-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu16.04-v10.1-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_10_1_x86_64_only
  rules:
    - if: '$ubuntu16_04_10_1_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v10.1-x86_64
      artifacts: true
    - job: ubuntu16.04-v10.1-cudnn8-x86_64
    - job: ubuntu16.04-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu16.04-v10.1-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu16_04_10_1_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_10_1_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu16.04-v10.1-x86_64
      artifacts: true
    - job: ubuntu16.04-v10.1-scan-no-test-x86_64
    - job: ubuntu16.04-v10.1-cudnn8-x86_64
    - job: ubuntu16.04-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu16.04-v10.1-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_10_1_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_10_1_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v10.1-x86_64
      artifacts: true
    - job: ubuntu16.04-v10.1-test-x86_64
    - job: ubuntu16.04-v10.1-cudnn8-x86_64
    - job: ubuntu16.04-v10.1-cudnn7-x86_64

.centos8_10_1_x86_64_variables: &centos8_10_1_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/10.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos8"
  OS_NAME: "centos"
  OS_VERSION: "8"
  CUDA_VERSION: "10.1"

.centos8_10_1_x86_64_only: &centos8_10_1_x86_64_only
  <<: *tags_definition
  variables:
    <<: *centos8_10_1_x86_64_variables
  rules:
    - if: '$centos8_10_1_x86_64 == "true"'
    - if: '$all == "true"'

centos8-v10.1-x86_64:
  <<: *cuda_base_definition
  <<: *centos8_10_1_x86_64_only

centos8-v10.1-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *centos8_10_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos8_10_1_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: centos8-v10.1-x86_64
      artifacts: true

centos8-v10.1-test-x86_64:
  needs: ["centos8-v10.1-x86_64"]
  <<: *centos8_10_1_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_10_1_x86_64 == "true"'
    - if: '$all == "true"'

centos8-v10.1-scan-x86_64:
  <<: *scan_definition
  <<: *centos8_10_1_x86_64_only
  needs:
    - job: centos8-v10.1-x86_64
    - job: centos8-v10.1-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos8_10_1_x86_64 == "true"'
    - if: '$all == "true"'

centos8-v10.1-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *centos8_10_1_x86_64_only
  # Override rules from only definition
  needs:
    - job: centos8-v10.1-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_10_1_x86_64 == "true" && $NO_TEST == "true"'

centos8-v10.1-deploy-x86_64:
  <<: *deploy_definition
  <<: *centos8_10_1_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos8_10_1_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos8-v10.1-x86_64
      artifacts: true
    - job: centos8-v10.1-test-x86_64
    - job: centos8-v10.1-scan-x86_64
    - job: centos8-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos8-v10.1-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos8_10_1_x86_64_only
  rules:
    - if: '$centos8_10_1_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v10.1-x86_64
      artifacts: true
    - job: centos8-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
centos8-v10.1-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *centos8_10_1_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos8_10_1_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos8-v10.1-x86_64
      artifacts: true
    - job: centos8-v10.1-scan-no-test-x86_64
    - job: centos8-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
centos8-v10.1-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *centos8_10_1_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos8_10_1_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos8-v10.1-x86_64
      artifacts: true
    - job: centos8-v10.1-test-x86_64
    - job: centos8-v10.1-cudnn7-x86_64

.centos7_10_1_x86_64_variables: &centos7_10_1_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/10.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos7"
  OS_NAME: "centos"
  OS_VERSION: "7"
  CUDA_VERSION: "10.1"

.centos7_10_1_x86_64_only: &centos7_10_1_x86_64_only
  <<: *tags_definition
  variables:
    <<: *centos7_10_1_x86_64_variables
  rules:
    - if: '$centos7_10_1_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v10.1-x86_64:
  <<: *cuda_base_definition
  <<: *centos7_10_1_x86_64_only

centos7-v10.1-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *centos7_10_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_10_1_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: centos7-v10.1-x86_64
      artifacts: true

centos7-v10.1-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *centos7_10_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_10_1_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: centos7-v10.1-x86_64
      artifacts: true

centos7-v10.1-test-x86_64:
  needs: ["centos7-v10.1-x86_64"]
  <<: *centos7_10_1_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_10_1_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v10.1-scan-x86_64:
  <<: *scan_definition
  <<: *centos7_10_1_x86_64_only
  needs:
    - job: centos7-v10.1-x86_64
    - job: centos7-v10.1-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos7_10_1_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v10.1-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *centos7_10_1_x86_64_only
  # Override rules from only definition
  needs:
    - job: centos7-v10.1-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_1_x86_64 == "true" && $NO_TEST == "true"'

centos7-v10.1-deploy-x86_64:
  <<: *deploy_definition
  <<: *centos7_10_1_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_1_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos7-v10.1-x86_64
      artifacts: true
    - job: centos7-v10.1-test-x86_64
    - job: centos7-v10.1-scan-x86_64
    - job: centos7-v10.1-cudnn8-x86_64
    - job: centos7-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos7-v10.1-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos7_10_1_x86_64_only
  rules:
    - if: '$centos7_10_1_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v10.1-x86_64
      artifacts: true
    - job: centos7-v10.1-cudnn8-x86_64
    - job: centos7-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
centos7-v10.1-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *centos7_10_1_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_1_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos7-v10.1-x86_64
      artifacts: true
    - job: centos7-v10.1-scan-no-test-x86_64
    - job: centos7-v10.1-cudnn8-x86_64
    - job: centos7-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
centos7-v10.1-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *centos7_10_1_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_10_1_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v10.1-x86_64
      artifacts: true
    - job: centos7-v10.1-test-x86_64
    - job: centos7-v10.1-cudnn8-x86_64
    - job: centos7-v10.1-cudnn7-x86_64

.centos7_10_1_ppc64le_variables: &centos7_10_1_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/10.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos7"
  OS_NAME: "centos"
  OS_VERSION: "7"
  CUDA_VERSION: "10.1"

.centos7_10_1_ppc64le_only: &centos7_10_1_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *centos7_10_1_ppc64le_variables
  rules:
    - if: '$centos7_10_1_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v10.1-ppc64le:
  <<: *cuda_base_definition
  <<: *centos7_10_1_ppc64le_only

centos7-v10.1-cudnn8-ppc64le:
  <<: *cudnn_definition
  <<: *centos7_10_1_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_10_1_ppc64le_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: centos7-v10.1-ppc64le
      artifacts: true

centos7-v10.1-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *centos7_10_1_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_10_1_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: centos7-v10.1-ppc64le
      artifacts: true

centos7-v10.1-test-ppc64le:
  needs: ["centos7-v10.1-ppc64le"]
  <<: *centos7_10_1_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_10_1_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v10.1-scan-ppc64le:
  <<: *scan_definition
  <<: *centos7_10_1_ppc64le_only
  needs:
    - job: centos7-v10.1-ppc64le
    - job: centos7-v10.1-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos7_10_1_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v10.1-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *centos7_10_1_ppc64le_only
  # Override rules from only definition
  needs:
    - job: centos7-v10.1-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_1_ppc64le == "true" && $NO_TEST == "true"'

centos7-v10.1-deploy-ppc64le:
  <<: *deploy_definition
  <<: *centos7_10_1_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_1_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos7-v10.1-ppc64le
      artifacts: true
    - job: centos7-v10.1-test-ppc64le
    - job: centos7-v10.1-scan-ppc64le
    - job: centos7-v10.1-cudnn8-ppc64le
    - job: centos7-v10.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos7-v10.1-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos7_10_1_ppc64le_only
  rules:
    - if: '$centos7_10_1_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v10.1-ppc64le
      artifacts: true
    - job: centos7-v10.1-cudnn8-ppc64le
    - job: centos7-v10.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
centos7-v10.1-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *centos7_10_1_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_1_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: centos7-v10.1-ppc64le
      artifacts: true
    - job: centos7-v10.1-scan-no-test-ppc64le
    - job: centos7-v10.1-cudnn8-ppc64le
    - job: centos7-v10.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
centos7-v10.1-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *centos7_10_1_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_10_1_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v10.1-ppc64le
      artifacts: true
    - job: centos7-v10.1-test-ppc64le
    - job: centos7-v10.1-cudnn8-ppc64le
    - job: centos7-v10.1-cudnn7-ppc64le

.ubi8_10_1_x86_64_variables: &ubi8_10_1_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/10.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi8"
  OS_NAME: "ubi"
  OS_VERSION: "8"
  CUDA_VERSION: "10.1"

.ubi8_10_1_x86_64_only: &ubi8_10_1_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubi8_10_1_x86_64_variables
  rules:
    - if: '$ubi8_10_1_x86_64 == "true"'
    - if: '$all == "true"'

ubi8-v10.1-x86_64:
  <<: *cuda_base_definition
  <<: *ubi8_10_1_x86_64_only

ubi8-v10.1-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubi8_10_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi8_10_1_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubi8-v10.1-x86_64
      artifacts: true

ubi8-v10.1-test-x86_64:
  needs: ["ubi8-v10.1-x86_64"]
  <<: *ubi8_10_1_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_10_1_x86_64 == "true"'
    - if: '$all == "true"'

ubi8-v10.1-scan-x86_64:
  <<: *scan_definition
  <<: *ubi8_10_1_x86_64_only
  needs:
    - job: ubi8-v10.1-x86_64
    - job: ubi8-v10.1-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi8_10_1_x86_64 == "true"'
    - if: '$all == "true"'

ubi8-v10.1-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubi8_10_1_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubi8-v10.1-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_10_1_x86_64 == "true" && $NO_TEST == "true"'

ubi8-v10.1-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubi8_10_1_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi8_10_1_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi8-v10.1-x86_64
      artifacts: true
    - job: ubi8-v10.1-test-x86_64
    - job: ubi8-v10.1-scan-x86_64
    - job: ubi8-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi8-v10.1-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi8_10_1_x86_64_only
  rules:
    - if: '$ubi8_10_1_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v10.1-x86_64
      artifacts: true
    - job: ubi8-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubi8-v10.1-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubi8_10_1_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi8_10_1_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi8-v10.1-x86_64
      artifacts: true
    - job: ubi8-v10.1-scan-no-test-x86_64
    - job: ubi8-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi8-v10.1-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubi8_10_1_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi8_10_1_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi8-v10.1-x86_64
      artifacts: true
    - job: ubi8-v10.1-test-x86_64
    - job: ubi8-v10.1-cudnn7-x86_64

.ubi7_10_1_x86_64_variables: &ubi7_10_1_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/10.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi7"
  OS_NAME: "ubi"
  OS_VERSION: "7"
  CUDA_VERSION: "10.1"

.ubi7_10_1_x86_64_only: &ubi7_10_1_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubi7_10_1_x86_64_variables
  rules:
    - if: '$ubi7_10_1_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v10.1-x86_64:
  <<: *cuda_base_definition
  <<: *ubi7_10_1_x86_64_only

ubi7-v10.1-cudnn8-x86_64:
  <<: *cudnn_definition
  <<: *ubi7_10_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_10_1_x86_64_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubi7-v10.1-x86_64
      artifacts: true

ubi7-v10.1-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubi7_10_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_10_1_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubi7-v10.1-x86_64
      artifacts: true

ubi7-v10.1-test-x86_64:
  needs: ["ubi7-v10.1-x86_64"]
  <<: *ubi7_10_1_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_1_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v10.1-scan-x86_64:
  <<: *scan_definition
  <<: *ubi7_10_1_x86_64_only
  needs:
    - job: ubi7-v10.1-x86_64
    - job: ubi7-v10.1-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_1_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v10.1-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubi7_10_1_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubi7-v10.1-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_1_x86_64 == "true" && $NO_TEST == "true"'

ubi7-v10.1-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubi7_10_1_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_1_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi7-v10.1-x86_64
      artifacts: true
    - job: ubi7-v10.1-test-x86_64
    - job: ubi7-v10.1-scan-x86_64
    - job: ubi7-v10.1-cudnn8-x86_64
    - job: ubi7-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi7-v10.1-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi7_10_1_x86_64_only
  rules:
    - if: '$ubi7_10_1_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v10.1-x86_64
      artifacts: true
    - job: ubi7-v10.1-cudnn8-x86_64
    - job: ubi7-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubi7-v10.1-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubi7_10_1_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_1_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi7-v10.1-x86_64
      artifacts: true
    - job: ubi7-v10.1-scan-no-test-x86_64
    - job: ubi7-v10.1-cudnn8-x86_64
    - job: ubi7-v10.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi7-v10.1-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubi7_10_1_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_1_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v10.1-x86_64
      artifacts: true
    - job: ubi7-v10.1-test-x86_64
    - job: ubi7-v10.1-cudnn8-x86_64
    - job: ubi7-v10.1-cudnn7-x86_64

.ubi7_10_1_ppc64le_variables: &ubi7_10_1_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/10.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi7"
  OS_NAME: "ubi"
  OS_VERSION: "7"
  CUDA_VERSION: "10.1"

.ubi7_10_1_ppc64le_only: &ubi7_10_1_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubi7_10_1_ppc64le_variables
  rules:
    - if: '$ubi7_10_1_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v10.1-ppc64le:
  <<: *cuda_base_definition
  <<: *ubi7_10_1_ppc64le_only

ubi7-v10.1-cudnn8-ppc64le:
  <<: *cudnn_definition
  <<: *ubi7_10_1_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_10_1_ppc64le_variables
    CUDNN_VERSION: "cudnn8"
  artifacts:
    reports:
      dotenv: cudnn8finaltags.env
  needs:
    - job: ubi7-v10.1-ppc64le
      artifacts: true

ubi7-v10.1-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *ubi7_10_1_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_10_1_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubi7-v10.1-ppc64le
      artifacts: true

ubi7-v10.1-test-ppc64le:
  needs: ["ubi7-v10.1-ppc64le"]
  <<: *ubi7_10_1_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_1_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v10.1-scan-ppc64le:
  <<: *scan_definition
  <<: *ubi7_10_1_ppc64le_only
  needs:
    - job: ubi7-v10.1-ppc64le
    - job: ubi7-v10.1-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_1_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v10.1-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubi7_10_1_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubi7-v10.1-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_1_ppc64le == "true" && $NO_TEST == "true"'

ubi7-v10.1-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubi7_10_1_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_1_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi7-v10.1-ppc64le
      artifacts: true
    - job: ubi7-v10.1-test-ppc64le
    - job: ubi7-v10.1-scan-ppc64le
    - job: ubi7-v10.1-cudnn8-ppc64le
    - job: ubi7-v10.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi7-v10.1-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi7_10_1_ppc64le_only
  rules:
    - if: '$ubi7_10_1_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v10.1-ppc64le
      artifacts: true
    - job: ubi7-v10.1-cudnn8-ppc64le
    - job: ubi7-v10.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
ubi7-v10.1-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubi7_10_1_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_1_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi7-v10.1-ppc64le
      artifacts: true
    - job: ubi7-v10.1-scan-no-test-ppc64le
    - job: ubi7-v10.1-cudnn8-ppc64le
    - job: ubi7-v10.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubi7-v10.1-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubi7_10_1_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_1_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v10.1-ppc64le
      artifacts: true
    - job: ubi7-v10.1-test-ppc64le
    - job: ubi7-v10.1-cudnn8-ppc64le
    - job: ubi7-v10.1-cudnn7-ppc64le

.ubuntu18_04_10_0_x86_64_variables: &ubuntu18_04_10_0_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/10.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu18.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "18.04"
  CUDA_VERSION: "10.0"

.ubuntu18_04_10_0_x86_64_only: &ubuntu18_04_10_0_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu18_04_10_0_x86_64_variables
  rules:
    - if: '$ubuntu18_04_10_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.0-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu18_04_10_0_x86_64_only

ubuntu18.04-v10.0-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu18_04_10_0_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu18_04_10_0_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubuntu18.04-v10.0-x86_64
      artifacts: true

ubuntu18.04-v10.0-test-x86_64:
  needs: ["ubuntu18.04-v10.0-x86_64"]
  <<: *ubuntu18_04_10_0_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.0-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu18_04_10_0_x86_64_only
  needs:
    - job: ubuntu18.04-v10.0-x86_64
    - job: ubuntu18.04-v10.0-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.0-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu18_04_10_0_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu18.04-v10.0-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_0_x86_64 == "true" && $NO_TEST == "true"'

ubuntu18.04-v10.0-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_0_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_0_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu18.04-v10.0-x86_64
      artifacts: true
    - job: ubuntu18.04-v10.0-test-x86_64
    - job: ubuntu18.04-v10.0-scan-x86_64
    - job: ubuntu18.04-v10.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu18.04-v10.0-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_0_x86_64_only
  rules:
    - if: '$ubuntu18_04_10_0_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v10.0-x86_64
      artifacts: true
    - job: ubuntu18.04-v10.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu18.04-v10.0-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_0_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_0_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu18.04-v10.0-x86_64
      artifacts: true
    - job: ubuntu18.04-v10.0-scan-no-test-x86_64
    - job: ubuntu18.04-v10.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu18.04-v10.0-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_0_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_0_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v10.0-x86_64
      artifacts: true
    - job: ubuntu18.04-v10.0-test-x86_64
    - job: ubuntu18.04-v10.0-cudnn7-x86_64

.ubuntu18_04_10_0_ppc64le_variables: &ubuntu18_04_10_0_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/10.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu18.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "18.04"
  CUDA_VERSION: "10.0"

.ubuntu18_04_10_0_ppc64le_only: &ubuntu18_04_10_0_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubuntu18_04_10_0_ppc64le_variables
  rules:
    - if: '$ubuntu18_04_10_0_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.0-ppc64le:
  <<: *cuda_base_definition
  <<: *ubuntu18_04_10_0_ppc64le_only

ubuntu18.04-v10.0-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *ubuntu18_04_10_0_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu18_04_10_0_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubuntu18.04-v10.0-ppc64le
      artifacts: true

ubuntu18.04-v10.0-test-ppc64le:
  needs: ["ubuntu18.04-v10.0-ppc64le"]
  <<: *ubuntu18_04_10_0_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_0_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.0-scan-ppc64le:
  <<: *scan_definition
  <<: *ubuntu18_04_10_0_ppc64le_only
  needs:
    - job: ubuntu18.04-v10.0-ppc64le
    - job: ubuntu18.04-v10.0-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_0_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu18.04-v10.0-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubuntu18_04_10_0_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubuntu18.04-v10.0-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_0_ppc64le == "true" && $NO_TEST == "true"'

ubuntu18.04-v10.0-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_0_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_0_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu18.04-v10.0-ppc64le
      artifacts: true
    - job: ubuntu18.04-v10.0-test-ppc64le
    - job: ubuntu18.04-v10.0-scan-ppc64le
    - job: ubuntu18.04-v10.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu18.04-v10.0-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_0_ppc64le_only
  rules:
    - if: '$ubuntu18_04_10_0_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v10.0-ppc64le
      artifacts: true
    - job: ubuntu18.04-v10.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu18.04-v10.0-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_0_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_10_0_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu18.04-v10.0-ppc64le
      artifacts: true
    - job: ubuntu18.04-v10.0-scan-no-test-ppc64le
    - job: ubuntu18.04-v10.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu18.04-v10.0-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_10_0_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_10_0_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v10.0-ppc64le
      artifacts: true
    - job: ubuntu18.04-v10.0-test-ppc64le
    - job: ubuntu18.04-v10.0-cudnn7-ppc64le

.ubuntu16_04_10_0_x86_64_variables: &ubuntu16_04_10_0_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/10.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubuntu16.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "16.04"
  CUDA_VERSION: "10.0"

.ubuntu16_04_10_0_x86_64_only: &ubuntu16_04_10_0_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu16_04_10_0_x86_64_variables
  rules:
    - if: '$ubuntu16_04_10_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v10.0-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu16_04_10_0_x86_64_only

ubuntu16.04-v10.0-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu16_04_10_0_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_10_0_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubuntu16.04-v10.0-x86_64
      artifacts: true

ubuntu16.04-v10.0-test-x86_64:
  needs: ["ubuntu16.04-v10.0-x86_64"]
  <<: *ubuntu16_04_10_0_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_10_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v10.0-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_10_0_x86_64_only
  needs:
    - job: ubuntu16.04-v10.0-x86_64
    - job: ubuntu16.04-v10.0-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_10_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v10.0-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_10_0_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu16.04-v10.0-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_10_0_x86_64 == "true" && $NO_TEST == "true"'

ubuntu16.04-v10.0-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu16_04_10_0_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_10_0_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu16.04-v10.0-x86_64
      artifacts: true
    - job: ubuntu16.04-v10.0-test-x86_64
    - job: ubuntu16.04-v10.0-scan-x86_64
    - job: ubuntu16.04-v10.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu16.04-v10.0-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_10_0_x86_64_only
  rules:
    - if: '$ubuntu16_04_10_0_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v10.0-x86_64
      artifacts: true
    - job: ubuntu16.04-v10.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu16.04-v10.0-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu16_04_10_0_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_10_0_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu16.04-v10.0-x86_64
      artifacts: true
    - job: ubuntu16.04-v10.0-scan-no-test-x86_64
    - job: ubuntu16.04-v10.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu16.04-v10.0-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_10_0_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_10_0_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v10.0-x86_64
      artifacts: true
    - job: ubuntu16.04-v10.0-test-x86_64
    - job: ubuntu16.04-v10.0-cudnn7-x86_64

.centos7_10_0_x86_64_variables: &centos7_10_0_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/10.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos7"
  OS_NAME: "centos"
  OS_VERSION: "7"
  CUDA_VERSION: "10.0"

.centos7_10_0_x86_64_only: &centos7_10_0_x86_64_only
  <<: *tags_definition
  variables:
    <<: *centos7_10_0_x86_64_variables
  rules:
    - if: '$centos7_10_0_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v10.0-x86_64:
  <<: *cuda_base_definition
  <<: *centos7_10_0_x86_64_only

centos7-v10.0-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *centos7_10_0_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_10_0_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: centos7-v10.0-x86_64
      artifacts: true

centos7-v10.0-test-x86_64:
  needs: ["centos7-v10.0-x86_64"]
  <<: *centos7_10_0_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_10_0_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v10.0-scan-x86_64:
  <<: *scan_definition
  <<: *centos7_10_0_x86_64_only
  needs:
    - job: centos7-v10.0-x86_64
    - job: centos7-v10.0-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos7_10_0_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v10.0-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *centos7_10_0_x86_64_only
  # Override rules from only definition
  needs:
    - job: centos7-v10.0-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_0_x86_64 == "true" && $NO_TEST == "true"'

centos7-v10.0-deploy-x86_64:
  <<: *deploy_definition
  <<: *centos7_10_0_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_0_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos7-v10.0-x86_64
      artifacts: true
    - job: centos7-v10.0-test-x86_64
    - job: centos7-v10.0-scan-x86_64
    - job: centos7-v10.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos7-v10.0-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos7_10_0_x86_64_only
  rules:
    - if: '$centos7_10_0_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v10.0-x86_64
      artifacts: true
    - job: centos7-v10.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
centos7-v10.0-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *centos7_10_0_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_0_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos7-v10.0-x86_64
      artifacts: true
    - job: centos7-v10.0-scan-no-test-x86_64
    - job: centos7-v10.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
centos7-v10.0-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *centos7_10_0_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_10_0_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v10.0-x86_64
      artifacts: true
    - job: centos7-v10.0-test-x86_64
    - job: centos7-v10.0-cudnn7-x86_64

.centos7_10_0_ppc64le_variables: &centos7_10_0_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/10.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos7"
  OS_NAME: "centos"
  OS_VERSION: "7"
  CUDA_VERSION: "10.0"

.centos7_10_0_ppc64le_only: &centos7_10_0_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *centos7_10_0_ppc64le_variables
  rules:
    - if: '$centos7_10_0_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v10.0-ppc64le:
  <<: *cuda_base_definition
  <<: *centos7_10_0_ppc64le_only

centos7-v10.0-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *centos7_10_0_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_10_0_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: centos7-v10.0-ppc64le
      artifacts: true

centos7-v10.0-test-ppc64le:
  needs: ["centos7-v10.0-ppc64le"]
  <<: *centos7_10_0_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_10_0_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v10.0-scan-ppc64le:
  <<: *scan_definition
  <<: *centos7_10_0_ppc64le_only
  needs:
    - job: centos7-v10.0-ppc64le
    - job: centos7-v10.0-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos7_10_0_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v10.0-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *centos7_10_0_ppc64le_only
  # Override rules from only definition
  needs:
    - job: centos7-v10.0-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_0_ppc64le == "true" && $NO_TEST == "true"'

centos7-v10.0-deploy-ppc64le:
  <<: *deploy_definition
  <<: *centos7_10_0_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_0_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos7-v10.0-ppc64le
      artifacts: true
    - job: centos7-v10.0-test-ppc64le
    - job: centos7-v10.0-scan-ppc64le
    - job: centos7-v10.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos7-v10.0-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos7_10_0_ppc64le_only
  rules:
    - if: '$centos7_10_0_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v10.0-ppc64le
      artifacts: true
    - job: centos7-v10.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
centos7-v10.0-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *centos7_10_0_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_10_0_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: centos7-v10.0-ppc64le
      artifacts: true
    - job: centos7-v10.0-scan-no-test-ppc64le
    - job: centos7-v10.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
centos7-v10.0-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *centos7_10_0_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_10_0_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v10.0-ppc64le
      artifacts: true
    - job: centos7-v10.0-test-ppc64le
    - job: centos7-v10.0-cudnn7-ppc64le

.ubi7_10_0_x86_64_variables: &ubi7_10_0_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/10.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi7"
  OS_NAME: "ubi"
  OS_VERSION: "7"
  CUDA_VERSION: "10.0"

.ubi7_10_0_x86_64_only: &ubi7_10_0_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubi7_10_0_x86_64_variables
  rules:
    - if: '$ubi7_10_0_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v10.0-x86_64:
  <<: *cuda_base_definition
  <<: *ubi7_10_0_x86_64_only

ubi7-v10.0-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubi7_10_0_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_10_0_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubi7-v10.0-x86_64
      artifacts: true

ubi7-v10.0-test-x86_64:
  needs: ["ubi7-v10.0-x86_64"]
  <<: *ubi7_10_0_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_0_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v10.0-scan-x86_64:
  <<: *scan_definition
  <<: *ubi7_10_0_x86_64_only
  needs:
    - job: ubi7-v10.0-x86_64
    - job: ubi7-v10.0-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_0_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v10.0-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubi7_10_0_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubi7-v10.0-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_0_x86_64 == "true" && $NO_TEST == "true"'

ubi7-v10.0-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubi7_10_0_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_0_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi7-v10.0-x86_64
      artifacts: true
    - job: ubi7-v10.0-test-x86_64
    - job: ubi7-v10.0-scan-x86_64
    - job: ubi7-v10.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi7-v10.0-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi7_10_0_x86_64_only
  rules:
    - if: '$ubi7_10_0_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v10.0-x86_64
      artifacts: true
    - job: ubi7-v10.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubi7-v10.0-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubi7_10_0_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_0_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi7-v10.0-x86_64
      artifacts: true
    - job: ubi7-v10.0-scan-no-test-x86_64
    - job: ubi7-v10.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi7-v10.0-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubi7_10_0_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_0_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v10.0-x86_64
      artifacts: true
    - job: ubi7-v10.0-test-x86_64
    - job: ubi7-v10.0-cudnn7-x86_64

.ubi7_10_0_ppc64le_variables: &ubi7_10_0_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/10.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi7"
  OS_NAME: "ubi"
  OS_VERSION: "7"
  CUDA_VERSION: "10.0"

.ubi7_10_0_ppc64le_only: &ubi7_10_0_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubi7_10_0_ppc64le_variables
  rules:
    - if: '$ubi7_10_0_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v10.0-ppc64le:
  <<: *cuda_base_definition
  <<: *ubi7_10_0_ppc64le_only

ubi7-v10.0-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *ubi7_10_0_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_10_0_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubi7-v10.0-ppc64le
      artifacts: true

ubi7-v10.0-test-ppc64le:
  needs: ["ubi7-v10.0-ppc64le"]
  <<: *ubi7_10_0_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_0_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v10.0-scan-ppc64le:
  <<: *scan_definition
  <<: *ubi7_10_0_ppc64le_only
  needs:
    - job: ubi7-v10.0-ppc64le
    - job: ubi7-v10.0-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_0_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v10.0-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubi7_10_0_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubi7-v10.0-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_0_ppc64le == "true" && $NO_TEST == "true"'

ubi7-v10.0-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubi7_10_0_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_0_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi7-v10.0-ppc64le
      artifacts: true
    - job: ubi7-v10.0-test-ppc64le
    - job: ubi7-v10.0-scan-ppc64le
    - job: ubi7-v10.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi7-v10.0-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi7_10_0_ppc64le_only
  rules:
    - if: '$ubi7_10_0_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v10.0-ppc64le
      artifacts: true
    - job: ubi7-v10.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
ubi7-v10.0-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubi7_10_0_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_10_0_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi7-v10.0-ppc64le
      artifacts: true
    - job: ubi7-v10.0-scan-no-test-ppc64le
    - job: ubi7-v10.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubi7-v10.0-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubi7_10_0_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_10_0_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v10.0-ppc64le
      artifacts: true
    - job: ubi7-v10.0-test-ppc64le
    - job: ubi7-v10.0-cudnn7-ppc64le

.ubuntu18_04_9_2_x86_64_variables: &ubuntu18_04_9_2_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/9.2"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu18.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "18.04"
  CUDA_VERSION: "9.2"

.ubuntu18_04_9_2_x86_64_only: &ubuntu18_04_9_2_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu18_04_9_2_x86_64_variables
  rules:
    - if: '$ubuntu18_04_9_2_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v9.2-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu18_04_9_2_x86_64_only

ubuntu18.04-v9.2-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu18_04_9_2_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu18_04_9_2_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubuntu18.04-v9.2-x86_64
      artifacts: true

ubuntu18.04-v9.2-test-x86_64:
  needs: ["ubuntu18.04-v9.2-x86_64"]
  <<: *ubuntu18_04_9_2_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_9_2_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v9.2-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu18_04_9_2_x86_64_only
  needs:
    - job: ubuntu18.04-v9.2-x86_64
    - job: ubuntu18.04-v9.2-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_9_2_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu18.04-v9.2-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu18_04_9_2_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu18.04-v9.2-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_9_2_x86_64 == "true" && $NO_TEST == "true"'

ubuntu18.04-v9.2-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu18_04_9_2_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_9_2_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu18.04-v9.2-x86_64
      artifacts: true
    - job: ubuntu18.04-v9.2-test-x86_64
    - job: ubuntu18.04-v9.2-scan-x86_64
    - job: ubuntu18.04-v9.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu18.04-v9.2-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_9_2_x86_64_only
  rules:
    - if: '$ubuntu18_04_9_2_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v9.2-x86_64
      artifacts: true
    - job: ubuntu18.04-v9.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu18.04-v9.2-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu18_04_9_2_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu18_04_9_2_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu18.04-v9.2-x86_64
      artifacts: true
    - job: ubuntu18.04-v9.2-scan-no-test-x86_64
    - job: ubuntu18.04-v9.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu18.04-v9.2-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu18_04_9_2_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu18_04_9_2_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu18.04-v9.2-x86_64
      artifacts: true
    - job: ubuntu18.04-v9.2-test-x86_64
    - job: ubuntu18.04-v9.2-cudnn7-x86_64

.ubuntu16_04_9_2_x86_64_variables: &ubuntu16_04_9_2_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/9.2"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubuntu16.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "16.04"
  CUDA_VERSION: "9.2"

.ubuntu16_04_9_2_x86_64_only: &ubuntu16_04_9_2_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu16_04_9_2_x86_64_variables
  rules:
    - if: '$ubuntu16_04_9_2_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v9.2-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu16_04_9_2_x86_64_only

ubuntu16.04-v9.2-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu16_04_9_2_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_9_2_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubuntu16.04-v9.2-x86_64
      artifacts: true

ubuntu16.04-v9.2-test-x86_64:
  needs: ["ubuntu16.04-v9.2-x86_64"]
  <<: *ubuntu16_04_9_2_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_9_2_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v9.2-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_9_2_x86_64_only
  needs:
    - job: ubuntu16.04-v9.2-x86_64
    - job: ubuntu16.04-v9.2-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_9_2_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v9.2-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_9_2_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu16.04-v9.2-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_9_2_x86_64 == "true" && $NO_TEST == "true"'

ubuntu16.04-v9.2-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_2_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_9_2_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu16.04-v9.2-x86_64
      artifacts: true
    - job: ubuntu16.04-v9.2-test-x86_64
    - job: ubuntu16.04-v9.2-scan-x86_64
    - job: ubuntu16.04-v9.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu16.04-v9.2-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_2_x86_64_only
  rules:
    - if: '$ubuntu16_04_9_2_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v9.2-x86_64
      artifacts: true
    - job: ubuntu16.04-v9.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu16.04-v9.2-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_2_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_9_2_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu16.04-v9.2-x86_64
      artifacts: true
    - job: ubuntu16.04-v9.2-scan-no-test-x86_64
    - job: ubuntu16.04-v9.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu16.04-v9.2-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_2_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_9_2_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v9.2-x86_64
      artifacts: true
    - job: ubuntu16.04-v9.2-test-x86_64
    - job: ubuntu16.04-v9.2-cudnn7-x86_64

.centos7_9_2_x86_64_variables: &centos7_9_2_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/9.2"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos7"
  OS_NAME: "centos"
  OS_VERSION: "7"
  CUDA_VERSION: "9.2"

.centos7_9_2_x86_64_only: &centos7_9_2_x86_64_only
  <<: *tags_definition
  variables:
    <<: *centos7_9_2_x86_64_variables
  rules:
    - if: '$centos7_9_2_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v9.2-x86_64:
  <<: *cuda_base_definition
  <<: *centos7_9_2_x86_64_only

centos7-v9.2-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *centos7_9_2_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_9_2_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: centos7-v9.2-x86_64
      artifacts: true

centos7-v9.2-test-x86_64:
  needs: ["centos7-v9.2-x86_64"]
  <<: *centos7_9_2_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_9_2_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v9.2-scan-x86_64:
  <<: *scan_definition
  <<: *centos7_9_2_x86_64_only
  needs:
    - job: centos7-v9.2-x86_64
    - job: centos7-v9.2-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos7_9_2_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v9.2-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *centos7_9_2_x86_64_only
  # Override rules from only definition
  needs:
    - job: centos7-v9.2-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_2_x86_64 == "true" && $NO_TEST == "true"'

centos7-v9.2-deploy-x86_64:
  <<: *deploy_definition
  <<: *centos7_9_2_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_2_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos7-v9.2-x86_64
      artifacts: true
    - job: centos7-v9.2-test-x86_64
    - job: centos7-v9.2-scan-x86_64
    - job: centos7-v9.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos7-v9.2-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos7_9_2_x86_64_only
  rules:
    - if: '$centos7_9_2_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v9.2-x86_64
      artifacts: true
    - job: centos7-v9.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
centos7-v9.2-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *centos7_9_2_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_2_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos7-v9.2-x86_64
      artifacts: true
    - job: centos7-v9.2-scan-no-test-x86_64
    - job: centos7-v9.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
centos7-v9.2-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *centos7_9_2_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_9_2_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v9.2-x86_64
      artifacts: true
    - job: centos7-v9.2-test-x86_64
    - job: centos7-v9.2-cudnn7-x86_64

.centos7_9_2_ppc64le_variables: &centos7_9_2_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/9.2"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos7"
  OS_NAME: "centos"
  OS_VERSION: "7"
  CUDA_VERSION: "9.2"

.centos7_9_2_ppc64le_only: &centos7_9_2_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *centos7_9_2_ppc64le_variables
  rules:
    - if: '$centos7_9_2_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v9.2-ppc64le:
  <<: *cuda_base_definition
  <<: *centos7_9_2_ppc64le_only

centos7-v9.2-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *centos7_9_2_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_9_2_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: centos7-v9.2-ppc64le
      artifacts: true

centos7-v9.2-test-ppc64le:
  needs: ["centos7-v9.2-ppc64le"]
  <<: *centos7_9_2_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_9_2_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v9.2-scan-ppc64le:
  <<: *scan_definition
  <<: *centos7_9_2_ppc64le_only
  needs:
    - job: centos7-v9.2-ppc64le
    - job: centos7-v9.2-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos7_9_2_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v9.2-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *centos7_9_2_ppc64le_only
  # Override rules from only definition
  needs:
    - job: centos7-v9.2-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_2_ppc64le == "true" && $NO_TEST == "true"'

centos7-v9.2-deploy-ppc64le:
  <<: *deploy_definition
  <<: *centos7_9_2_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_2_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos7-v9.2-ppc64le
      artifacts: true
    - job: centos7-v9.2-test-ppc64le
    - job: centos7-v9.2-scan-ppc64le
    - job: centos7-v9.2-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos7-v9.2-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos7_9_2_ppc64le_only
  rules:
    - if: '$centos7_9_2_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v9.2-ppc64le
      artifacts: true
    - job: centos7-v9.2-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
centos7-v9.2-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *centos7_9_2_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_2_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: centos7-v9.2-ppc64le
      artifacts: true
    - job: centos7-v9.2-scan-no-test-ppc64le
    - job: centos7-v9.2-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
centos7-v9.2-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *centos7_9_2_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_9_2_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v9.2-ppc64le
      artifacts: true
    - job: centos7-v9.2-test-ppc64le
    - job: centos7-v9.2-cudnn7-ppc64le

.ubi7_9_2_x86_64_variables: &ubi7_9_2_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/9.2"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi7"
  OS_NAME: "ubi"
  OS_VERSION: "7"
  CUDA_VERSION: "9.2"

.ubi7_9_2_x86_64_only: &ubi7_9_2_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubi7_9_2_x86_64_variables
  rules:
    - if: '$ubi7_9_2_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v9.2-x86_64:
  <<: *cuda_base_definition
  <<: *ubi7_9_2_x86_64_only

ubi7-v9.2-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubi7_9_2_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_9_2_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubi7-v9.2-x86_64
      artifacts: true

ubi7-v9.2-test-x86_64:
  needs: ["ubi7-v9.2-x86_64"]
  <<: *ubi7_9_2_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_2_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v9.2-scan-x86_64:
  <<: *scan_definition
  <<: *ubi7_9_2_x86_64_only
  needs:
    - job: ubi7-v9.2-x86_64
    - job: ubi7-v9.2-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_2_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v9.2-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubi7_9_2_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubi7-v9.2-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_2_x86_64 == "true" && $NO_TEST == "true"'

ubi7-v9.2-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubi7_9_2_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_2_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi7-v9.2-x86_64
      artifacts: true
    - job: ubi7-v9.2-test-x86_64
    - job: ubi7-v9.2-scan-x86_64
    - job: ubi7-v9.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi7-v9.2-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi7_9_2_x86_64_only
  rules:
    - if: '$ubi7_9_2_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v9.2-x86_64
      artifacts: true
    - job: ubi7-v9.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubi7-v9.2-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubi7_9_2_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_2_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi7-v9.2-x86_64
      artifacts: true
    - job: ubi7-v9.2-scan-no-test-x86_64
    - job: ubi7-v9.2-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi7-v9.2-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubi7_9_2_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_2_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v9.2-x86_64
      artifacts: true
    - job: ubi7-v9.2-test-x86_64
    - job: ubi7-v9.2-cudnn7-x86_64

.ubi7_9_2_ppc64le_variables: &ubi7_9_2_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/9.2"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi7"
  OS_NAME: "ubi"
  OS_VERSION: "7"
  CUDA_VERSION: "9.2"

.ubi7_9_2_ppc64le_only: &ubi7_9_2_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubi7_9_2_ppc64le_variables
  rules:
    - if: '$ubi7_9_2_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v9.2-ppc64le:
  <<: *cuda_base_definition
  <<: *ubi7_9_2_ppc64le_only

ubi7-v9.2-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *ubi7_9_2_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_9_2_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubi7-v9.2-ppc64le
      artifacts: true

ubi7-v9.2-test-ppc64le:
  needs: ["ubi7-v9.2-ppc64le"]
  <<: *ubi7_9_2_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_2_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v9.2-scan-ppc64le:
  <<: *scan_definition
  <<: *ubi7_9_2_ppc64le_only
  needs:
    - job: ubi7-v9.2-ppc64le
    - job: ubi7-v9.2-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_2_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v9.2-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubi7_9_2_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubi7-v9.2-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_2_ppc64le == "true" && $NO_TEST == "true"'

ubi7-v9.2-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubi7_9_2_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_2_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi7-v9.2-ppc64le
      artifacts: true
    - job: ubi7-v9.2-test-ppc64le
    - job: ubi7-v9.2-scan-ppc64le
    - job: ubi7-v9.2-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi7-v9.2-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi7_9_2_ppc64le_only
  rules:
    - if: '$ubi7_9_2_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v9.2-ppc64le
      artifacts: true
    - job: ubi7-v9.2-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
ubi7-v9.2-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubi7_9_2_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_2_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi7-v9.2-ppc64le
      artifacts: true
    - job: ubi7-v9.2-scan-no-test-ppc64le
    - job: ubi7-v9.2-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubi7-v9.2-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubi7_9_2_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_2_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v9.2-ppc64le
      artifacts: true
    - job: ubi7-v9.2-test-ppc64le
    - job: ubi7-v9.2-cudnn7-ppc64le

.ubuntu16_04_9_1_x86_64_variables: &ubuntu16_04_9_1_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/9.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu16.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "16.04"
  CUDA_VERSION: "9.1"

.ubuntu16_04_9_1_x86_64_only: &ubuntu16_04_9_1_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu16_04_9_1_x86_64_variables
  rules:
    - if: '$ubuntu16_04_9_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v9.1-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu16_04_9_1_x86_64_only

ubuntu16.04-v9.1-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu16_04_9_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_9_1_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubuntu16.04-v9.1-x86_64
      artifacts: true

ubuntu16.04-v9.1-test-x86_64:
  needs: ["ubuntu16.04-v9.1-x86_64"]
  <<: *ubuntu16_04_9_1_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_9_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v9.1-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_9_1_x86_64_only
  needs:
    - job: ubuntu16.04-v9.1-x86_64
    - job: ubuntu16.04-v9.1-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_9_1_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v9.1-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_9_1_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu16.04-v9.1-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_9_1_x86_64 == "true" && $NO_TEST == "true"'

ubuntu16.04-v9.1-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_1_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_9_1_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu16.04-v9.1-x86_64
      artifacts: true
    - job: ubuntu16.04-v9.1-test-x86_64
    - job: ubuntu16.04-v9.1-scan-x86_64
    - job: ubuntu16.04-v9.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu16.04-v9.1-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_1_x86_64_only
  rules:
    - if: '$ubuntu16_04_9_1_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v9.1-x86_64
      artifacts: true
    - job: ubuntu16.04-v9.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu16.04-v9.1-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_1_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_9_1_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu16.04-v9.1-x86_64
      artifacts: true
    - job: ubuntu16.04-v9.1-scan-no-test-x86_64
    - job: ubuntu16.04-v9.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu16.04-v9.1-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_1_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_9_1_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v9.1-x86_64
      artifacts: true
    - job: ubuntu16.04-v9.1-test-x86_64
    - job: ubuntu16.04-v9.1-cudnn7-x86_64

.ubuntu16_04_9_1_ppc64le_variables: &ubuntu16_04_9_1_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/9.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu16.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "16.04"
  CUDA_VERSION: "9.1"

.ubuntu16_04_9_1_ppc64le_only: &ubuntu16_04_9_1_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubuntu16_04_9_1_ppc64le_variables
  rules:
    - if: '$ubuntu16_04_9_1_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu16.04-v9.1-ppc64le:
  <<: *cuda_base_definition
  <<: *ubuntu16_04_9_1_ppc64le_only

ubuntu16.04-v9.1-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *ubuntu16_04_9_1_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_9_1_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubuntu16.04-v9.1-ppc64le
      artifacts: true

ubuntu16.04-v9.1-test-ppc64le:
  needs: ["ubuntu16.04-v9.1-ppc64le"]
  <<: *ubuntu16_04_9_1_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_9_1_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu16.04-v9.1-scan-ppc64le:
  <<: *scan_definition
  <<: *ubuntu16_04_9_1_ppc64le_only
  needs:
    - job: ubuntu16.04-v9.1-ppc64le
    - job: ubuntu16.04-v9.1-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_9_1_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu16.04-v9.1-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubuntu16_04_9_1_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubuntu16.04-v9.1-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_9_1_ppc64le == "true" && $NO_TEST == "true"'

ubuntu16.04-v9.1-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_1_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_9_1_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu16.04-v9.1-ppc64le
      artifacts: true
    - job: ubuntu16.04-v9.1-test-ppc64le
    - job: ubuntu16.04-v9.1-scan-ppc64le
    - job: ubuntu16.04-v9.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu16.04-v9.1-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_1_ppc64le_only
  rules:
    - if: '$ubuntu16_04_9_1_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v9.1-ppc64le
      artifacts: true
    - job: ubuntu16.04-v9.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu16.04-v9.1-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_1_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_9_1_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu16.04-v9.1-ppc64le
      artifacts: true
    - job: ubuntu16.04-v9.1-scan-no-test-ppc64le
    - job: ubuntu16.04-v9.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu16.04-v9.1-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_1_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_9_1_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v9.1-ppc64le
      artifacts: true
    - job: ubuntu16.04-v9.1-test-ppc64le
    - job: ubuntu16.04-v9.1-cudnn7-ppc64le

.centos7_9_1_x86_64_variables: &centos7_9_1_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/9.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos7"
  OS_NAME: "centos"
  OS_VERSION: "7"
  CUDA_VERSION: "9.1"

.centos7_9_1_x86_64_only: &centos7_9_1_x86_64_only
  <<: *tags_definition
  variables:
    <<: *centos7_9_1_x86_64_variables
  rules:
    - if: '$centos7_9_1_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v9.1-x86_64:
  <<: *cuda_base_definition
  <<: *centos7_9_1_x86_64_only

centos7-v9.1-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *centos7_9_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_9_1_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: centos7-v9.1-x86_64
      artifacts: true

centos7-v9.1-test-x86_64:
  needs: ["centos7-v9.1-x86_64"]
  <<: *centos7_9_1_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_9_1_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v9.1-scan-x86_64:
  <<: *scan_definition
  <<: *centos7_9_1_x86_64_only
  needs:
    - job: centos7-v9.1-x86_64
    - job: centos7-v9.1-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos7_9_1_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v9.1-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *centos7_9_1_x86_64_only
  # Override rules from only definition
  needs:
    - job: centos7-v9.1-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_1_x86_64 == "true" && $NO_TEST == "true"'

centos7-v9.1-deploy-x86_64:
  <<: *deploy_definition
  <<: *centos7_9_1_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_1_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos7-v9.1-x86_64
      artifacts: true
    - job: centos7-v9.1-test-x86_64
    - job: centos7-v9.1-scan-x86_64
    - job: centos7-v9.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos7-v9.1-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos7_9_1_x86_64_only
  rules:
    - if: '$centos7_9_1_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v9.1-x86_64
      artifacts: true
    - job: centos7-v9.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
centos7-v9.1-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *centos7_9_1_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_1_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos7-v9.1-x86_64
      artifacts: true
    - job: centos7-v9.1-scan-no-test-x86_64
    - job: centos7-v9.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
centos7-v9.1-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *centos7_9_1_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_9_1_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v9.1-x86_64
      artifacts: true
    - job: centos7-v9.1-test-x86_64
    - job: centos7-v9.1-cudnn7-x86_64

.centos7_9_1_ppc64le_variables: &centos7_9_1_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/9.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos7"
  OS_NAME: "centos"
  OS_VERSION: "7"
  CUDA_VERSION: "9.1"

.centos7_9_1_ppc64le_only: &centos7_9_1_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *centos7_9_1_ppc64le_variables
  rules:
    - if: '$centos7_9_1_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v9.1-ppc64le:
  <<: *cuda_base_definition
  <<: *centos7_9_1_ppc64le_only

centos7-v9.1-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *centos7_9_1_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_9_1_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: centos7-v9.1-ppc64le
      artifacts: true

centos7-v9.1-test-ppc64le:
  needs: ["centos7-v9.1-ppc64le"]
  <<: *centos7_9_1_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_9_1_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v9.1-scan-ppc64le:
  <<: *scan_definition
  <<: *centos7_9_1_ppc64le_only
  needs:
    - job: centos7-v9.1-ppc64le
    - job: centos7-v9.1-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos7_9_1_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v9.1-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *centos7_9_1_ppc64le_only
  # Override rules from only definition
  needs:
    - job: centos7-v9.1-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_1_ppc64le == "true" && $NO_TEST == "true"'

centos7-v9.1-deploy-ppc64le:
  <<: *deploy_definition
  <<: *centos7_9_1_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_1_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos7-v9.1-ppc64le
      artifacts: true
    - job: centos7-v9.1-test-ppc64le
    - job: centos7-v9.1-scan-ppc64le
    - job: centos7-v9.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos7-v9.1-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos7_9_1_ppc64le_only
  rules:
    - if: '$centos7_9_1_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v9.1-ppc64le
      artifacts: true
    - job: centos7-v9.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
centos7-v9.1-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *centos7_9_1_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_1_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: centos7-v9.1-ppc64le
      artifacts: true
    - job: centos7-v9.1-scan-no-test-ppc64le
    - job: centos7-v9.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
centos7-v9.1-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *centos7_9_1_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_9_1_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v9.1-ppc64le
      artifacts: true
    - job: centos7-v9.1-test-ppc64le
    - job: centos7-v9.1-cudnn7-ppc64le

.ubi7_9_1_x86_64_variables: &ubi7_9_1_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/9.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi7"
  OS_NAME: "ubi"
  OS_VERSION: "7"
  CUDA_VERSION: "9.1"

.ubi7_9_1_x86_64_only: &ubi7_9_1_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubi7_9_1_x86_64_variables
  rules:
    - if: '$ubi7_9_1_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v9.1-x86_64:
  <<: *cuda_base_definition
  <<: *ubi7_9_1_x86_64_only

ubi7-v9.1-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubi7_9_1_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_9_1_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubi7-v9.1-x86_64
      artifacts: true

ubi7-v9.1-test-x86_64:
  needs: ["ubi7-v9.1-x86_64"]
  <<: *ubi7_9_1_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_1_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v9.1-scan-x86_64:
  <<: *scan_definition
  <<: *ubi7_9_1_x86_64_only
  needs:
    - job: ubi7-v9.1-x86_64
    - job: ubi7-v9.1-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_1_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v9.1-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubi7_9_1_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubi7-v9.1-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_1_x86_64 == "true" && $NO_TEST == "true"'

ubi7-v9.1-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubi7_9_1_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_1_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi7-v9.1-x86_64
      artifacts: true
    - job: ubi7-v9.1-test-x86_64
    - job: ubi7-v9.1-scan-x86_64
    - job: ubi7-v9.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi7-v9.1-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi7_9_1_x86_64_only
  rules:
    - if: '$ubi7_9_1_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v9.1-x86_64
      artifacts: true
    - job: ubi7-v9.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubi7-v9.1-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubi7_9_1_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_1_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi7-v9.1-x86_64
      artifacts: true
    - job: ubi7-v9.1-scan-no-test-x86_64
    - job: ubi7-v9.1-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi7-v9.1-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubi7_9_1_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_1_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v9.1-x86_64
      artifacts: true
    - job: ubi7-v9.1-test-x86_64
    - job: ubi7-v9.1-cudnn7-x86_64

.ubi7_9_1_ppc64le_variables: &ubi7_9_1_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/9.1"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi7"
  OS_NAME: "ubi"
  OS_VERSION: "7"
  CUDA_VERSION: "9.1"

.ubi7_9_1_ppc64le_only: &ubi7_9_1_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubi7_9_1_ppc64le_variables
  rules:
    - if: '$ubi7_9_1_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v9.1-ppc64le:
  <<: *cuda_base_definition
  <<: *ubi7_9_1_ppc64le_only

ubi7-v9.1-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *ubi7_9_1_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_9_1_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubi7-v9.1-ppc64le
      artifacts: true

ubi7-v9.1-test-ppc64le:
  needs: ["ubi7-v9.1-ppc64le"]
  <<: *ubi7_9_1_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_1_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v9.1-scan-ppc64le:
  <<: *scan_definition
  <<: *ubi7_9_1_ppc64le_only
  needs:
    - job: ubi7-v9.1-ppc64le
    - job: ubi7-v9.1-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_1_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v9.1-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubi7_9_1_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubi7-v9.1-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_1_ppc64le == "true" && $NO_TEST == "true"'

ubi7-v9.1-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubi7_9_1_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_1_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi7-v9.1-ppc64le
      artifacts: true
    - job: ubi7-v9.1-test-ppc64le
    - job: ubi7-v9.1-scan-ppc64le
    - job: ubi7-v9.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi7-v9.1-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi7_9_1_ppc64le_only
  rules:
    - if: '$ubi7_9_1_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v9.1-ppc64le
      artifacts: true
    - job: ubi7-v9.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
ubi7-v9.1-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubi7_9_1_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_1_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi7-v9.1-ppc64le
      artifacts: true
    - job: ubi7-v9.1-scan-no-test-ppc64le
    - job: ubi7-v9.1-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubi7-v9.1-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubi7_9_1_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_1_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v9.1-ppc64le
      artifacts: true
    - job: ubi7-v9.1-test-ppc64le
    - job: ubi7-v9.1-cudnn7-ppc64le

.ubuntu16_04_9_0_x86_64_variables: &ubuntu16_04_9_0_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/9.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu16.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "16.04"
  CUDA_VERSION: "9.0"

.ubuntu16_04_9_0_x86_64_only: &ubuntu16_04_9_0_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu16_04_9_0_x86_64_variables
  rules:
    - if: '$ubuntu16_04_9_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v9.0-x86_64:
  <<: *cuda_base_definition
  <<: *ubuntu16_04_9_0_x86_64_only

ubuntu16.04-v9.0-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu16_04_9_0_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_9_0_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubuntu16.04-v9.0-x86_64
      artifacts: true

ubuntu16.04-v9.0-test-x86_64:
  needs: ["ubuntu16.04-v9.0-x86_64"]
  <<: *ubuntu16_04_9_0_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_9_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v9.0-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_9_0_x86_64_only
  needs:
    - job: ubuntu16.04-v9.0-x86_64
    - job: ubuntu16.04-v9.0-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_9_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v9.0-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_9_0_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu16.04-v9.0-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_9_0_x86_64 == "true" && $NO_TEST == "true"'

ubuntu16.04-v9.0-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_0_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_9_0_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu16.04-v9.0-x86_64
      artifacts: true
    - job: ubuntu16.04-v9.0-test-x86_64
    - job: ubuntu16.04-v9.0-scan-x86_64
    - job: ubuntu16.04-v9.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu16.04-v9.0-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_0_x86_64_only
  rules:
    - if: '$ubuntu16_04_9_0_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v9.0-x86_64
      artifacts: true
    - job: ubuntu16.04-v9.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu16.04-v9.0-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_0_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_9_0_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu16.04-v9.0-x86_64
      artifacts: true
    - job: ubuntu16.04-v9.0-scan-no-test-x86_64
    - job: ubuntu16.04-v9.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu16.04-v9.0-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_0_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_9_0_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v9.0-x86_64
      artifacts: true
    - job: ubuntu16.04-v9.0-test-x86_64
    - job: ubuntu16.04-v9.0-cudnn7-x86_64

.ubuntu16_04_9_0_ppc64le_variables: &ubuntu16_04_9_0_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/9.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu16.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "16.04"
  CUDA_VERSION: "9.0"

.ubuntu16_04_9_0_ppc64le_only: &ubuntu16_04_9_0_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubuntu16_04_9_0_ppc64le_variables
  rules:
    - if: '$ubuntu16_04_9_0_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu16.04-v9.0-ppc64le:
  <<: *cuda_base_definition
  <<: *ubuntu16_04_9_0_ppc64le_only

ubuntu16.04-v9.0-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *ubuntu16_04_9_0_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_9_0_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubuntu16.04-v9.0-ppc64le
      artifacts: true

ubuntu16.04-v9.0-test-ppc64le:
  needs: ["ubuntu16.04-v9.0-ppc64le"]
  <<: *ubuntu16_04_9_0_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_9_0_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu16.04-v9.0-scan-ppc64le:
  <<: *scan_definition
  <<: *ubuntu16_04_9_0_ppc64le_only
  needs:
    - job: ubuntu16.04-v9.0-ppc64le
    - job: ubuntu16.04-v9.0-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_9_0_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu16.04-v9.0-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubuntu16_04_9_0_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubuntu16.04-v9.0-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_9_0_ppc64le == "true" && $NO_TEST == "true"'

ubuntu16.04-v9.0-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_0_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_9_0_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu16.04-v9.0-ppc64le
      artifacts: true
    - job: ubuntu16.04-v9.0-test-ppc64le
    - job: ubuntu16.04-v9.0-scan-ppc64le
    - job: ubuntu16.04-v9.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu16.04-v9.0-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_0_ppc64le_only
  rules:
    - if: '$ubuntu16_04_9_0_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v9.0-ppc64le
      artifacts: true
    - job: ubuntu16.04-v9.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu16.04-v9.0-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_0_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_9_0_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu16.04-v9.0-ppc64le
      artifacts: true
    - job: ubuntu16.04-v9.0-scan-no-test-ppc64le
    - job: ubuntu16.04-v9.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu16.04-v9.0-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_9_0_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_9_0_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v9.0-ppc64le
      artifacts: true
    - job: ubuntu16.04-v9.0-test-ppc64le
    - job: ubuntu16.04-v9.0-cudnn7-ppc64le

.centos7_9_0_x86_64_variables: &centos7_9_0_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/9.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos7"
  OS_NAME: "centos"
  OS_VERSION: "7"
  CUDA_VERSION: "9.0"

.centos7_9_0_x86_64_only: &centos7_9_0_x86_64_only
  <<: *tags_definition
  variables:
    <<: *centos7_9_0_x86_64_variables
  rules:
    - if: '$centos7_9_0_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v9.0-x86_64:
  <<: *cuda_base_definition
  <<: *centos7_9_0_x86_64_only

centos7-v9.0-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *centos7_9_0_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_9_0_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: centos7-v9.0-x86_64
      artifacts: true

centos7-v9.0-test-x86_64:
  needs: ["centos7-v9.0-x86_64"]
  <<: *centos7_9_0_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_9_0_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v9.0-scan-x86_64:
  <<: *scan_definition
  <<: *centos7_9_0_x86_64_only
  needs:
    - job: centos7-v9.0-x86_64
    - job: centos7-v9.0-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos7_9_0_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v9.0-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *centos7_9_0_x86_64_only
  # Override rules from only definition
  needs:
    - job: centos7-v9.0-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_0_x86_64 == "true" && $NO_TEST == "true"'

centos7-v9.0-deploy-x86_64:
  <<: *deploy_definition
  <<: *centos7_9_0_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_0_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos7-v9.0-x86_64
      artifacts: true
    - job: centos7-v9.0-test-x86_64
    - job: centos7-v9.0-scan-x86_64
    - job: centos7-v9.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos7-v9.0-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos7_9_0_x86_64_only
  rules:
    - if: '$centos7_9_0_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v9.0-x86_64
      artifacts: true
    - job: centos7-v9.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
centos7-v9.0-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *centos7_9_0_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_0_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos7-v9.0-x86_64
      artifacts: true
    - job: centos7-v9.0-scan-no-test-x86_64
    - job: centos7-v9.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
centos7-v9.0-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *centos7_9_0_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_9_0_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v9.0-x86_64
      artifacts: true
    - job: centos7-v9.0-test-x86_64
    - job: centos7-v9.0-cudnn7-x86_64

.centos7_9_0_ppc64le_variables: &centos7_9_0_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/9.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos7"
  OS_NAME: "centos"
  OS_VERSION: "7"
  CUDA_VERSION: "9.0"

.centos7_9_0_ppc64le_only: &centos7_9_0_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *centos7_9_0_ppc64le_variables
  rules:
    - if: '$centos7_9_0_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v9.0-ppc64le:
  <<: *cuda_base_definition
  <<: *centos7_9_0_ppc64le_only

centos7-v9.0-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *centos7_9_0_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_9_0_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: centos7-v9.0-ppc64le
      artifacts: true

centos7-v9.0-test-ppc64le:
  needs: ["centos7-v9.0-ppc64le"]
  <<: *centos7_9_0_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_9_0_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v9.0-scan-ppc64le:
  <<: *scan_definition
  <<: *centos7_9_0_ppc64le_only
  needs:
    - job: centos7-v9.0-ppc64le
    - job: centos7-v9.0-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos7_9_0_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v9.0-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *centos7_9_0_ppc64le_only
  # Override rules from only definition
  needs:
    - job: centos7-v9.0-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_0_ppc64le == "true" && $NO_TEST == "true"'

centos7-v9.0-deploy-ppc64le:
  <<: *deploy_definition
  <<: *centos7_9_0_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_0_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos7-v9.0-ppc64le
      artifacts: true
    - job: centos7-v9.0-test-ppc64le
    - job: centos7-v9.0-scan-ppc64le
    - job: centos7-v9.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos7-v9.0-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos7_9_0_ppc64le_only
  rules:
    - if: '$centos7_9_0_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v9.0-ppc64le
      artifacts: true
    - job: centos7-v9.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
centos7-v9.0-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *centos7_9_0_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_9_0_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: centos7-v9.0-ppc64le
      artifacts: true
    - job: centos7-v9.0-scan-no-test-ppc64le
    - job: centos7-v9.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
centos7-v9.0-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *centos7_9_0_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_9_0_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v9.0-ppc64le
      artifacts: true
    - job: centos7-v9.0-test-ppc64le
    - job: centos7-v9.0-cudnn7-ppc64le

.ubi7_9_0_x86_64_variables: &ubi7_9_0_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/9.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi7"
  OS_NAME: "ubi"
  OS_VERSION: "7"
  CUDA_VERSION: "9.0"

.ubi7_9_0_x86_64_only: &ubi7_9_0_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubi7_9_0_x86_64_variables
  rules:
    - if: '$ubi7_9_0_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v9.0-x86_64:
  <<: *cuda_base_definition
  <<: *ubi7_9_0_x86_64_only

ubi7-v9.0-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubi7_9_0_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_9_0_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubi7-v9.0-x86_64
      artifacts: true

ubi7-v9.0-test-x86_64:
  needs: ["ubi7-v9.0-x86_64"]
  <<: *ubi7_9_0_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_0_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v9.0-scan-x86_64:
  <<: *scan_definition
  <<: *ubi7_9_0_x86_64_only
  needs:
    - job: ubi7-v9.0-x86_64
    - job: ubi7-v9.0-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_0_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v9.0-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubi7_9_0_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubi7-v9.0-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_0_x86_64 == "true" && $NO_TEST == "true"'

ubi7-v9.0-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubi7_9_0_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_0_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi7-v9.0-x86_64
      artifacts: true
    - job: ubi7-v9.0-test-x86_64
    - job: ubi7-v9.0-scan-x86_64
    - job: ubi7-v9.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi7-v9.0-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi7_9_0_x86_64_only
  rules:
    - if: '$ubi7_9_0_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v9.0-x86_64
      artifacts: true
    - job: ubi7-v9.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubi7-v9.0-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubi7_9_0_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_0_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi7-v9.0-x86_64
      artifacts: true
    - job: ubi7-v9.0-scan-no-test-x86_64
    - job: ubi7-v9.0-cudnn7-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi7-v9.0-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubi7_9_0_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_0_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v9.0-x86_64
      artifacts: true
    - job: ubi7-v9.0-test-x86_64
    - job: ubi7-v9.0-cudnn7-x86_64

.ubi7_9_0_ppc64le_variables: &ubi7_9_0_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/9.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi7"
  OS_NAME: "ubi"
  OS_VERSION: "7"
  CUDA_VERSION: "9.0"

.ubi7_9_0_ppc64le_only: &ubi7_9_0_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubi7_9_0_ppc64le_variables
  rules:
    - if: '$ubi7_9_0_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v9.0-ppc64le:
  <<: *cuda_base_definition
  <<: *ubi7_9_0_ppc64le_only

ubi7-v9.0-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *ubi7_9_0_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_9_0_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubi7-v9.0-ppc64le
      artifacts: true

ubi7-v9.0-test-ppc64le:
  needs: ["ubi7-v9.0-ppc64le"]
  <<: *ubi7_9_0_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_0_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v9.0-scan-ppc64le:
  <<: *scan_definition
  <<: *ubi7_9_0_ppc64le_only
  needs:
    - job: ubi7-v9.0-ppc64le
    - job: ubi7-v9.0-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_0_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v9.0-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubi7_9_0_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubi7-v9.0-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_0_ppc64le == "true" && $NO_TEST == "true"'

ubi7-v9.0-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubi7_9_0_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_0_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi7-v9.0-ppc64le
      artifacts: true
    - job: ubi7-v9.0-test-ppc64le
    - job: ubi7-v9.0-scan-ppc64le
    - job: ubi7-v9.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi7-v9.0-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi7_9_0_ppc64le_only
  rules:
    - if: '$ubi7_9_0_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v9.0-ppc64le
      artifacts: true
    - job: ubi7-v9.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
ubi7-v9.0-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubi7_9_0_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_9_0_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi7-v9.0-ppc64le
      artifacts: true
    - job: ubi7-v9.0-scan-no-test-ppc64le
    - job: ubi7-v9.0-cudnn7-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubi7-v9.0-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubi7_9_0_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_9_0_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v9.0-ppc64le
      artifacts: true
    - job: ubi7-v9.0-test-ppc64le
    - job: ubi7-v9.0-cudnn7-ppc64le

.ubuntu16_04_8_0_x86_64_variables: &ubuntu16_04_8_0_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/8.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu16.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "16.04"
  CUDA_VERSION: "8.0"

.ubuntu16_04_8_0_x86_64_only: &ubuntu16_04_8_0_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubuntu16_04_8_0_x86_64_variables
  rules:
    - if: '$ubuntu16_04_8_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v8.0-x86_64:
  <<: *cuda_definition_deprecated
  <<: *ubuntu16_04_8_0_x86_64_only

ubuntu16.04-v8.0-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu16_04_8_0_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_8_0_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubuntu16.04-v8.0-x86_64
      artifacts: true

ubuntu16.04-v8.0-cudnn6-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu16_04_8_0_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_8_0_x86_64_variables
    CUDNN_VERSION: "cudnn6"
  artifacts:
    reports:
      dotenv: cudnn6finaltags.env
  needs:
    - job: ubuntu16.04-v8.0-x86_64
      artifacts: true

ubuntu16.04-v8.0-cudnn5-x86_64:
  <<: *cudnn_definition
  <<: *ubuntu16_04_8_0_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_8_0_x86_64_variables
    CUDNN_VERSION: "cudnn5"
  artifacts:
    reports:
      dotenv: cudnn5finaltags.env
  needs:
    - job: ubuntu16.04-v8.0-x86_64
      artifacts: true

ubuntu16.04-v8.0-test-x86_64:
  needs: ["ubuntu16.04-v8.0-x86_64"]
  <<: *ubuntu16_04_8_0_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_8_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v8.0-scan-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_8_0_x86_64_only
  needs:
    - job: ubuntu16.04-v8.0-x86_64
    - job: ubuntu16.04-v8.0-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_8_0_x86_64 == "true"'
    - if: '$all == "true"'

ubuntu16.04-v8.0-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubuntu16_04_8_0_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubuntu16.04-v8.0-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_8_0_x86_64 == "true" && $NO_TEST == "true"'

ubuntu16.04-v8.0-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubuntu16_04_8_0_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_8_0_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu16.04-v8.0-x86_64
      artifacts: true
    - job: ubuntu16.04-v8.0-test-x86_64
    - job: ubuntu16.04-v8.0-scan-x86_64
    - job: ubuntu16.04-v8.0-cudnn7-x86_64
    - job: ubuntu16.04-v8.0-cudnn6-x86_64
    - job: ubuntu16.04-v8.0-cudnn5-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu16.04-v8.0-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_8_0_x86_64_only
  rules:
    - if: '$ubuntu16_04_8_0_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v8.0-x86_64
      artifacts: true
    - job: ubuntu16.04-v8.0-cudnn7-x86_64
    - job: ubuntu16.04-v8.0-cudnn6-x86_64
    - job: ubuntu16.04-v8.0-cudnn5-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu16.04-v8.0-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubuntu16_04_8_0_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_8_0_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu16.04-v8.0-x86_64
      artifacts: true
    - job: ubuntu16.04-v8.0-scan-no-test-x86_64
    - job: ubuntu16.04-v8.0-cudnn7-x86_64
    - job: ubuntu16.04-v8.0-cudnn6-x86_64
    - job: ubuntu16.04-v8.0-cudnn5-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu16.04-v8.0-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_8_0_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_8_0_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v8.0-x86_64
      artifacts: true
    - job: ubuntu16.04-v8.0-test-x86_64
    - job: ubuntu16.04-v8.0-cudnn7-x86_64
    - job: ubuntu16.04-v8.0-cudnn6-x86_64
    - job: ubuntu16.04-v8.0-cudnn5-x86_64

.ubuntu16_04_8_0_ppc64le_variables: &ubuntu16_04_8_0_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/8.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  NO_OS_SUFFIX: "true"
  OS: "ubuntu16.04"
  OS_NAME: "ubuntu"
  OS_VERSION: "16.04"
  CUDA_VERSION: "8.0"

.ubuntu16_04_8_0_ppc64le_only: &ubuntu16_04_8_0_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubuntu16_04_8_0_ppc64le_variables
  rules:
    - if: '$ubuntu16_04_8_0_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu16.04-v8.0-ppc64le:
  <<: *cuda_definition_deprecated
  <<: *ubuntu16_04_8_0_ppc64le_only

ubuntu16.04-v8.0-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *ubuntu16_04_8_0_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_8_0_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubuntu16.04-v8.0-ppc64le
      artifacts: true

ubuntu16.04-v8.0-cudnn6-ppc64le:
  <<: *cudnn_definition
  <<: *ubuntu16_04_8_0_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_8_0_ppc64le_variables
    CUDNN_VERSION: "cudnn6"
  artifacts:
    reports:
      dotenv: cudnn6finaltags.env
  needs:
    - job: ubuntu16.04-v8.0-ppc64le
      artifacts: true

ubuntu16.04-v8.0-cudnn5-ppc64le:
  <<: *cudnn_definition
  <<: *ubuntu16_04_8_0_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubuntu16_04_8_0_ppc64le_variables
    CUDNN_VERSION: "cudnn5"
  artifacts:
    reports:
      dotenv: cudnn5finaltags.env
  needs:
    - job: ubuntu16.04-v8.0-ppc64le
      artifacts: true

ubuntu16.04-v8.0-test-ppc64le:
  needs: ["ubuntu16.04-v8.0-ppc64le"]
  <<: *ubuntu16_04_8_0_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_8_0_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu16.04-v8.0-scan-ppc64le:
  <<: *scan_definition
  <<: *ubuntu16_04_8_0_ppc64le_only
  needs:
    - job: ubuntu16.04-v8.0-ppc64le
    - job: ubuntu16.04-v8.0-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_8_0_ppc64le == "true"'
    - if: '$all == "true"'

ubuntu16.04-v8.0-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubuntu16_04_8_0_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubuntu16.04-v8.0-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_8_0_ppc64le == "true" && $NO_TEST == "true"'

ubuntu16.04-v8.0-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubuntu16_04_8_0_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_8_0_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubuntu16.04-v8.0-ppc64le
      artifacts: true
    - job: ubuntu16.04-v8.0-test-ppc64le
    - job: ubuntu16.04-v8.0-scan-ppc64le
    - job: ubuntu16.04-v8.0-cudnn7-ppc64le
    - job: ubuntu16.04-v8.0-cudnn6-ppc64le
    - job: ubuntu16.04-v8.0-cudnn5-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubuntu16.04-v8.0-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_8_0_ppc64le_only
  rules:
    - if: '$ubuntu16_04_8_0_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v8.0-ppc64le
      artifacts: true
    - job: ubuntu16.04-v8.0-cudnn7-ppc64le
    - job: ubuntu16.04-v8.0-cudnn6-ppc64le
    - job: ubuntu16.04-v8.0-cudnn5-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
ubuntu16.04-v8.0-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubuntu16_04_8_0_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubuntu16_04_8_0_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubuntu16.04-v8.0-ppc64le
      artifacts: true
    - job: ubuntu16.04-v8.0-scan-no-test-ppc64le
    - job: ubuntu16.04-v8.0-cudnn7-ppc64le
    - job: ubuntu16.04-v8.0-cudnn6-ppc64le
    - job: ubuntu16.04-v8.0-cudnn5-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubuntu16.04-v8.0-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubuntu16_04_8_0_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubuntu16_04_8_0_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubuntu16.04-v8.0-ppc64le
      artifacts: true
    - job: ubuntu16.04-v8.0-test-ppc64le
    - job: ubuntu16.04-v8.0-cudnn7-ppc64le
    - job: ubuntu16.04-v8.0-cudnn6-ppc64le
    - job: ubuntu16.04-v8.0-cudnn5-ppc64le

.centos7_8_0_x86_64_variables: &centos7_8_0_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/8.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos7"
  OS_NAME: "centos"
  OS_VERSION: "7"
  CUDA_VERSION: "8.0"

.centos7_8_0_x86_64_only: &centos7_8_0_x86_64_only
  <<: *tags_definition
  variables:
    <<: *centos7_8_0_x86_64_variables
  rules:
    - if: '$centos7_8_0_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v8.0-x86_64:
  <<: *cuda_definition_deprecated
  <<: *centos7_8_0_x86_64_only

centos7-v8.0-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *centos7_8_0_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_8_0_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: centos7-v8.0-x86_64
      artifacts: true

centos7-v8.0-cudnn6-x86_64:
  <<: *cudnn_definition
  <<: *centos7_8_0_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_8_0_x86_64_variables
    CUDNN_VERSION: "cudnn6"
  artifacts:
    reports:
      dotenv: cudnn6finaltags.env
  needs:
    - job: centos7-v8.0-x86_64
      artifacts: true

centos7-v8.0-cudnn5-x86_64:
  <<: *cudnn_definition
  <<: *centos7_8_0_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_8_0_x86_64_variables
    CUDNN_VERSION: "cudnn5"
  artifacts:
    reports:
      dotenv: cudnn5finaltags.env
  needs:
    - job: centos7-v8.0-x86_64
      artifacts: true

centos7-v8.0-test-x86_64:
  needs: ["centos7-v8.0-x86_64"]
  <<: *centos7_8_0_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_8_0_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v8.0-scan-x86_64:
  <<: *scan_definition
  <<: *centos7_8_0_x86_64_only
  needs:
    - job: centos7-v8.0-x86_64
    - job: centos7-v8.0-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos7_8_0_x86_64 == "true"'
    - if: '$all == "true"'

centos7-v8.0-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *centos7_8_0_x86_64_only
  # Override rules from only definition
  needs:
    - job: centos7-v8.0-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_8_0_x86_64 == "true" && $NO_TEST == "true"'

centos7-v8.0-deploy-x86_64:
  <<: *deploy_definition
  <<: *centos7_8_0_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos7_8_0_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos7-v8.0-x86_64
      artifacts: true
    - job: centos7-v8.0-test-x86_64
    - job: centos7-v8.0-scan-x86_64
    - job: centos7-v8.0-cudnn7-x86_64
    - job: centos7-v8.0-cudnn6-x86_64
    - job: centos7-v8.0-cudnn5-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos7-v8.0-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos7_8_0_x86_64_only
  rules:
    - if: '$centos7_8_0_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v8.0-x86_64
      artifacts: true
    - job: centos7-v8.0-cudnn7-x86_64
    - job: centos7-v8.0-cudnn6-x86_64
    - job: centos7-v8.0-cudnn5-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
centos7-v8.0-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *centos7_8_0_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_8_0_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: centos7-v8.0-x86_64
      artifacts: true
    - job: centos7-v8.0-scan-no-test-x86_64
    - job: centos7-v8.0-cudnn7-x86_64
    - job: centos7-v8.0-cudnn6-x86_64
    - job: centos7-v8.0-cudnn5-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
centos7-v8.0-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *centos7_8_0_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_8_0_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v8.0-x86_64
      artifacts: true
    - job: centos7-v8.0-test-x86_64
    - job: centos7-v8.0-cudnn7-x86_64
    - job: centos7-v8.0-cudnn6-x86_64
    - job: centos7-v8.0-cudnn5-x86_64

.centos7_8_0_ppc64le_variables: &centos7_8_0_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/8.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "centos7"
  OS_NAME: "centos"
  OS_VERSION: "7"
  CUDA_VERSION: "8.0"

.centos7_8_0_ppc64le_only: &centos7_8_0_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *centos7_8_0_ppc64le_variables
  rules:
    - if: '$centos7_8_0_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v8.0-ppc64le:
  <<: *cuda_definition_deprecated
  <<: *centos7_8_0_ppc64le_only

centos7-v8.0-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *centos7_8_0_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_8_0_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: centos7-v8.0-ppc64le
      artifacts: true

centos7-v8.0-cudnn6-ppc64le:
  <<: *cudnn_definition
  <<: *centos7_8_0_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_8_0_ppc64le_variables
    CUDNN_VERSION: "cudnn6"
  artifacts:
    reports:
      dotenv: cudnn6finaltags.env
  needs:
    - job: centos7-v8.0-ppc64le
      artifacts: true

centos7-v8.0-cudnn5-ppc64le:
  <<: *cudnn_definition
  <<: *centos7_8_0_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *centos7_8_0_ppc64le_variables
    CUDNN_VERSION: "cudnn5"
  artifacts:
    reports:
      dotenv: cudnn5finaltags.env
  needs:
    - job: centos7-v8.0-ppc64le
      artifacts: true

centos7-v8.0-test-ppc64le:
  needs: ["centos7-v8.0-ppc64le"]
  <<: *centos7_8_0_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_8_0_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v8.0-scan-ppc64le:
  <<: *scan_definition
  <<: *centos7_8_0_ppc64le_only
  needs:
    - job: centos7-v8.0-ppc64le
    - job: centos7-v8.0-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$centos7_8_0_ppc64le == "true"'
    - if: '$all == "true"'

centos7-v8.0-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *centos7_8_0_ppc64le_only
  # Override rules from only definition
  needs:
    - job: centos7-v8.0-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_8_0_ppc64le == "true" && $NO_TEST == "true"'

centos7-v8.0-deploy-ppc64le:
  <<: *deploy_definition
  <<: *centos7_8_0_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$centos7_8_0_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: centos7-v8.0-ppc64le
      artifacts: true
    - job: centos7-v8.0-test-ppc64le
    - job: centos7-v8.0-scan-ppc64le
    - job: centos7-v8.0-cudnn7-ppc64le
    - job: centos7-v8.0-cudnn6-ppc64le
    - job: centos7-v8.0-cudnn5-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
centos7-v8.0-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *centos7_8_0_ppc64le_only
  rules:
    - if: '$centos7_8_0_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v8.0-ppc64le
      artifacts: true
    - job: centos7-v8.0-cudnn7-ppc64le
    - job: centos7-v8.0-cudnn6-ppc64le
    - job: centos7-v8.0-cudnn5-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
centos7-v8.0-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *centos7_8_0_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$centos7_8_0_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: centos7-v8.0-ppc64le
      artifacts: true
    - job: centos7-v8.0-scan-no-test-ppc64le
    - job: centos7-v8.0-cudnn7-ppc64le
    - job: centos7-v8.0-cudnn6-ppc64le
    - job: centos7-v8.0-cudnn5-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
centos7-v8.0-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *centos7_8_0_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$centos7_8_0_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: centos7-v8.0-ppc64le
      artifacts: true
    - job: centos7-v8.0-test-ppc64le
    - job: centos7-v8.0-cudnn7-ppc64le
    - job: centos7-v8.0-cudnn6-ppc64le
    - job: centos7-v8.0-cudnn5-ppc64le

.ubi7_8_0_x86_64_variables: &ubi7_8_0_x86_64_variables
  ARCH: "x86_64"
  DIST_BASE_PATH: "dist/8.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi7"
  OS_NAME: "ubi"
  OS_VERSION: "7"
  CUDA_VERSION: "8.0"

.ubi7_8_0_x86_64_only: &ubi7_8_0_x86_64_only
  <<: *tags_definition
  variables:
    <<: *ubi7_8_0_x86_64_variables
  rules:
    - if: '$ubi7_8_0_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v8.0-x86_64:
  <<: *cuda_definition_deprecated
  <<: *ubi7_8_0_x86_64_only

ubi7-v8.0-cudnn7-x86_64:
  <<: *cudnn_definition
  <<: *ubi7_8_0_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_8_0_x86_64_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubi7-v8.0-x86_64
      artifacts: true

ubi7-v8.0-cudnn6-x86_64:
  <<: *cudnn_definition
  <<: *ubi7_8_0_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_8_0_x86_64_variables
    CUDNN_VERSION: "cudnn6"
  artifacts:
    reports:
      dotenv: cudnn6finaltags.env
  needs:
    - job: ubi7-v8.0-x86_64
      artifacts: true

ubi7-v8.0-cudnn5-x86_64:
  <<: *cudnn_definition
  <<: *ubi7_8_0_x86_64_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_8_0_x86_64_variables
    CUDNN_VERSION: "cudnn5"
  artifacts:
    reports:
      dotenv: cudnn5finaltags.env
  needs:
    - job: ubi7-v8.0-x86_64
      artifacts: true

ubi7-v8.0-test-x86_64:
  needs: ["ubi7-v8.0-x86_64"]
  <<: *ubi7_8_0_x86_64_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_8_0_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v8.0-scan-x86_64:
  <<: *scan_definition
  <<: *ubi7_8_0_x86_64_only
  needs:
    - job: ubi7-v8.0-x86_64
    - job: ubi7-v8.0-test-x86_64
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi7_8_0_x86_64 == "true"'
    - if: '$all == "true"'

ubi7-v8.0-scan-no-test-x86_64:
  <<: *scan_definition
  <<: *ubi7_8_0_x86_64_only
  # Override rules from only definition
  needs:
    - job: ubi7-v8.0-x86_64
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_8_0_x86_64 == "true" && $NO_TEST == "true"'

ubi7-v8.0-deploy-x86_64:
  <<: *deploy_definition
  <<: *ubi7_8_0_x86_64_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi7_8_0_x86_64 == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi7-v8.0-x86_64
      artifacts: true
    - job: ubi7-v8.0-test-x86_64
    - job: ubi7-v8.0-scan-x86_64
    - job: ubi7-v8.0-cudnn7-x86_64
    - job: ubi7-v8.0-cudnn6-x86_64
    - job: ubi7-v8.0-cudnn5-x86_64

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi7-v8.0-deploy-x86_64-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi7_8_0_x86_64_only
  rules:
    - if: '$ubi7_8_0_x86_64 == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v8.0-x86_64
      artifacts: true
    - job: ubi7-v8.0-cudnn7-x86_64
    - job: ubi7-v8.0-cudnn6-x86_64
    - job: ubi7-v8.0-cudnn5-x86_64

# workaround for gitlab ci rules when NO_TEST is used...
ubi7-v8.0-deploy-x86_64-no-test:
  <<: *deploy_definition
  <<: *ubi7_8_0_x86_64_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_8_0_x86_64 == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi7-v8.0-x86_64
      artifacts: true
    - job: ubi7-v8.0-scan-no-test-x86_64
    - job: ubi7-v8.0-cudnn7-x86_64
    - job: ubi7-v8.0-cudnn6-x86_64
    - job: ubi7-v8.0-cudnn5-x86_64

# workaround for gitlab ci rules when NO_SCAN is used...
ubi7-v8.0-deploy-x86_64-no-scan:
  <<: *deploy_definition
  <<: *ubi7_8_0_x86_64_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_8_0_x86_64 == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v8.0-x86_64
      artifacts: true
    - job: ubi7-v8.0-test-x86_64
    - job: ubi7-v8.0-cudnn7-x86_64
    - job: ubi7-v8.0-cudnn6-x86_64
    - job: ubi7-v8.0-cudnn5-x86_64

.ubi7_8_0_ppc64le_variables: &ubi7_8_0_ppc64le_variables
  ARCH: "ppc64le"
  DIST_BASE_PATH: "dist/8.0"
  IMAGE_NAME: "gitlab-master.nvidia.com:5005/cuda-installer/cuda/cuda-ppc64le"
  MANIFEST: "manifests/cuda.yaml"
  OS: "ubi7"
  OS_NAME: "ubi"
  OS_VERSION: "7"
  CUDA_VERSION: "8.0"

.ubi7_8_0_ppc64le_only: &ubi7_8_0_ppc64le_only
  <<: *tags_definition_multiarch
  variables:
    <<: *ubi7_8_0_ppc64le_variables
  rules:
    - if: '$ubi7_8_0_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v8.0-ppc64le:
  <<: *cuda_definition_deprecated
  <<: *ubi7_8_0_ppc64le_only

ubi7-v8.0-cudnn7-ppc64le:
  <<: *cudnn_definition
  <<: *ubi7_8_0_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_8_0_ppc64le_variables
    CUDNN_VERSION: "cudnn7"
  artifacts:
    reports:
      dotenv: cudnn7finaltags.env
  needs:
    - job: ubi7-v8.0-ppc64le
      artifacts: true

ubi7-v8.0-cudnn6-ppc64le:
  <<: *cudnn_definition
  <<: *ubi7_8_0_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_8_0_ppc64le_variables
    CUDNN_VERSION: "cudnn6"
  artifacts:
    reports:
      dotenv: cudnn6finaltags.env
  needs:
    - job: ubi7-v8.0-ppc64le
      artifacts: true

ubi7-v8.0-cudnn5-ppc64le:
  <<: *cudnn_definition
  <<: *ubi7_8_0_ppc64le_only
  # Variables overwritten here. Don't move this section.
  variables:
    <<: *ubi7_8_0_ppc64le_variables
    CUDNN_VERSION: "cudnn5"
  artifacts:
    reports:
      dotenv: cudnn5finaltags.env
  needs:
    - job: ubi7-v8.0-ppc64le
      artifacts: true

ubi7-v8.0-test-ppc64le:
  needs: ["ubi7-v8.0-ppc64le"]
  <<: *ubi7_8_0_ppc64le_only
  <<: *test_definition
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_8_0_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v8.0-scan-ppc64le:
  <<: *scan_definition
  <<: *ubi7_8_0_ppc64le_only
  needs:
    - job: ubi7-v8.0-ppc64le
    - job: ubi7-v8.0-test-ppc64le
  # Override rules from only definition
  rules:
    - if: '$NO_SCAN == "true" || $NO_TEST == "true"'
      when: never
    - if: '$ubi7_8_0_ppc64le == "true"'
    - if: '$all == "true"'

ubi7-v8.0-scan-no-test-ppc64le:
  <<: *scan_definition
  <<: *ubi7_8_0_ppc64le_only
  # Override rules from only definition
  needs:
    - job: ubi7-v8.0-ppc64le
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_8_0_ppc64le == "true" && $NO_TEST == "true"'

ubi7-v8.0-deploy-ppc64le:
  <<: *deploy_definition
  <<: *ubi7_8_0_ppc64le_only
  # Override rules from only definition
  rules:
    - if: '$NO_TEST == "true" || $NO_SCAN == "true"'
      when: never
    - if: '$ubi7_8_0_ppc64le == "true"'
    - if: '$all == "true"'
  needs:
    - job: ubi7-v8.0-ppc64le
      artifacts: true
    - job: ubi7-v8.0-test-ppc64le
    - job: ubi7-v8.0-scan-ppc64le
    - job: ubi7-v8.0-cudnn7-ppc64le
    - job: ubi7-v8.0-cudnn6-ppc64le
    - job: ubi7-v8.0-cudnn5-ppc64le

# workaround for gitlab ci rules when NO_TEST and NO_SCAN are used...
ubi7-v8.0-deploy-ppc64le-no-test-no-scan:
  <<: *deploy_definition
  <<: *ubi7_8_0_ppc64le_only
  rules:
    - if: '$ubi7_8_0_ppc64le == "true" && $NO_TEST == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v8.0-ppc64le
      artifacts: true
    - job: ubi7-v8.0-cudnn7-ppc64le
    - job: ubi7-v8.0-cudnn6-ppc64le
    - job: ubi7-v8.0-cudnn5-ppc64le

# workaround for gitlab ci rules when NO_TEST is used...
ubi7-v8.0-deploy-ppc64le-no-test:
  <<: *deploy_definition
  <<: *ubi7_8_0_ppc64le_only
  rules:
    - if: '$NO_SCAN == "true"'
      when: never
    - if: '$ubi7_8_0_ppc64le == "true" && $NO_TEST == "true"'
  needs:
    - job: ubi7-v8.0-ppc64le
      artifacts: true
    - job: ubi7-v8.0-scan-no-test-ppc64le
    - job: ubi7-v8.0-cudnn7-ppc64le
    - job: ubi7-v8.0-cudnn6-ppc64le
    - job: ubi7-v8.0-cudnn5-ppc64le

# workaround for gitlab ci rules when NO_SCAN is used...
ubi7-v8.0-deploy-ppc64le-no-scan:
  <<: *deploy_definition
  <<: *ubi7_8_0_ppc64le_only
  rules:
    - if: '$NO_TEST == "true"'
      when: never
    - if: '$ubi7_8_0_ppc64le == "true" && $NO_SCAN == "true"'
  needs:
    - job: ubi7-v8.0-ppc64le
      artifacts: true
    - job: ubi7-v8.0-test-ppc64le
    - job: ubi7-v8.0-cudnn7-ppc64le
    - job: ubi7-v8.0-cudnn6-ppc64le
    - job: ubi7-v8.0-cudnn5-ppc64le

